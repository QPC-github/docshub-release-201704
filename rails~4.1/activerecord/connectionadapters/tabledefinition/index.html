
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ActiveRecord&#58;&#58;ConnectionAdapters&#58;&#58;TableDefinition - Ruby on Rails 4.1 - W3cubDocs</title>
  
  <meta name="description" content=" Represents the schema of an SQL table in an abstract way. This class provides methods for manipulating the schema representation. ">
  <meta name="keywords" content="class, activerecord, connectionadapters, tabledefinition, -, ruby, on, rails, rails~4.1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/rails~4.1/activerecord/connectionadapters/tabledefinition/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/rails~4.1.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~4.1/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 4.1</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _rdoc">
				
<h1 id="class-ActiveRecord::ConnectionAdapters::TableDefinition" class="class"> class ActiveRecord::ConnectionAdapters::TableDefinition </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../../../object/">Object</a></dd>
</dl> <section class="description"> <p>Represents the schema of an SQL table in an abstract way. This class provides methods for manipulating the schema representation.</p> <p>Inside migration files, the <code>t</code> object in <code>create_table</code> is actually of this type:</p> <pre>class SomeMigration &lt; ActiveRecord::Migration
  def up
    create_table :foo do |t|
      puts t.class  # =&gt; "ActiveRecord::ConnectionAdapters::TableDefinition"
    end
  end

  def down
    ...
  end
end</pre> <p>The table definitions The Columns are stored as a ColumnDefinition in the <code>columns</code> attribute.</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-as"> <span class="method-name">as</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-indexes"> <span class="method-name">indexes</span><span class="attribute-access-type">[RW]</span> </div> <div class="method-description"> <p>An array of ColumnDefinition objects, representing the column changes that have been defined.</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-name"> <span class="method-name">name</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-options"> <span class="method-name">options</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-temporary"> <span class="method-name">temporary</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(types, name, temporary, options, as = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 54
def initialize(types, name, temporary, options, as = nil)
  @columns_hash = {}
  @indexes = {}
  @native = types
  @temporary = temporary
  @options = options
  @as = as
  @name = name
end</pre> </div> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(name)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Returns a ColumnDefinition for the column with name <code>name</code>.</p> <div class="method-source-code" id="5B-5D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 73
def [](name)
  @columns_hash[name.to_s]
end</pre> </div> </div> </div> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-belongs_to"> <span class="method-name">belongs_to</span><span class="method-args">(*args)</span> </div>  <div class="aliases"> Alias for: <a href="../tabledefinition/#method-i-references">references</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-column"> <span class="method-name">column</span><span class="method-args">(name, type, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Instantiates a new column for the table. The <code>type</code> parameter is normally one of the migrations native types, which is one of the following: <code>:primary_key</code>, <code>:string</code>, <code>:text</code>, <code>:integer</code>, <code>:float</code>, <code>:decimal</code>, <code>:datetime</code>, <code>:timestamp</code>, <code>:time</code>, <code>:date</code>, <code>:binary</code>, <code>:boolean</code>.</p> <p>You may use a type not in this list as long as it is supported by your database (for example, “polygon” in MySQL), but this will not be database agnostic and should usually be avoided.</p> <p>Available options are (none of these exists by default):</p> <ul>
<li> <p><code>:limit</code> - Requests a maximum column length. This is number of characters for <code>:string</code> and <code>:text</code> columns and number of bytes for <code>:binary</code> and <code>:integer</code> columns.</p> </li>
<li> <p><code>:default</code> - The column's default value. Use nil for NULL.</p> </li>
<li> <p><code>:null</code> - Allows or disallows <code>NULL</code> values in the column. This option could have been named <code>:null_allowed</code>.</p> </li>
<li> <p><code>:precision</code> - Specifies the precision for a <code>:decimal</code> column.</p> </li>
<li> <p><code>:scale</code> - Specifies the scale for a <code>:decimal</code> column.</p> </li>
</ul> <p>For clarity's sake: the precision is the number of significant digits, while the scale is the number of digits that can be stored following the decimal point. For example, the number 123.45 has a precision of 5 and a scale of 2. A decimal with a precision of 5 and a scale of 2 can range from -999.99 to 999.99.</p> <p>Please be aware of different RDBMS implementations behavior with <code>:decimal</code> columns:</p> <ul>
<li> <p>The SQL standard says the default scale should be 0, <code>:scale</code> &lt;= <code>:precision</code>, and makes no comments about the requirements of <code>:precision</code>.</p> </li>
<li> <p>MySQL: <code>:precision</code> [1..63], <code>:scale</code> [0..30]. Default is (10,0).</p> </li>
<li> <p>PostgreSQL: <code>:precision</code> [1..infinity], <code>:scale</code> [0..infinity]. No default.</p> </li>
<li> <p>SQLite2: Any <code>:precision</code> and <code>:scale</code> may be used. Internal storage as strings. No default.</p> </li>
<li> <p>SQLite3: No restrictions on <code>:precision</code> and <code>:scale</code>, but the maximum supported <code>:precision</code> is 16. No default.</p> </li>
<li> <p>Oracle: <code>:precision</code> [1..38], <code>:scale</code> [-84..127]. Default is (38,0).</p> </li>
<li> <p>DB2: <code>:precision</code> [1..63], <code>:scale</code> [0..62]. Default unknown.</p> </li>
<li> <p>Firebird: <code>:precision</code> [1..18], <code>:scale</code> [0..18]. Default (9,0). Internal types NUMERIC and DECIMAL have different storage rules, decimal being better.</p> </li>
<li> <p>FrontBase?: <code>:precision</code> [1..38], <code>:scale</code> [0..38]. Default (38,0). WARNING Max <code>:precision</code>/<code>:scale</code> for NUMERIC is 19, and DECIMAL is 38.</p> </li>
<li> <p>SqlServer?: <code>:precision</code> [1..38], <code>:scale</code> [0..38]. Default (38,0).</p> </li>
<li> <p>Sybase: <code>:precision</code> [1..38], <code>:scale</code> [0..38]. Default (38,0).</p> </li>
<li> <p>OpenBase?: Documentation unclear. Claims storage in <code>double</code>.</p> </li>
</ul> <p>This method returns <code>self</code>.</p> <h2 id="method-i-column-label-Examples">Examples</h2> <pre class="ruby" data-language="ruby"># Assuming +td+ is an instance of TableDefinition
td.column(:granted, :boolean)
# granted BOOLEAN

td.column(:picture, :binary, limit: 2.megabytes)
# =&gt; picture BLOB(2097152)

td.column(:sales_stage, :string, limit: 20, default: 'new', null: false)
# =&gt; sales_stage VARCHAR(20) DEFAULT 'new' NOT NULL

td.column(:bill_gates_money, :decimal, precision: 15, scale: 2)
# =&gt; bill_gates_money DECIMAL(15,2)

td.column(:sensor_reading, :decimal, precision: 30, scale: 20)
# =&gt; sensor_reading DECIMAL(30,20)

# While &lt;tt&gt;:scale&lt;/tt&gt; defaults to zero on most databases, it
# probably wouldn't hurt to include it.
td.column(:huge_integer, :decimal, precision: 30)
# =&gt; huge_integer DECIMAL(30)

# Defines a column with a database-specific type.
td.column(:foo, 'polygon')
# =&gt; foo polygon
</pre> <h2 id="method-i-column-label-Short-hand+examples">Short-hand examples</h2> <p>Instead of calling <code>column</code> directly, you can also work with the short-hand definitions for the default types. They use the type as the method name instead of as a parameter and allow for multiple columns to be defined in a single statement.</p> <p>What can be written like this with the regular calls to column:</p> <pre class="ruby" data-language="ruby">create_table :products do |t|
  t.column :shop_id,    :integer
  t.column :creator_id, :integer
  t.column :name,       :string, default: "Untitled"
  t.column :value,      :string, default: "Untitled"
  t.column :created_at, :datetime
  t.column :updated_at, :datetime
end
</pre> <p>can also be written as follows using the short-hand:</p> <pre class="ruby" data-language="ruby">create_table :products do |t|
  t.integer :shop_id, :creator_id
  t.string  :name, :value, default: "Untitled"
  t.timestamps
end
</pre> <p>There's a short-hand method for each of the type values declared at the top. And then there's <a href="../tabledefinition/#method-i-timestamps">#timestamps</a> that'll add <code>created_at</code> and <code>updated_at</code> as datetimes.</p> <p><a href="../tabledefinition/#method-i-references">#references</a> will add an appropriately-named _id column, plus a corresponding _type column if the <code>:polymorphic</code> option is supplied. If <code>:polymorphic</code> is a hash of options, these will be used when creating the <code>_type</code> column. The <code>:index</code> option will also create an index, similar to calling <code>add_index</code>. So what can be written like this:</p> <pre class="ruby" data-language="ruby">create_table :taggings do |t|
  t.integer :tag_id, :tagger_id, :taggable_id
  t.string  :tagger_type
  t.string  :taggable_type, default: 'Photo'
end
add_index :taggings, :tag_id, name: 'index_taggings_on_tag_id'
add_index :taggings, [:tagger_id, :tagger_type]
</pre> <p>Can also be written as follows using references:</p> <pre class="ruby" data-language="ruby">create_table :taggings do |t|
  t.references :tag, index: { name: 'index_taggings_on_tag_id' }
  t.references :tagger, polymorphic: true, index: true
  t.references :taggable, polymorphic: { default: 'Photo' }
end
</pre> <div class="method-source-code" id="column-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 214
def column(name, type, options = {})
  name = name.to_s
  type = type.to_sym

  if primary_key_column_name == name
    raise ArgumentError, "you can't redefine the primary key column '#{name}'. To define a custom primary key, pass { id: false } to create_table."
  end

  @columns_hash[name] = new_column_definition(name, type, options)
  self
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-columns"> <span class="method-name">columns</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="columns-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 64
def columns; @columns_hash.values; end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-index"> <span class="method-name">index</span><span class="method-args">(column_name, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Adds index options to the indexes hash, keyed by column name This is primarily used to track indexes that need to be created after the table</p> <pre class="ruby" data-language="ruby">index(:account_id, name: 'index_projects_on_account_id')
</pre> <div class="method-source-code" id="index-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 242
def index(column_name, options = {})
  indexes[column_name] = options
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-primary_key"> <span class="method-name">primary_key</span><span class="method-args">(name, type = :primary_key, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Appends a primary key definition to the table definition. Can be called multiple times, but this is probably not a good idea.</p> <div class="method-source-code" id="primary_key-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 68
def primary_key(name, type = :primary_key, options = {})
  column(name, type, options.merge(:primary_key =&gt; true))
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-references"> <span class="method-name">references</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="references-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 254
def references(*args)
  options = args.extract_options!
  polymorphic = options.delete(:polymorphic)
  index_options = options.delete(:index)
  args.each do |col|
    column("#{col}_id", :integer, options)
    column("#{col}_type", :string, polymorphic.is_a?(Hash) ? polymorphic : options) if polymorphic
    index(polymorphic ? %w(id type).map { |t| "#{col}_#{t}" } : "#{col}_id", index_options.is_a?(Hash) ? index_options : {}) if index_options
  end
end</pre> </div> </div> <div class="aliases"> Also aliased as: <a href="../tabledefinition/#method-i-belongs_to">belongs_to</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remove_column"> <span class="method-name">remove_column</span><span class="method-args">(name)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="remove_column-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 226
def remove_column(name)
  @columns_hash.delete name.to_s
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-timestamps"> <span class="method-name">timestamps</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Appends <code>:datetime</code> columns <code>:created_at</code> and <code>:updated_at</code> to the table.</p> <div class="method-source-code" id="timestamps-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 248
def timestamps(*args)
  options = args.extract_options!
  column(:created_at, :datetime, options)
  column(:updated_at, :datetime, options)
end</pre> </div> </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2016 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
