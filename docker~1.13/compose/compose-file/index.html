
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Compose File Reference - Docker 1.13 - W3cubDocs</title>
  
  <meta name="description" content=" The Compose file is a YAML file defining services, networks and volumes. The default path for a Compose file is .&#47;docker-compose.yml. ">
  <meta name="keywords" content="compose, file, reference, -, docker, docker~1.13">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/docker~1.13/compose/compose-file/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/docker~1.13.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/docker~1.13/" class="_nav-link" title="" style="margin-left:0;">Docker 1.13</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _docker">
				
<h1>Compose file reference</h1>  <p>The Compose file is a <a href="http://yaml.org/" target="_blank">YAML</a> file defining <a href="/#service-configuration-reference">services</a>, <a href="/#network-configuration-reference">networks</a> and <a href="/#volume-configuration-reference">volumes</a>. The default path for a Compose file is <code class="highlighter-rouge">./docker-compose.yml</code>.</p> <blockquote> <p><strong>Tip:</strong> You can use either a <code class="highlighter-rouge">.yml</code> or <code class="highlighter-rouge">.yaml</code> extension for this file. They both work.</p> </blockquote> <p>A service definition contains configuration which will be applied to each container started for that service, much like passing command-line parameters to <code class="highlighter-rouge">docker run</code>. Likewise, network and volume definitions are analogous to <code class="highlighter-rouge">docker network create</code> and <code class="highlighter-rouge">docker volume create</code>.</p> <p>As with <code class="highlighter-rouge">docker run</code>, options specified in the Dockerfile (e.g., <code class="highlighter-rouge">CMD</code>, <code class="highlighter-rouge">EXPOSE</code>, <code class="highlighter-rouge">VOLUME</code>, <code class="highlighter-rouge">ENV</code>) are respected by default - you don’t need to specify them again in <code class="highlighter-rouge">docker-compose.yml</code>.</p> <p>You can use environment variables in configuration values with a Bash-like <code class="highlighter-rouge">${VARIABLE}</code> syntax - see <a href="/#variable-substitution">variable substitution</a> for full details.</p> <h2 id="service-configuration-reference">Service configuration reference</h2> <blockquote> <p><strong>Note:</strong> There are several versions of the Compose file format – 1, 2, 2.1 and 3. For more information, see the <a href="/#versioning">Versioning</a> section.</p> </blockquote> <p>This section contains a list of all configuration options supported by a service definition.</p> <h3 id="build">build</h3> <p>Configuration options that are applied at build time.</p> <p><code class="highlighter-rouge">build</code> can be specified either as a string containing a path to the build context, or an object with the path specified under <a href="/#context">context</a> and optionally <a href="/#dockerfile">dockerfile</a> and <a href="/#args">args</a>.</p> <pre class="highlight" data-language="">build: ./dir

build:
  context: ./dir
  dockerfile: Dockerfile-alternate
  args:
    buildno: 1
</pre>  <p>If you specify <code class="highlighter-rouge">image</code> as well as <code class="highlighter-rouge">build</code>, then Compose names the built image with the <code class="highlighter-rouge">webapp</code> and optional <code class="highlighter-rouge">tag</code> specified in <code class="highlighter-rouge">image</code>:</p> <pre class="highlight" data-language="">build: ./dir
image: webapp:tag
</pre>  <p>This will result in an image named <code class="highlighter-rouge">webapp</code> and tagged <code class="highlighter-rouge">tag</code>, built from <code class="highlighter-rouge">./dir</code>.</p> <blockquote> <p><strong>Note</strong>: In the <a href="/#version-1">version 1 file format</a>, <code class="highlighter-rouge">build</code> is different in two ways:</p> <ol> <li>Only the string form (<code class="highlighter-rouge">build: .</code>) is allowed - not the object form.</li> <li>Using <code class="highlighter-rouge">build</code> together with <code class="highlighter-rouge">image</code> is not allowed. Attempting to do so results in an error.</li> </ol> </blockquote> <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file. The <code class="highlighter-rouge">docker stack</code> command accepts only pre-built images.</p> </blockquote> <h4 id="context">context</h4> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up. In version 1, just use <a href="/#build">build</a>.</p> </blockquote> <p>Either a path to a directory containing a Dockerfile, or a url to a git repository.</p> <p>When the value supplied is a relative path, it is interpreted as relative to the location of the Compose file. This directory is also the build context that is sent to the Docker daemon.</p> <p>Compose will build and tag it with a generated name, and use that image thereafter.</p> <pre class="highlight" data-language="">build:
  context: ./dir
</pre>  <h4 id="dockerfile">dockerfile</h4> <p>Alternate Dockerfile.</p> <p>Compose will use an alternate file to build with. A build path must also be specified.</p> <pre class="highlight" data-language="">build:
  context: .
  dockerfile: Dockerfile-alternate
</pre>  <blockquote> <p><strong>Note</strong>: In the <a href="/#version-1">version 1 file format</a>, <code class="highlighter-rouge">dockerfile</code> is different in two ways:</p> <ol> <li> <p>It appears alongside <code class="highlighter-rouge">build</code>, not as a sub-option:</p> <pre class="highlight" data-language="">build: .
dockerfile: Dockerfile-alternate
</pre>  </li> <li> <p>Using <code class="highlighter-rouge">dockerfile</code> together with <code class="highlighter-rouge">image</code> is not allowed. Attempting to do so results in an error.</p> </li> </ol> </blockquote> <h4 id="args">args</h4> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up.</p> </blockquote> <p>Add build arguments, which are environment variables accessible only during the build process.</p> <p>First, specify the arguments in your Dockerfile:</p> <pre class="highlight" data-language="">ARG buildno
ARG password

RUN echo "Build number: $buildno"
RUN script-requiring-password.sh "$password"
</pre>  <p>Then specify the arguments under the <code class="highlighter-rouge">build</code> key. You can pass either a mapping or a list:</p> <pre class="highlight" data-language="">build:
  context: .
  args:
    buildno: 1
    password: secret

build:
  context: .
  args:
    - buildno=1
    - password=secret
</pre>  <p>You can omit the value when specifying a build argument, in which case its value at build time is the value in the environment where Compose is running.</p> <pre class="highlight" data-language="">args:
  - buildno
  - password
</pre>  <blockquote> <p><strong>Note</strong>: YAML boolean values (<code class="highlighter-rouge">true</code>, <code class="highlighter-rouge">false</code>, <code class="highlighter-rouge">yes</code>, <code class="highlighter-rouge">no</code>, <code class="highlighter-rouge">on</code>, <code class="highlighter-rouge">off</code>) must be enclosed in quotes, so that the parser interprets them as strings.</p> </blockquote> <h3 id="capadd-capdrop">cap_add, cap_drop</h3> <p>Add or drop container capabilities. See <code class="highlighter-rouge">man 7 capabilities</code> for a full list.</p> <pre class="highlight" data-language="">cap_add:
  - ALL

cap_drop:
  - NET_ADMIN
  - SYS_ADMIN
</pre>  <blockquote> <p><strong>Note:</strong> These options are ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="command">command</h3> <p>Override the default command.</p> <pre class="highlight" data-language="">command: bundle exec thin -p 3000
</pre>  <p>The command can also be a list, in a manner similar to <a href="../../engine/reference/builder/#cmd">dockerfile</a>:</p> <pre class="highlight" data-language="">command: [bundle, exec, thin, -p, 3000]
</pre>  <h3 id="cgroupparent">cgroup_parent</h3> <p>Specify an optional parent cgroup for the container.</p> <pre class="highlight" data-language="">cgroup_parent: m-executor-abcd
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="containername">container_name</h3> <p>Specify a custom container name, rather than a generated default name.</p> <pre class="highlight" data-language="">container_name: my-web-container
</pre>  <p>Because Docker container names must be unique, you cannot scale a service beyond 1 container if you have specified a custom name. Attempting to do so results in an error.</p> <h3 id="deploy">deploy</h3> <blockquote> <p><strong><a href="/#version-3">Version 3</a> only.</strong></p> </blockquote> <p>Specify configuration related to the deployment and running of services. This only takes effect when deploying to a <a href="../../engine/swarm/">swarm</a> with <a href="../../engine/reference/commandline/stack_deploy/"><code class="highlighter-rouge">docker stack deploy</code></a>, and is ignored by <code class="highlighter-rouge">docker-compose up</code> and <code class="highlighter-rouge">docker-compose run</code>.</p> <pre class="highlight" data-language="">deploy:
  replicas: 6
  update_config:
    parallelism: 2
    delay: 10s
  restart_policy:
    condition: on-failure
</pre>  <p>Several sub-options are available:</p> <h4 id="mode">mode</h4> <p>Either <code class="highlighter-rouge">global</code> (exactly one container per swarm node) or <code class="highlighter-rouge">replicated</code> (a specified number of containers). The default is <code class="highlighter-rouge">replicated</code>.</p> <pre class="highlight" data-language="">mode: global
</pre>  <h4 id="replicas">replicas</h4> <p>If the service is <code class="highlighter-rouge">replicated</code> (which is the default), specify the number of containers that should be running at any given time.</p> <pre class="highlight" data-language="">mode: replicated
replicas: 6
</pre>  <h4 id="placement">placement</h4> <p>Specify placement constraints. For a full description of the syntax and available types of constraints, see the <a href="../../engine/reference/commandline/service_create/#specify-service-constraints-constraint">docker service create</a> documentation.</p> <pre class="highlight" data-language="">placement:
  constraints:
    - node.role == manager
    - engine.labels.operatingsystem == ubuntu 14.04
</pre>  <h4 id="updateconfig">update_config</h4> <p>Configures how the service should be updated. Useful for configuring rolling updates.</p> <ul> <li>
<code class="highlighter-rouge">parallelism</code>: The number of containers to update at a time.</li> <li>
<code class="highlighter-rouge">delay</code>: The time to wait between updating a group of containers.</li> <li>
<code class="highlighter-rouge">failure_action</code>: What to do if an update fails. One of <code class="highlighter-rouge">continue</code> or <code class="highlighter-rouge">pause</code> (default: <code class="highlighter-rouge">pause</code>).</li> <li>
<code class="highlighter-rouge">monitor</code>: TODO</li> <li> <p><code class="highlighter-rouge">max_failure_ratio</code>: TODO</p> <p>update_config: parallelism: 2 delay: 10s</p> </li> </ul> <h4 id="resources">resources</h4> <p>Configures resource constraints. This replaces the older resource constraint options in Compose files prior to version 3 (<code class="highlighter-rouge">cpu_shares</code>, <code class="highlighter-rouge">cpu_quota</code>, <code class="highlighter-rouge">cpuset</code>, <code class="highlighter-rouge">mem_limit</code>, <code class="highlighter-rouge">memswap_limit</code>).</p> <pre class="highlight" data-language="">resources:
  limits:
    cpus: '0.001'
    memory: 50M
  reservations:
    cpus: '0.0001'
    memory: 20M
</pre>  <h4 id="restartpolicy">restart_policy</h4> <p>Configures if and how to restart containers when they exit. Replaces <a href="/#restart"><code class="highlighter-rouge">restart</code></a>.</p> <ul> <li>
<code class="highlighter-rouge">condition</code>: One of <code class="highlighter-rouge">none</code>, <code class="highlighter-rouge">on-failure</code> or <code class="highlighter-rouge">any</code> (default: <code class="highlighter-rouge">any</code>).</li> <li>
<code class="highlighter-rouge">delay</code>: How long to wait between restart attempts, specified as a <a href="/#specifying-durations">duration</a> (default: 0).</li> <li>
<code class="highlighter-rouge">max_attempts</code>: How many times to attempt to restart a container before giving up (default: never give up).</li> <li> <p><code class="highlighter-rouge">window</code>: How long to wait before deciding if a restart has succeeded, specified as a <a href="/#specifying-durations">duration</a> (default: decide immediately).</p> <p>restart_policy: condition: on-failure delay: 5s max_attempts: 3 window: 120s</p> </li> </ul> <h4 id="labels">labels</h4> <p>Specify labels for the service. These labels will <em>only</em> be set on the service, and <em>not</em> on any containers for the service.</p> <pre class="highlight" data-language="">version: "3"
services:
  web:
    image: web
    deploy:
      labels:
        com.example.description: "This label will appear on the web service"
</pre>  <p>To set labels on containers instead, use the <code class="highlighter-rouge">labels</code> key outside of <code class="highlighter-rouge">deploy</code>:</p> <pre class="highlight" data-language="">version: "3"
services:
  web:
    image: web
    labels:
      com.example.description: "This label will appear on all containers for the web service"
</pre>  <h3 id="devices">devices</h3> <p>List of device mappings. Uses the same format as the <code class="highlighter-rouge">--device</code> docker client create option.</p> <pre class="highlight" data-language="">devices:
  - "/dev/ttyUSB0:/dev/ttyUSB0"
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="dependson">depends_on</h3> <p>Express dependency between services, which has two effects:</p> <ul> <li> <p><code class="highlighter-rouge">docker-compose up</code> will start services in dependency order. In the following example, <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> will be started before <code class="highlighter-rouge">web</code>.</p> </li> <li> <p><code class="highlighter-rouge">docker-compose up SERVICE</code> will automatically include <code class="highlighter-rouge">SERVICE</code>’s dependencies. In the following example, <code class="highlighter-rouge">docker-compose up web</code> will also create and start <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code>.</p> </li> </ul> <p>Simple example:</p> <pre class="highlight" data-language="">version: '2'
services:
  web:
    build: .
    depends_on:
      - db
      - redis
  redis:
    image: redis
  db:
    image: postgres
</pre>  <blockquote> <p><strong>Note:</strong> <code class="highlighter-rouge">depends_on</code> will not wait for <code class="highlighter-rouge">db</code> and <code class="highlighter-rouge">redis</code> to be “ready” before starting <code class="highlighter-rouge">web</code> - only until they have been started. If you need to wait for a service to be ready, see <a href="../startup-order/">Controlling startup order</a> for more on this problem and strategies for solving it.</p> </blockquote> <blockquote> <p><strong><a href="/#version-21">Version 2.1</a> file format only.</strong></p> </blockquote> <p>With Compose 1.10, it is now possible to indicate you want a dependency to wait for another container to be “healthy” (i.e. its healthcheck advertises a successful state) before starting.</p> <p>Example:</p> <pre class="highlight" data-language="">version: '2.1'
services:
  web:
    build: .
    depends_on:
      db:
        condition: service_healthy
      redis:
        condition: service_started
  redis:
    image: redis
  db:
    image: redis
    healthcheck:
      test: "exit 0"
</pre>  <p>In the above example, Compose will wait for the <code class="highlighter-rouge">redis</code> service to be started (legacy behavior) and the <code class="highlighter-rouge">db</code> service to be healthy before starting <code class="highlighter-rouge">web</code>.</p> <p>See the <a href="/#healthcheck">healthcheck section</a> for complementary information.</p> <h3 id="dns">dns</h3> <p>Custom DNS servers. Can be a single value or a list.</p> <pre class="highlight" data-language="">dns: 8.8.8.8
dns:
  - 8.8.8.8
  - 9.9.9.9
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="dnssearch">dns_search</h3> <p>Custom DNS search domains. Can be a single value or a list.</p> <pre class="highlight" data-language="">dns_search: example.com
dns_search:
  - dc1.example.com
  - dc2.example.com
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="tmpfs">tmpfs</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up.</p> </blockquote> <p>Mount a temporary file system inside the container. Can be a single value or a list.</p> <pre class="highlight" data-language="">tmpfs: /run
tmpfs:
  - /run
  - /tmp
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="entrypoint">entrypoint</h3> <p>Override the default entrypoint.</p> <pre class="highlight" data-language="">entrypoint: /code/entrypoint.sh
</pre>  <p>The entrypoint can also be a list, in a manner similar to <a href="../../engine/reference/builder/#entrypoint">dockerfile</a>:</p> <pre class="highlight" data-language="">entrypoint:
    - php
    - -d
    - zend_extension=/usr/local/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so
    - -d
    - memory_limit=-1
    - vendor/bin/phpunit
</pre>  <blockquote> <p><strong>Note:</strong> Setting <code class="highlighter-rouge">entrypoint</code> will both override any default entrypoint set on the service’s image with the <code class="highlighter-rouge">ENTRYPOINT</code> Dockerfile instruction, <em>and</em> clear out any default command on the image - meaning that if there’s a <code class="highlighter-rouge">CMD</code> instruction in the Dockerfile, it will be ignored.</p> </blockquote> <h3 id="envfile">env_file</h3> <p>Add environment variables from a file. Can be a single value or a list.</p> <p>If you have specified a Compose file with <code class="highlighter-rouge">docker-compose -f FILE</code>, paths in <code class="highlighter-rouge">env_file</code> are relative to the directory that file is in.</p> <p>Environment variables specified in <code class="highlighter-rouge">environment</code> override these values.</p> <pre class="highlight" data-language="">env_file: .env

env_file:
  - ./common.env
  - ./apps/web.env
  - /opt/secrets.env
</pre>  <p>Compose expects each line in an env file to be in <code class="highlighter-rouge">VAR=VAL</code> format. Lines beginning with <code class="highlighter-rouge">#</code> (i.e. comments) are ignored, as are blank lines.</p> <pre class="highlight" data-language=""># Set Rails/Rack environment
RACK_ENV=development
</pre>  <blockquote> <p><strong>Note:</strong> If your service specifies a <a href="/#build">build</a> option, variables defined in environment files will <em>not</em> be automatically visible during the build. Use the <a href="/#args">args</a> sub-option of <code class="highlighter-rouge">build</code> to define build-time environment variables.</p> </blockquote> <p>The value of <code class="highlighter-rouge">VAL</code> is used as is and not modified at all. For example if the value is surrounded by quotes (as is often the case of shell variables), the quotes will be included in the value passed to Compose.</p> <h3 id="environment">environment</h3> <p>Add environment variables. You can use either an array or a dictionary. Any boolean values; true, false, yes no, need to be enclosed in quotes to ensure they are not converted to True or False by the YML parser.</p> <p>Environment variables with only a key are resolved to their values on the machine Compose is running on, which can be helpful for secret or host-specific values.</p> <pre class="highlight" data-language="">environment:
  RACK_ENV: development
  SHOW: 'true'
  SESSION_SECRET:

environment:
  - RACK_ENV=development
  - SHOW=true
  - SESSION_SECRET
</pre>  <blockquote> <p><strong>Note:</strong> If your service specifies a <a href="/#build">build</a> option, variables defined in <code class="highlighter-rouge">environment</code> will <em>not</em> be automatically visible during the build. Use the <a href="/#args">args</a> sub-option of <code class="highlighter-rouge">build</code> to define build-time environment variables.</p> </blockquote> <h3 id="expose">expose</h3> <p>Expose ports without publishing them to the host machine - they’ll only be accessible to linked services. Only the internal port can be specified.</p> <pre class="highlight" data-language="">expose:
 - "3000"
 - "8000"
</pre>  <h3 id="extends">extends</h3> <p>Extend another service, in the current file or another, optionally overriding configuration.</p> <p>You can use <code class="highlighter-rouge">extends</code> on any service together with other configuration keys. The <code class="highlighter-rouge">extends</code> value must be a dictionary defined with a required <code class="highlighter-rouge">service</code> and an optional <code class="highlighter-rouge">file</code> key.</p> <pre class="highlight" data-language="">extends:
  file: common.yml
  service: webapp
</pre>  <p>The <code class="highlighter-rouge">service</code> the name of the service being extended, for example <code class="highlighter-rouge">web</code> or <code class="highlighter-rouge">database</code>. The <code class="highlighter-rouge">file</code> is the location of a Compose configuration file defining that service.</p> <p>If you omit the <code class="highlighter-rouge">file</code> Compose looks for the service configuration in the current file. The <code class="highlighter-rouge">file</code> value can be an absolute or relative path. If you specify a relative path, Compose treats it as relative to the location of the current file.</p> <p>You can extend a service that itself extends another. You can extend indefinitely. Compose does not support circular references and <code class="highlighter-rouge">docker-compose</code> returns an error if it encounters one.</p> <p>For more on <code class="highlighter-rouge">extends</code>, see the <a href="../extends/#extending-services">the extends documentation</a>.</p> <blockquote> <p><strong>Note:</strong> This option is not yet supported when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file. Use <code class="highlighter-rouge">docker-compose config</code> to generate a configuration with all <code class="highlighter-rouge">extends</code> options resolved, and deploy from that.</p> </blockquote> <h3 id="externallinks">external_links</h3> <p>Link to containers started outside this <code class="highlighter-rouge">docker-compose.yml</code> or even outside of Compose, especially for containers that provide shared or common services. <code class="highlighter-rouge">external_links</code> follow semantics similar to <code class="highlighter-rouge">links</code> when specifying both the container name and the link alias (<code class="highlighter-rouge">CONTAINER:ALIAS</code>).</p> <pre class="highlight" data-language="">external_links:
 - redis_1
 - project_db_1:mysql
 - project_db_1:postgresql
</pre>  <blockquote> <p><strong>Note:</strong> If you’re using the <a href="/#version-2">version 2 file format</a>, the externally-created containers must be connected to at least one of the same networks as the service which is linking to them.</p> </blockquote> <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="extrahosts">extra_hosts</h3> <p>Add hostname mappings. Use the same values as the docker client <code class="highlighter-rouge">--add-host</code> parameter.</p> <pre class="highlight" data-language="">extra_hosts:
 - "somehost:162.242.195.82"
 - "otherhost:50.31.209.229"
</pre>  <p>An entry with the ip address and hostname will be created in <code class="highlighter-rouge">/etc/hosts</code> inside containers for this service, e.g:</p> <pre class="highlight" data-language="">162.242.195.82  somehost
50.31.209.229   otherhost
</pre>  <h3 id="groupadd">group_add</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up.</p> </blockquote> <p>Specify additional groups (by name or number) which the user inside the container will be a member of. Groups must exist in both the container and the host system to be added. An example of where this is useful is when multiple containers (running as different users) need to all read or write the same file on the host system. That file can be owned by a group shared by all the containers, and specified in <code class="highlighter-rouge">group_add</code>. See the <a href="../../engine/reference/run/#additional-groups">Docker documentation</a> for more details.</p> <p>A full example:</p> <pre class="highlight" data-language="">version: '2'
services:
    image: alpine
    group_add:
      - mail
</pre>  <p>Running <code class="highlighter-rouge">id</code> inside the created container will show that the user belongs to the <code class="highlighter-rouge">mail</code> group, which would not have been the case if <code class="highlighter-rouge">group_add</code> were not used.</p> <h3 id="healthcheck">healthcheck</h3> <blockquote> <p><a href="/#version-21">Version 2.1 file format</a> and up.</p> </blockquote> <p>Configure a check that’s run to determine whether or not containers for this service are “healthy”. See the docs for the <a href="../../engine/reference/builder/#healthcheck">HEALTHCHECK Dockerfile instruction</a> for details on how healthchecks work.</p> <pre class="highlight" data-language="">healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost"]
  interval: 1m30s
  timeout: 10s
  retries: 3
</pre>  <p><code class="highlighter-rouge">interval</code> and <code class="highlighter-rouge">timeout</code> are specified as <a href="/#specifying-durations">durations</a>.</p> <p><code class="highlighter-rouge">test</code> must be either a string or a list. If it’s a list, the first item must be either <code class="highlighter-rouge">NONE</code>, <code class="highlighter-rouge">CMD</code> or <code class="highlighter-rouge">CMD-SHELL</code>. If it’s a string, it’s equivalent to specifying <code class="highlighter-rouge">CMD-SHELL</code> followed by that string.</p> <pre class="highlight" data-language=""># Hit the local web app
test: ["CMD", "curl", "-f", "http://localhost"]

# As above, but wrapped in /bin/sh. Both forms below are equivalent.
test: ["CMD-SHELL", "curl -f http://localhost &amp;&amp; echo 'cool, it works'"]
test: curl -f https://localhost &amp;&amp; echo 'cool, it works'
</pre>  <p>To disable any default healthcheck set by the image, you can use <code class="highlighter-rouge">disable: true</code>. This is equivalent to specifying <code class="highlighter-rouge">test: ["NONE"]</code>.</p> <pre class="highlight" data-language="">healthcheck:
  disable: true
</pre>  <h3 id="image">image</h3> <p>Specify the image to start the container from. Can either be a repository/tag or a partial image ID.</p> <pre class="highlight" data-language="">image: redis
image: ubuntu:14.04
image: tutum/influxdb
image: example-registry.com:4000/postgresql
image: a4bc65fd
</pre>  <p>If the image does not exist, Compose attempts to pull it, unless you have also specified <a href="/#build">build</a>, in which case it builds it using the specified options and tags it with the specified tag.</p> <blockquote> <p><strong>Note</strong>: In the <a href="/#version-1">version 1 file format</a>, using <code class="highlighter-rouge">build</code> together with <code class="highlighter-rouge">image</code> is not allowed. Attempting to do so results in an error.</p> </blockquote> <h3 id="isolation">isolation</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Specify a container’s isolation technology. On Linux, the only supported value is <code class="highlighter-rouge">default</code>. On Windows, acceptable values are <code class="highlighter-rouge">default</code>, <code class="highlighter-rouge">process</code> and <code class="highlighter-rouge">hyperv</code>. Refer to the <a href="../../engine/reference/commandline/run/#specify-isolation-technology-for-container---isolation">Docker Engine docs</a> for details.</p> <h3 id="labels-1">labels</h3> <p>Add metadata to containers using <a href="../../engine/userguide/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <pre class="highlight" data-language="">labels:
  com.example.description: "Accounting webapp"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Accounting webapp"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</pre>  <h3 id="links">links</h3> <p>Link to containers in another service. Either specify both the service name and a link alias (<code class="highlighter-rouge">SERVICE:ALIAS</code>), or just the service name.</p> <pre class="highlight" data-language="">web:
  links:
   - db
   - db:database
   - redis
</pre>  <p>Containers for the linked service will be reachable at a hostname identical to the alias, or the service name if no alias was specified.</p> <p>Links also express dependency between services in the same way as <a href="/#dependson">depends_on</a>, so they determine the order of service startup.</p> <blockquote> <p><strong>Note:</strong> If you define both links and <a href="/#networks">networks</a>, services with links between them must share at least one network in common in order to communicate.</p> </blockquote> <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="logging">logging</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up. In version 1, use <a href="/#log_driver">log_driver</a> and <a href="/#log_opt">log_opt</a>.</p> </blockquote> <p>Logging configuration for the service.</p> <pre class="highlight" data-language="">logging:
  driver: syslog
  options:
    syslog-address: "tcp://192.168.0.42:123"
</pre>  <p>The <code class="highlighter-rouge">driver</code> name specifies a logging driver for the service’s containers, as with the <code class="highlighter-rouge">--log-driver</code> option for docker run (<a href="../../engine/admin/logging/overview/">documented here</a>).</p> <p>The default value is json-file.</p> <pre class="highlight" data-language="">driver: "json-file"
driver: "syslog"
driver: "none"
</pre>  <blockquote> <p><strong>Note:</strong> Only the <code class="highlighter-rouge">json-file</code> and <code class="highlighter-rouge">journald</code> drivers make the logs available directly from <code class="highlighter-rouge">docker-compose up</code> and <code class="highlighter-rouge">docker-compose logs</code>. Using any other driver will not print any logs.</p> </blockquote> <p>Specify logging options for the logging driver with the <code class="highlighter-rouge">options</code> key, as with the <code class="highlighter-rouge">--log-opt</code> option for <code class="highlighter-rouge">docker run</code>.</p> <p>Logging options are key-value pairs. An example of <code class="highlighter-rouge">syslog</code> options:</p> <pre class="highlight" data-language="">driver: "syslog"
options:
  syslog-address: "tcp://192.168.0.42:123"
</pre>  <h3 id="logdriver">log_driver</h3> <blockquote> <p><a href="/#version-1">Version 1 file format</a> only. In version 2, use <a href="/#logging">logging</a>.</p> </blockquote> <p>Specify a log driver. The default is <code class="highlighter-rouge">json-file</code>.</p> <pre class="highlight" data-language="">log_driver: syslog
</pre>  <h3 id="logopt">log_opt</h3> <blockquote> <p><a href="/#version-1">Version 1 file format</a> only. In version 2, use <a href="/#logging">logging</a>.</p> </blockquote> <p>Specify logging options as key-value pairs. An example of <code class="highlighter-rouge">syslog</code> options:</p> <pre class="highlight" data-language="">log_opt:
  syslog-address: "tcp://192.168.0.42:123"
</pre>  <h3 id="net">net</h3> <blockquote> <p><a href="/#version-1">Version 1 file format</a> only. In version 2, use <a href="/#network_mode">network_mode</a>.</p> </blockquote> <p>Network mode. Use the same values as the docker client <code class="highlighter-rouge">--net</code> parameter. The <code class="highlighter-rouge">container:...</code> form can take a service name instead of a container name or id.</p> <pre class="highlight" data-language="">net: "bridge"
net: "host"
net: "none"
net: "container:[service name or container name/id]"
</pre>  <h3 id="networkmode">network_mode</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up. In version 1, use <a href="/#net">net</a>.</p> </blockquote> <p>Network mode. Use the same values as the docker client <code class="highlighter-rouge">--net</code> parameter, plus the special form <code class="highlighter-rouge">service:[service name]</code>.</p> <pre class="highlight" data-language="">network_mode: "bridge"
network_mode: "host"
network_mode: "none"
network_mode: "service:[service name]"
network_mode: "container:[container name/id]"
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="networks">networks</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up. In version 1, use <a href="/#net">net</a>.</p> </blockquote> <p>Networks to join, referencing entries under the <a href="/#network-configuration-reference">top-level <code class="highlighter-rouge">networks</code> key</a>.</p> <pre class="highlight" data-language="">services:
  some-service:
    networks:
     - some-network
     - other-network
</pre>  <h4 id="aliases">aliases</h4> <p>Aliases (alternative hostnames) for this service on the network. Other containers on the same network can use either the service name or this alias to connect to one of the service’s containers.</p> <p>Since <code class="highlighter-rouge">aliases</code> is network-scoped, the same service can have different aliases on different networks.</p> <blockquote> <p><strong>Note</strong>: A network-wide alias can be shared by multiple containers, and even by multiple services. If it is, then exactly which container the name will resolve to is not guaranteed.</p> </blockquote> <p>The general format is shown here.</p> <pre class="highlight" data-language="">services:
  some-service:
    networks:
      some-network:
        aliases:
         - alias1
         - alias3
      other-network:
        aliases:
         - alias2
</pre>  <p>In the example below, three services are provided (<code class="highlighter-rouge">web</code>, <code class="highlighter-rouge">worker</code>, and <code class="highlighter-rouge">db</code>), along with two networks (<code class="highlighter-rouge">new</code> and <code class="highlighter-rouge">legacy</code>). The <code class="highlighter-rouge">db</code> service is reachable at the hostname <code class="highlighter-rouge">db</code> or <code class="highlighter-rouge">database</code> on the <code class="highlighter-rouge">new</code> network, and at <code class="highlighter-rouge">db</code> or <code class="highlighter-rouge">mysql</code> on the <code class="highlighter-rouge">legacy</code> network.</p> <pre class="highlight" data-language="">version: '2'

services:
  web:
    build: ./web
    networks:
      - new

  worker:
    build: ./worker
    networks:
    - legacy

  db:
    image: mysql
    networks:
      new:
        aliases:
          - database
      legacy:
        aliases:
          - mysql

networks:
  new:
  legacy:
</pre>  <h4 id="ipv4address-ipv6address">ipv4_address, ipv6_address</h4> <p>Specify a static IP address for containers for this service when joining the network.</p> <p>The corresponding network configuration in the <a href="/#network-configuration-reference">top-level networks section</a> must have an <code class="highlighter-rouge">ipam</code> block with subnet and gateway configurations covering each static address. If IPv6 addressing is desired, the <a href="/#enableipv6"><code class="highlighter-rouge">enable_ipv6</code></a> option must be set.</p> <p>An example:</p> <pre class="highlight" data-language="">version: '2.1'

services:
  app:
    image: busybox
    command: ifconfig
    networks:
      app_net:
        ipv4_address: 172.16.238.10
        ipv6_address: 2001:3984:3989::10

networks:
  app_net:
    driver: bridge
    enable_ipv6: true
    ipam:
      driver: default
      config:
      - subnet: 172.16.238.0/24
        gateway: 172.16.238.1
      - subnet: 2001:3984:3989::/64
        gateway: 2001:3984:3989::1
</pre>  <h4 id="linklocalips">link_local_ips</h4> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Specify a list of link-local IPs. Link-local IPs are special IPs which belong to a well known subnet and are purely managed by the operator, usually dependent on the architecture where they are deployed. Therefore they are not managed by docker (IPAM driver).</p> <p>Example usage:</p> <pre class="highlight" data-language="">version: '2.1'
services:
  app:
    image: busybox
    command: top
    networks:
      app_net:
        link_local_ips:
          - 57.123.22.11
          - 57.123.22.13
networks:
  app_net:
    driver: bridge
</pre>  <h3 id="pid">pid</h3> <pre class="highlight" data-language="">pid: "host"
</pre>  <p>Sets the PID mode to the host PID mode. This turns on sharing between container and the host operating system the PID address space. Containers launched with this flag will be able to access and manipulate other containers in the bare-metal machine’s namespace and vise-versa.</p> <h3 id="ports">ports</h3> <p>Expose ports. Either specify both ports (<code class="highlighter-rouge">HOST:CONTAINER</code>), or just the container port (a random host port will be chosen).</p> <blockquote> <p><strong>Note:</strong> When mapping ports in the <code class="highlighter-rouge">HOST:CONTAINER</code> format, you may experience erroneous results when using a container port lower than 60, because YAML will parse numbers in the format <code class="highlighter-rouge">xx:yy</code> as sexagesimal (base 60). For this reason, we recommend always explicitly specifying your port mappings as strings.</p> </blockquote> <pre class="highlight" data-language="">ports:
 - "3000"
 - "3000-3005"
 - "8000:8000"
 - "9090-9091:8080-8081"
 - "49100:22"
 - "127.0.0.1:8001:8001"
 - "127.0.0.1:5000-5010:5000-5010"
</pre>  <h3 id="securityopt">security_opt</h3> <p>Override the default labeling scheme for each container.</p> <pre class="highlight" data-language="">security_opt:
  - label:user:USER
  - label:role:ROLE
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="stopgraceperiod">stop_grace_period</h3> <blockquote> <p><a href="/#version-2">Added in version 2 file format</a></p> </blockquote> <p>Specify how long to wait when attempting to stop a container if it doesn’t handle SIGTERM (or whatever stop signal has been specified with <a href="/#stop_signal"><code class="highlighter-rouge">stop_signal</code></a>), before sending SIGKILL. Specified as a <a href="/#specifying-durations">duration</a>.</p> <pre class="highlight" data-language="">stop_grace_period: 1s
stop_grace_period: 1m30s
</pre>  <p>By default, <code class="highlighter-rouge">stop</code> waits 10 seconds for the container to exit before sending SIGKILL.</p> <h3 id="stopsignal">stop_signal</h3> <p>Sets an alternative signal to stop the container. By default <code class="highlighter-rouge">stop</code> uses SIGTERM. Setting an alternative signal using <code class="highlighter-rouge">stop_signal</code> will cause <code class="highlighter-rouge">stop</code> to send that signal instead.</p> <pre class="highlight" data-language="">stop_signal: SIGUSR1
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="sysctls">sysctls</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Kernel parameters to set in the container. You can use either an array or a dictionary.</p> <pre class="highlight" data-language="">sysctls:
  net.core.somaxconn: 1024
  net.ipv4.tcp_syncookies: 0

sysctls:
  - net.core.somaxconn=1024
  - net.ipv4.tcp_syncookies=0
</pre>  <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="ulimits">ulimits</h3> <p>Override the default ulimits for a container. You can either specify a single limit as an integer or soft/hard limits as a mapping.</p> <pre class="highlight" data-language="">ulimits:
  nproc: 65535
  nofile:
    soft: 20000
    hard: 40000
</pre>  <h3 id="usernsmode">userns_mode</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <pre class="highlight" data-language="">userns_mode: "host"
</pre>  <p>Disables the user namespace for this service, if Docker daemon is configured with user namespaces. See <a href="../../engine/reference/commandline/dockerd/#disable-user-namespace-for-a-container">dockerd</a> for more information.</p> <blockquote> <p><strong>Note:</strong> This option is ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h3 id="volumes-volumedriver">volumes, volume_driver</h3> <p>Mount paths or named volumes, optionally specifying a path on the host machine (<code class="highlighter-rouge">HOST:CONTAINER</code>), or an access mode (<code class="highlighter-rouge">HOST:CONTAINER:ro</code>). For <a href="/#version-2">version 2 files</a>, named volumes need to be specified with the <a href="/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> key</a>. When using <a href="/#version-1">version 1</a>, the Docker Engine will create the named volume automatically if it doesn’t exist.</p> <p>You can mount a relative path on the host, which will expand relative to the directory of the Compose configuration file being used. Relative paths should always begin with <code class="highlighter-rouge">.</code> or <code class="highlighter-rouge">..</code>.</p> <pre class="highlight" data-language="">volumes:
  # Just specify a path and let the Engine create a volume
  - /var/lib/mysql

  # Specify an absolute path mapping
  - /opt/data:/var/lib/mysql

  # Path on the host, relative to the Compose file
  - ./cache:/tmp/cache

  # User-relative path
  - ~/configs:/etc/configs/:ro

  # Named volume
  - datavolume:/var/lib/mysql
</pre>  <p>If you do not use a host path, you may specify a <code class="highlighter-rouge">volume_driver</code>.</p> <pre class="highlight" data-language="">volume_driver: mydriver
</pre>  <p>There are several things to note, depending on which <a href="/#versioning">Compose file version</a> you’re using:</p> <ul> <li> <p><code class="highlighter-rouge">volume_driver</code> is not supported at all in <a href="/#version-3">version 3</a>. Instead of setting the volume driver on the service, define a volume using the <a href="/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> option</a> and specify the driver there.</p> </li> <li> <p>You can use <code class="highlighter-rouge">volume_driver</code> in <a href="/#version-2">version 2 files</a>, but it will only apply to anonymous volumes (those specified in the image, or specified under <code class="highlighter-rouge">volumes</code> without an explicit named volume or host path). To configure the driver for a named volume, use the <code class="highlighter-rouge">driver</code> key under the entry in the <a href="/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> option</a>.</p> </li> <li> <p>For <a href="/#version-1">version 1 files</a>, both named volumes and container volumes will use the specified driver.</p> </li> <li> <p>No path expansion will be done if you have also specified a <code class="highlighter-rouge">volume_driver</code>. For example, if you specify a mapping of <code class="highlighter-rouge">./foo:/data</code>, the <code class="highlighter-rouge">./foo</code> part will be passed straight to the volume driver without being expanded.</p> </li> </ul> <p>See <a href="../../engine/tutorials/dockervolumes/">Docker Volumes</a> and <a href="../../engine/extend/plugins_volume/">Volume Plugins</a> for more information.</p> <h3 id="volumesfrom">volumes_from</h3> <blockquote> <p><strong>Removed in <a href="/#version-3">version 3</a>.</strong> The best way to share a volume between services is to use the top-level <a href="/#version-configuration-reference"><code class="highlighter-rouge">volumes</code> option</a> to define a named volume and reference it from each service’s <code class="highlighter-rouge">volumes</code> list.</p> </blockquote> <p>Mount all of the volumes from another service or container, optionally specifying read-only access (<code class="highlighter-rouge">ro</code>) or read-write (<code class="highlighter-rouge">rw</code>). If no access level is specified, then read-write will be used.</p> <pre class="highlight" data-language="">volumes_from:
 - service_name
 - service_name:ro
 - container:container_name
 - container:container_name:rw
</pre>  <blockquote> <p><strong>Note:</strong> The <code class="highlighter-rouge">container:...</code> formats are only supported in the <a href="/#version-2">version 2 file format</a>. In <a href="/#version-1">version 1</a>, you can use container names without marking them as such:</p> <pre class="highlight" data-language="">- service_name
- service_name:ro
- container_name
- container_name:rw
</pre>  </blockquote> <h3 id="cpushares-cpuquota-cpuset-domainname-hostname-ipc-macaddress-memlimit-memswaplimit-oomscoreadj-privileged-readonly-restart-shmsize-stdinopen-tty-user-workingdir">cpu_shares, cpu_quota, cpuset, domainname, hostname, ipc, mac_address, mem_limit, memswap_limit, oom_score_adj, privileged, read_only, restart, shm_size, stdin_open, tty, user, working_dir</h3> <blockquote> <p><strong>Note:</strong> Resource constraint options (<code class="highlighter-rouge">cpu_shares</code>, <code class="highlighter-rouge">cpu_quota</code>, <code class="highlighter-rouge">cpuset</code>, <code class="highlighter-rouge">mem_limit</code>, <code class="highlighter-rouge">memswap_limit</code>) have been removed in <a href="/#version-3">version 3</a>. You should set resource constraints with <a href="/#resources">deploy.resources</a> instead. Note that <code class="highlighter-rouge">deploy</code> configuration only takes effect when using <code class="highlighter-rouge">docker stack deploy</code>, and is ignored by <code class="highlighter-rouge">docker-compose</code>.</p> </blockquote> <p>Each of these is a single value, analogous to its <a href="../../engine/reference/run/">docker run</a> counterpart.</p> <pre class="highlight" data-language="">cpu_shares: 73
cpu_quota: 50000
cpuset: 0,1

user: postgresql
working_dir: /code

domainname: foo.com
hostname: foo
ipc: host
mac_address: 02:42:ac:11:65:43

mem_limit: 1000000000
memswap_limit: 2000000000
privileged: true

oom_score_adj: 500

restart: always

read_only: true
shm_size: 64M
stdin_open: true
tty: true
</pre>  <blockquote> <p><strong>Note:</strong> The following options are only available for <a href="/#version-2">version 2</a> and up: * <code class="highlighter-rouge">oom_score_adj</code></p> </blockquote> <blockquote> <p><strong>Note:</strong> The <code class="highlighter-rouge">domainname</code>, <code class="highlighter-rouge">ipc</code>, <code class="highlighter-rouge">mac_address</code>, <code class="highlighter-rouge">privileged</code>, <code class="highlighter-rouge">read_only</code>, <code class="highlighter-rouge">restart</code> and <code class="highlighter-rouge">shm_size</code> options are ignored when <a href="../../engine/reference/commandline/stack_deploy/">deploying a stack in swarm mode</a> with a (version 3) Compose file.</p> </blockquote> <h2 id="specifying-durations">Specifying durations</h2> <p>Some configuration options, such as the <code class="highlighter-rouge">interval</code> and <code class="highlighter-rouge">timeout</code> sub-options for <a href="/#healthcheck"><code class="highlighter-rouge">healthcheck</code></a>, accept a duration as a string in a format that looks like this:</p> <pre class="highlight" data-language="">2.5s
10s
1m30s
2h32m
5h34m56s
</pre>  <p>The supported units are <code class="highlighter-rouge">us</code>, <code class="highlighter-rouge">ms</code>, <code class="highlighter-rouge">s</code>, <code class="highlighter-rouge">m</code> and <code class="highlighter-rouge">h</code>.</p> <h2 id="volume-configuration-reference">Volume configuration reference</h2> <p>While it is possible to declare volumes on the fly as part of the service declaration, this section allows you to create named volumes that can be reused across multiple services (without relying on <code class="highlighter-rouge">volumes_from</code>), and are easily retrieved and inspected using the docker command line or API. See the <a href="../../engine/reference/commandline/volume_create/">docker volume</a> subcommand documentation for more information.</p> <p>Here’s an example of a two-service setup where a database’s data directory is shared with another service as a volume so that it can be periodically backed up:</p> <pre class="highlight" data-language="">version: "3"

services:
  db:
    image: db
    volumes:
      - data-volume:/var/lib/db
  backup:
    image: backup-service
    volumes:
      - data-volume:/var/lib/backup/data

volumes:
  data-volume:
</pre>  <p>An entry under the top-level <code class="highlighter-rouge">volumes</code> key can be empty, in which case it will use the default driver configured by the Engine (in most cases, this is the <code class="highlighter-rouge">local</code> driver). Optionally, you can configure it with the following keys:</p> <h3 id="driver">driver</h3> <p>Specify which volume driver should be used for this volume. Defaults to whatever driver the Docker Engine has been configured to use, which in most cases is <code class="highlighter-rouge">local</code>. If the driver is not available, the Engine will return an error when <code class="highlighter-rouge">docker-compose up</code> tries to create the volume.</p> <pre class="highlight" data-language=""> driver: foobar
</pre>  <h3 id="driveropts">driver_opts</h3> <p>Specify a list of options as key-value pairs to pass to the driver for this volume. Those options are driver-dependent - consult the driver’s documentation for more information. Optional.</p> <pre class="highlight" data-language=""> driver_opts:
   foo: "bar"
   baz: 1
</pre>  <h3 id="external">external</h3> <p>If set to <code class="highlighter-rouge">true</code>, specifies that this volume has been created outside of Compose. <code class="highlighter-rouge">docker-compose up</code> will not attempt to create it, and will raise an error if it doesn’t exist.</p> <p><code class="highlighter-rouge">external</code> cannot be used in conjunction with other volume configuration keys (<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>).</p> <p>In the example below, instead of attempting to create a volume called <code class="highlighter-rouge">[projectname]_data</code>, Compose will look for an existing volume simply called <code class="highlighter-rouge">data</code> and mount it into the <code class="highlighter-rouge">db</code> service’s containers.</p> <pre class="highlight" data-language="">version: '2'

services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data

volumes:
  data:
    external: true
</pre>  <p>You can also specify the name of the volume separately from the name used to refer to it within the Compose file:</p> <pre class="highlight" data-language="">volumes:
  data:
    external:
      name: actual-name-of-volume
</pre>  <h3 id="labels-2">labels</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Add metadata to containers using <a href="../../engine/userguide/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <pre class="highlight" data-language="">labels:
  com.example.description: "Database volume"
  com.example.department: "IT/Ops"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Database volume"
  - "com.example.department=IT/Ops"
  - "com.example.label-with-empty-value"
</pre>  <h2 id="network-configuration-reference">Network configuration reference</h2> <p>The top-level <code class="highlighter-rouge">networks</code> key lets you specify networks to be created. For a full explanation of Compose’s use of Docker networking features, see the <a href="../networking/">Networking guide</a>.</p> <h3 id="driver-1">driver</h3> <p>Specify which driver should be used for this network.</p> <p>The default driver depends on how the Docker Engine you’re using is configured, but in most instances it will be <code class="highlighter-rouge">bridge</code> on a single host and <code class="highlighter-rouge">overlay</code> on a Swarm.</p> <p>The Docker Engine will return an error if the driver is not available.</p> <pre class="highlight" data-language="">driver: overlay
</pre>  <h3 id="driveropts-1">driver_opts</h3> <p>Specify a list of options as key-value pairs to pass to the driver for this network. Those options are driver-dependent - consult the driver’s documentation for more information. Optional.</p> <pre class="highlight" data-language="">  driver_opts:
    foo: "bar"
    baz: 1
</pre>  <h3 id="enableipv6">enable_ipv6</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Enable IPv6 networking on this network.</p> <h3 id="ipam">ipam</h3> <p>Specify custom IPAM config. This is an object with several properties, each of which is optional:</p> <ul> <li>
<code class="highlighter-rouge">driver</code>: Custom IPAM driver, instead of the default.</li> <li>
<code class="highlighter-rouge">config</code>: A list with zero or more config blocks, each containing any of the following keys: <ul> <li>
<code class="highlighter-rouge">subnet</code>: Subnet in CIDR format that represents a network segment</li> <li>
<code class="highlighter-rouge">ip_range</code>: Range of IPs from which to allocate container IPs</li> <li>
<code class="highlighter-rouge">gateway</code>: IPv4 or IPv6 gateway for the master subnet</li> <li>
<code class="highlighter-rouge">aux_addresses</code>: Auxiliary IPv4 or IPv6 addresses used by Network driver, as a mapping from hostname to IP</li> </ul> </li> </ul> <p>A full example:</p> <pre class="highlight" data-language="">ipam:
  driver: default
  config:
    - subnet: 172.28.0.0/16
      ip_range: 172.28.5.0/24
      gateway: 172.28.5.254
      aux_addresses:
        host1: 172.28.1.5
        host2: 172.28.1.6
        host3: 172.28.1.7
</pre>  <h3 id="internal">internal</h3> <blockquote> <p><a href="/#version-2">Version 2 file format</a> and up.</p> </blockquote> <p>By default, Docker also connects a bridge network to it to provide external connectivity. If you want to create an externally isolated overlay network, you can set this option to <code class="highlighter-rouge">true</code>.</p> <h3 id="labels-3">labels</h3> <blockquote> <p><a href="/#version-21">Added in version 2.1 file format</a>.</p> </blockquote> <p>Add metadata to containers using <a href="../../engine/userguide/labels-custom-metadata/">Docker labels</a>. You can use either an array or a dictionary.</p> <p>It’s recommended that you use reverse-DNS notation to prevent your labels from conflicting with those used by other software.</p> <pre class="highlight" data-language="">labels:
  com.example.description: "Financial transaction network"
  com.example.department: "Finance"
  com.example.label-with-empty-value: ""

labels:
  - "com.example.description=Financial transaction network"
  - "com.example.department=Finance"
  - "com.example.label-with-empty-value"
</pre>  <h3 id="external-1">external</h3> <p>If set to <code class="highlighter-rouge">true</code>, specifies that this network has been created outside of Compose. <code class="highlighter-rouge">docker-compose up</code> will not attempt to create it, and will raise an error if it doesn’t exist.</p> <p><code class="highlighter-rouge">external</code> cannot be used in conjunction with other network configuration keys (<code class="highlighter-rouge">driver</code>, <code class="highlighter-rouge">driver_opts</code>, <code class="highlighter-rouge">group_add</code>, <code class="highlighter-rouge">ipam</code>, <code class="highlighter-rouge">internal</code>).</p> <p>In the example below, <code class="highlighter-rouge">proxy</code> is the gateway to the outside world. Instead of attempting to create a network called <code class="highlighter-rouge">[projectname]_outside</code>, Compose will look for an existing network simply called <code class="highlighter-rouge">outside</code> and connect the <code class="highlighter-rouge">proxy</code> service’s containers to it.</p> <pre class="highlight" data-language="">version: '2'

services:
  proxy:
    build: ./proxy
    networks:
      - outside
      - default
  app:
    build: ./app
    networks:
      - default

networks:
  outside:
    external: true
</pre>  <p>You can also specify the name of the network separately from the name used to refer to it within the Compose file:</p> <pre class="highlight" data-language="">networks:
  outside:
    external:
      name: actual-name-of-network
</pre>  <h2 id="versioning">Versioning</h2> <p>There are currently four versions of the Compose file format:</p> <ul> <li>Version 1, the legacy format. This is specified by omitting a <code class="highlighter-rouge">version</code> key at the root of the YAML.</li> <li>Version 2. This is specified with a <code class="highlighter-rouge">version: '2'</code> entry at the root of the YAML.</li> <li>Version 2.1, an upgrade over version 2 that takes advantage of newer Docker Engine features. Specify with a <code class="highlighter-rouge">version: '2.1'</code> entry at the root of the YAML.</li> <li>Version 3, the latest and recommended version, designed to be cross-compatible between Compose and the Docker Engine’s <a href="../../engine/swarm/">swarm mode</a>.</li> </ul> <p>To move your project to a later version, see the <a href="/#upgrading">Upgrading</a> section.</p> <blockquote> <p><strong>Note:</strong> If you’re using <a href="../extends/#different-environments">multiple Compose files</a> or <a href="../extends/#extending-services">extending services</a>, each file must be of the same version - you cannot, for example, mix version 1 and 2 in a single project.</p> </blockquote> <p>Several things differ depending on which version you use:</p> <ul> <li>The structure and permitted configuration keys</li> <li>The minimum Docker Engine version you must be running</li> <li>Compose’s behaviour with regards to networking</li> </ul> <p>These differences are explained below.</p> <h3 id="version-1">Version 1</h3> <p>Compose files that do not declare a version are considered “version 1”. In those files, all the <a href="/#service-configuration-reference">services</a> are declared at the root of the document.</p> <p>Version 1 is supported by <strong>Compose up to 1.6.x</strong>. It will be deprecated in a future Compose release.</p> <p>Version 1 files cannot declare named <a href="/#volume-configuration-reference">volumes</a>, <a href="../networking/">networks</a> or <a href="/#args">build arguments</a>.</p> <p>Compose does not take advantage of <a href="../networking/">networking</a> when you use version 1: every container is placed on the default <code class="highlighter-rouge">bridge</code> network and is reachable from every other container at its IP address. You will need to use <a href="/#links">links</a> to enable discovery between containers.</p> <p>Example:</p> <pre class="highlight" data-language="">web:
  build: .
  ports:
   - "5000:5000"
  volumes:
   - .:/code
  links:
   - redis
redis:
  image: redis
</pre>  <h3 id="version-2">Version 2</h3> <p>Compose files using the version 2 syntax must indicate the version number at the root of the document. All <a href="/#service-configuration-reference">services</a> must be declared under the <code class="highlighter-rouge">services</code> key.</p> <p>Version 2 files are supported by <strong>Compose 1.6.0+</strong> and require a Docker Engine of version <strong>1.10.0+</strong>.</p> <p>Named <a href="/#volume-configuration-reference">volumes</a> can be declared under the <code class="highlighter-rouge">volumes</code> key, and <a href="/#network-configuration-reference">networks</a> can be declared under the <code class="highlighter-rouge">networks</code> key.</p> <p>By default, every container joins an application-wide default network, and is discoverable at a hostname that’s the same as the service name. This means <a href="/#links">links</a> are largely unnecessary. For more details, see <a href="../networking/">Networking in Compose</a>.</p> <p>Simple example:</p> <pre class="highlight" data-language="">version: '2'
services:
  web:
    build: .
    ports:
     - "5000:5000"
    volumes:
     - .:/code
  redis:
    image: redis
</pre>  <p>A more extended example, defining volumes and networks:</p> <pre class="highlight" data-language="">version: '2'
services:
  web:
    build: .
    ports:
     - "5000:5000"
    volumes:
     - .:/code
    networks:
      - front-tier
      - back-tier
  redis:
    image: redis
    volumes:
      - redis-data:/var/lib/redis
    networks:
      - back-tier
volumes:
  redis-data:
    driver: local
networks:
  front-tier:
    driver: bridge
  back-tier:
    driver: bridge
</pre>  <h3 id="version-21">Version 2.1</h3> <p>An upgrade of <a href="/#version-2">version 2</a> that introduces new parameters only available with Docker Engine version <strong>1.12.0+</strong></p> <p>Introduces the following additional parameters:</p> <ul> <li><a href="/#linklocalips"><code class="highlighter-rouge">link_local_ips</code></a></li> <li><a href="/#isolation"><code class="highlighter-rouge">isolation</code></a></li> <li>
<code class="highlighter-rouge">labels</code> for <a href="/#volume-configuration-reference">volumes</a> and <a href="/#network-configuration-reference">networks</a>
</li> <li><a href="/#userns_mode"><code class="highlighter-rouge">userns_mode</code></a></li> <li>
<a href="/#healthcheck"><code class="highlighter-rouge">healthcheck</code></a>,</li> <li><a href="/#sysctls"><code class="highlighter-rouge">sysctls</code></a></li> </ul> <h3 id="version-3">Version 3</h3> <p>Designed to be cross-compatible between Compose and the Docker Engine’s <a href="../../engine/swarm/">swarm mode</a>, version 3 removes several options and adds several more.</p> <ul> <li> <p>Removed: <code class="highlighter-rouge">volume_driver</code>, <code class="highlighter-rouge">volumes_from</code>, <code class="highlighter-rouge">cpu_shares</code>, <code class="highlighter-rouge">cpu_quota</code>, <code class="highlighter-rouge">cpuset</code>, <code class="highlighter-rouge">mem_limit</code>, <code class="highlighter-rouge">memswap_limit</code>. See the <a href="/#upgrading">upgrading</a> guide for how to migrate away from these.</p> </li> <li> <p>Added: <a href="/#deploy">deploy</a></p> </li> </ul> <h3 id="upgrading">Upgrading</h3> <h4 id="version-2x-to-3x">Version 2.x to 3.x</h4> <p>Between versions 2.x and 3.x, the structure of the Compose file is the same, but several options have been removed:</p> <ul> <li> <p><code class="highlighter-rouge">volume_driver</code>: Instead of setting the volume driver on the service, define a volume using the <a href="/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> option</a> and specify the driver there.</p> <pre class="highlight" data-language="">version: "3"
services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data
volumes:
  data:
    driver: mydriver
</pre>  </li> <li> <p><code class="highlighter-rouge">volumes_from</code>: To share a volume between services, define it using the <a href="/#volume-configuration-reference">top-level <code class="highlighter-rouge">volumes</code> option</a> and reference it from each service that shares it using the <a href="/#volumes-volume-driver">service-level <code class="highlighter-rouge">volumes</code> option</a>.</p> </li> <li> <p><code class="highlighter-rouge">cpu_shares</code>, <code class="highlighter-rouge">cpu_quota</code>, <code class="highlighter-rouge">cpuset</code>, <code class="highlighter-rouge">mem_limit</code>, <code class="highlighter-rouge">memswap_limit</code>: These have been replaced by the <a href="/#resources">resources</a> key under <code class="highlighter-rouge">deploy</code>. Note that <code class="highlighter-rouge">deploy</code> configuration only takes effect when using <code class="highlighter-rouge">docker stack deploy</code>, and is ignored by <code class="highlighter-rouge">docker-compose</code>.</p> </li> </ul> <h4 id="version-1-to-2x">Version 1 to 2.x</h4> <p>In the majority of cases, moving from version 1 to 2 is a very simple process:</p> <ol> <li>Indent the whole file by one level and put a <code class="highlighter-rouge">services:</code> key at the top.</li> <li>Add a <code class="highlighter-rouge">version: '2'</code> line at the top of the file.</li> </ol> <p>It’s more complicated if you’re using particular configuration features:</p> <ul> <li> <p><code class="highlighter-rouge">dockerfile</code>: This now lives under the <code class="highlighter-rouge">build</code> key:</p> <pre class="highlight" data-language="">build:
  context: .
  dockerfile: Dockerfile-alternate
</pre>  </li> <li> <p><code class="highlighter-rouge">log_driver</code>, <code class="highlighter-rouge">log_opt</code>: These now live under the <code class="highlighter-rouge">logging</code> key:</p> <pre class="highlight" data-language="">logging:
  driver: syslog
  options:
    syslog-address: "tcp://192.168.0.42:123"
</pre>  </li> <li> <p><code class="highlighter-rouge">links</code> with environment variables: As documented in the <a href="../link-env-deprecated/">environment variables reference</a>, environment variables created by links have been deprecated for some time. In the new Docker network system, they have been removed. You should either connect directly to the appropriate hostname or set the relevant environment variable yourself, using the link hostname:</p> <pre class="highlight" data-language="">web:
  links:
    - db
  environment:
    - DB_PORT=tcp://db:5432
</pre>  </li> <li> <p><code class="highlighter-rouge">external_links</code>: Compose uses Docker networks when running version 2 projects, so links behave slightly differently. In particular, two containers must be connected to at least one network in common in order to communicate, even if explicitly linked together.</p> <p>Either connect the external container to your app’s <a href="../networking/">default network</a>, or connect both the external container and your service’s containers to an <a href="../networking/#using-a-pre-existing-network">external network</a>.</p> </li> <li> <p><code class="highlighter-rouge">net</code>: This is now replaced by <a href="/#network_mode">network_mode</a>:</p> <pre class="highlight" data-language="">net: host    -&gt;  network_mode: host
net: bridge  -&gt;  network_mode: bridge
net: none    -&gt;  network_mode: none
</pre>  <p>If you’re using <code class="highlighter-rouge">net: "container:[service name]"</code>, you must now use <code class="highlighter-rouge">network_mode: "service:[service name]"</code> instead.</p> <pre class="highlight" data-language="">net: "container:web"  -&gt;  network_mode: "service:web"
</pre>  <p>If you’re using <code class="highlighter-rouge">net: "container:[container name/id]"</code>, the value does not need to change.</p> <pre class="highlight" data-language="">net: "container:cont-name"  -&gt;  network_mode: "container:cont-name"
net: "container:abc12345"   -&gt;  network_mode: "container:abc12345"
</pre>  </li> <li> <p><code class="highlighter-rouge">volumes</code> with named volumes: these must now be explicitly declared in a top-level <code class="highlighter-rouge">volumes</code> section of your Compose file. If a service mounts a named volume called <code class="highlighter-rouge">data</code>, you must declare a <code class="highlighter-rouge">data</code> volume in your top-level <code class="highlighter-rouge">volumes</code> section. The whole file might look like this:</p> <pre class="highlight" data-language="">version: '2'
services:
  db:
    image: postgres
    volumes:
      - data:/var/lib/postgresql/data
volumes:
  data: {}
</pre>  <p>By default, Compose creates a volume whose name is prefixed with your project name. If you want it to just be called <code class="highlighter-rouge">data</code>, declare it as external:</p> <pre class="highlight" data-language="">volumes:
  data:
    external: true
</pre>  </li> </ul> <h2 id="variable-substitution">Variable substitution</h2> <p>Your configuration options can contain environment variables. Compose uses the variable values from the shell environment in which <code class="highlighter-rouge">docker-compose</code> is run. For example, suppose the shell contains <code class="highlighter-rouge">EXTERNAL_PORT=8000</code> and you supply this configuration:</p> <pre class="highlight" data-language="">web:
  build: .
  ports:
    - "${EXTERNAL_PORT}:5000"
</pre>  <p>When you run <code class="highlighter-rouge">docker-compose up</code> with this configuration, Compose looks for the <code class="highlighter-rouge">EXTERNAL_PORT</code> environment variable in the shell and substitutes its value in. In this example, Compose resolves the port mapping to <code class="highlighter-rouge">"8000:5000"</code> before creating the <code class="highlighter-rouge">web</code> container.</p> <p>If an environment variable is not set, Compose substitutes with an empty string. In the example above, if <code class="highlighter-rouge">EXTERNAL_PORT</code> is not set, the value for the port mapping is <code class="highlighter-rouge">:5000</code> (which is of course an invalid port mapping, and will result in an error when attempting to create the container).</p> <p>You can set default values for environment variables using a <a href="../env-file/"><code class="highlighter-rouge">.env</code> file</a>, which Compose will automatically look for. Values set in the shell environment will override those set in the <code class="highlighter-rouge">.env</code> file.</p> <pre class="highlight" data-language="">$ unset EXTERNAL_PORT
$ echo "EXTERNAL_PORT=6000" &gt; .env
$ docker-compose up          # EXTERNAL_PORT will be 6000
$ export EXTERNAL_PORT=7000
$ docker-compose up          # EXTERNAL_PORT will be 7000
</pre>  <p>Both <code class="highlighter-rouge">$VARIABLE</code> and <code class="highlighter-rouge">${VARIABLE}</code> syntax are supported. Additionally when using the <a href="/#version-21">2.1 file format</a>, it is possible to provide inline default values using typical shell syntax:</p> <ul> <li>
<code class="highlighter-rouge">${VARIABLE:-default}</code> will evaluate to <code class="highlighter-rouge">default</code> if <code class="highlighter-rouge">VARIABLE</code> is unset or empty in the environment.</li> <li>
<code class="highlighter-rouge">${VARIABLE-default}</code> will evaluate to <code class="highlighter-rouge">default</code> only if <code class="highlighter-rouge">VARIABLE</code> is unset in the environment.</li> </ul> <p>Other extended shell-style features, such as <code class="highlighter-rouge">${VARIABLE/foo/bar}</code>, are not supported.</p> <p>You can use a <code class="highlighter-rouge">$$</code> (double-dollar sign) when your configuration needs a literal dollar sign. This also prevents Compose from interpolating a value, so a <code class="highlighter-rouge">$$</code> allows you to refer to environment variables that you don’t want processed by Compose.</p> <pre class="highlight" data-language="">web:
  build: .
  command: "$$VAR_NOT_INTERPOLATED_BY_COMPOSE"
</pre>  <p>If you forget and use a single dollar sign (<code class="highlighter-rouge">$</code>), Compose interprets the value as an environment variable and will warn you:</p> <p>The VAR_NOT_INTERPOLATED_BY_COMPOSE is not set. Substituting an empty string.</p> <h2 id="compose-documentation">Compose documentation</h2> <ul> <li><a href="../">User guide</a></li> <li><a href="../install/">Installing Compose</a></li> <li><a href="../django/">Get started with Django</a></li> <li><a href="../rails/">Get started with Rails</a></li> <li><a href="../wordpress/">Get started with WordPress</a></li> <li><a href="https://docs.docker.com/compose/reference/" target="_blank">Command line reference</a></li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © 2013–2016 Docker, Inc.<br>Licensed under the Apache License, Version 2.0.<br>Docker and the Docker logo are trademarks or registered trademarks of Docker, Inc. in the United States and/or other countries.<br>Docker, Inc. and other parties may also have trademark rights in other terms used herein.<br>
    <a href="https://docs.docker.com/compose/compose-file/" class="_attribution-link" target="_blank">https://docs.docker.com/compose/compose-file/</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
