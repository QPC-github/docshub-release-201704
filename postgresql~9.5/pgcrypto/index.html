
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Pgcrypto - PostgreSQL 9.5 - W3cubDocs</title>
  
  <meta name="description" content=" The pgcrypto module provides cryptographic functions for PostgreSQL. ">
  <meta name="keywords" content="f, pgcrypto, -, postgresql, postgresql~9.5">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/postgresql~9.5/pgcrypto/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/postgresql~9.5.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/postgresql~9.5/" class="_nav-link" title="" style="margin-left:0;">PostgreSQL 9.5</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _postgres">
				
<h1 class="SECT1" id="PGCRYPTO">F.24. pgcrypto</h1> <p>The <code class="FILENAME">pgcrypto</code> module provides cryptographic functions for <span class="PRODUCTNAME">PostgreSQL</span>.</p> <div class="SECT2"> <h2 class="SECT2" id="AEN174728">F.24.1. General Hashing Functions</h2> <div class="SECT3"> <h3 class="SECT3" id="AEN174730">F.24.1.1. <code class="FUNCTION">digest()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
digest(data text, type text) returns bytea
digest(data bytea, type text) returns bytea
</pre> <p>Computes a binary hash of the given <code class="PARAMETER">data</code>. <code class="PARAMETER">type</code> is the algorithm to use. Standard algorithms are <code class="LITERAL">md5</code>, <code class="LITERAL">sha1</code>, <code class="LITERAL">sha224</code>, <code class="LITERAL">sha256</code>, <code class="LITERAL">sha384</code> and <code class="LITERAL">sha512</code>. If <code class="FILENAME">pgcrypto</code> was built with OpenSSL, more algorithms are available, as detailed in <a href="../pgcrypto/#PGCRYPTO-WITH-WITHOUT-OPENSSL">Table F-20</a>.</p> <p>If you want the digest as a hexadecimal string, use <code class="FUNCTION">encode()</code> on the result. For example:</p> <pre class="PROGRAMLISTING" data-language="sql">
CREATE OR REPLACE FUNCTION sha1(bytea) returns text AS $$
    SELECT encode(digest($1, 'sha1'), 'hex')
$$ LANGUAGE SQL STRICT IMMUTABLE;
</pre> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN174750">F.24.1.2. <code class="FUNCTION">hmac()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
hmac(data text, key text, type text) returns bytea
hmac(data bytea, key text, type text) returns bytea
</pre> <p>Calculates hashed MAC for <code class="PARAMETER">data</code> with key <code class="PARAMETER">key</code>. <code class="PARAMETER">type</code> is the same as in <code class="FUNCTION">digest()</code>.</p> <p>This is similar to <code class="FUNCTION">digest()</code> but the hash can only be recalculated knowing the key. This prevents the scenario of someone altering data and also changing the hash to match.</p> <p>If the key is larger than the hash block size it will first be hashed and the result will be used as key.</p> </div> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN174764">F.24.2. Password Hashing Functions</h2> <p>The functions <code class="FUNCTION">crypt()</code> and <code class="FUNCTION">gen_salt()</code> are specifically designed for hashing passwords. <code class="FUNCTION">crypt()</code> does the hashing and <code class="FUNCTION">gen_salt()</code> prepares algorithm parameters for it.</p> <p>The algorithms in <code class="FUNCTION">crypt()</code> differ from the usual MD5 or SHA1 hashing algorithms in the following respects:</p> <ol type="1"> <li> <p>They are slow. As the amount of data is so small, this is the only way to make brute-forcing passwords hard.</p> </li> <li> <p>They use a random value, called the <i class="FIRSTTERM">salt</i>, so that users having the same password will have different encrypted passwords. This is also an additional defense against reversing the algorithm.</p> </li> <li> <p>They include the algorithm type in the result, so passwords hashed with different algorithms can co-exist.</p> </li> <li> <p>Some of them are adaptive — that means when computers get faster, you can tune the algorithm to be slower, without introducing incompatibility with existing passwords.</p> </li> </ol> <p><a href="../pgcrypto/#PGCRYPTO-CRYPT-ALGORITHMS">Table F-17</a> lists the algorithms supported by the <code class="FUNCTION">crypt()</code> function.</p> <div class="TABLE" id="PGCRYPTO-CRYPT-ALGORITHMS">  <p class="c2">Table F-17. Supported Algorithms for <code class="FUNCTION">crypt()</code></p> <table class="CALSTABLE"> <col> <col> <col> <col> <col> <col> <thead> <tr> <th>Algorithm</th> <th>Max Password Length</th> <th>Adaptive?</th> <th>Salt Bits</th> <th>Output Length</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="LITERAL">bf</code></td> <td>72</td> <td>yes</td> <td>128</td> <td>60</td> <td>Blowfish-based, variant 2a</td> </tr> <tr> <td><code class="LITERAL">md5</code></td> <td>unlimited</td> <td>no</td> <td>48</td> <td>34</td> <td>MD5-based crypt</td> </tr> <tr> <td><code class="LITERAL">xdes</code></td> <td>8</td> <td>yes</td> <td>24</td> <td>20</td> <td>Extended DES</td> </tr> <tr> <td><code class="LITERAL">des</code></td> <td>8</td> <td>no</td> <td>12</td> <td>13</td> <td>Original UNIX crypt</td> </tr> </tbody> </table> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN174831">F.24.2.1. <code class="FUNCTION">crypt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
crypt(password text, salt text) returns text
</pre> <p>Calculates a crypt(3)-style hash of <code class="PARAMETER">password</code>. When storing a new password, you need to use <code class="FUNCTION">gen_salt()</code> to generate a new <code class="PARAMETER">salt</code> value. To check a password, pass the stored hash value as <code class="PARAMETER">salt</code>, and test whether the result matches the stored value.</p> <p>Example of setting a new password:</p> <pre class="PROGRAMLISTING" data-language="sql">
UPDATE ... SET pswhash = crypt('new password', gen_salt('md5'));
</pre> <p>Example of authentication:</p> <pre class="PROGRAMLISTING" data-language="sql">
SELECT (pswhash = crypt('entered password', pswhash)) AS pswmatch FROM ... ;
</pre> <p>This returns <code class="LITERAL">true</code> if the entered password is correct.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN174847">F.24.2.2. <code class="FUNCTION">gen_salt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
gen_salt(type text [, iter_count integer ]) returns text
</pre> <p>Generates a new random salt string for use in <code class="FUNCTION">crypt()</code>. The salt string also tells <code class="FUNCTION">crypt()</code> which algorithm to use.</p> <p>The <code class="PARAMETER">type</code> parameter specifies the hashing algorithm. The accepted types are: <code class="LITERAL">des</code>, <code class="LITERAL">xdes</code>, <code class="LITERAL">md5</code> and <code class="LITERAL">bf</code>.</p> <p>The <code class="PARAMETER">iter_count</code> parameter lets the user specify the iteration count, for algorithms that have one. The higher the count, the more time it takes to hash the password and therefore the more time to break it. Although with too high a count the time to calculate a hash may be several years — which is somewhat impractical. If the <code class="PARAMETER">iter_count</code> parameter is omitted, the default iteration count is used. Allowed values for <code class="PARAMETER">iter_count</code> depend on the algorithm and are shown in <a href="../pgcrypto/#PGCRYPTO-ICFC-TABLE">Table F-18</a>.</p> <div class="TABLE" id="PGCRYPTO-ICFC-TABLE">  <p class="c2">Table F-18. Iteration Counts for <code class="FUNCTION">crypt()</code></p> <table class="CALSTABLE"> <col> <col> <col> <col> <thead> <tr> <th>Algorithm</th> <th>Default</th> <th>Min</th> <th>Max</th> </tr> </thead> <tbody> <tr> <td><code class="LITERAL">xdes</code></td> <td>725</td> <td>1</td> <td>16777215</td> </tr> <tr> <td><code class="LITERAL">bf</code></td> <td>6</td> <td>4</td> <td>31</td> </tr> </tbody> </table> </div> <p>For <code class="LITERAL">xdes</code> there is an additional limitation that the iteration count must be an odd number.</p> <p>To pick an appropriate iteration count, consider that the original DES crypt was designed to have the speed of 4 hashes per second on the hardware of that time. Slower than 4 hashes per second would probably dampen usability. Faster than 100 hashes per second is probably too fast.</p> <p><a href="../pgcrypto/#PGCRYPTO-HASH-SPEED-TABLE">Table F-19</a> gives an overview of the relative slowness of different hashing algorithms. The table shows how much time it would take to try all combinations of characters in an 8-character password, assuming that the password contains either only lower case letters, or upper- and lower-case letters and numbers. In the <code class="LITERAL">crypt-bf</code> entries, the number after a slash is the <code class="PARAMETER">iter_count</code> parameter of <code class="FUNCTION">gen_salt</code>.</p> <div class="TABLE" id="PGCRYPTO-HASH-SPEED-TABLE">  <p class="c2">Table F-19. Hash Algorithm Speeds</p> <table class="CALSTABLE"> <col> <col> <col> <col> <col> <thead> <tr> <th>Algorithm</th> <th>Hashes/sec</th> <th>For <code class="LITERAL">[a-z]</code>
</th> <th>For <code class="LITERAL">[A-Za-z0-9]</code>
</th> <th>Duration relative to <code class="LITERAL">md5 hash</code>
</th> </tr> </thead> <tbody> <tr> <td><code class="LITERAL">crypt-bf/8</code></td> <td>1792</td> <td>4 years</td> <td>3927 years</td> <td>100k</td> </tr> <tr> <td><code class="LITERAL">crypt-bf/7</code></td> <td>3648</td> <td>2 years</td> <td>1929 years</td> <td>50k</td> </tr> <tr> <td><code class="LITERAL">crypt-bf/6</code></td> <td>7168</td> <td>1 year</td> <td>982 years</td> <td>25k</td> </tr> <tr> <td><code class="LITERAL">crypt-bf/5</code></td> <td>13504</td> <td>188 days</td> <td>521 years</td> <td>12.5k</td> </tr> <tr> <td><code class="LITERAL">crypt-md5</code></td> <td>171584</td> <td>15 days</td> <td>41 years</td> <td>1k</td> </tr> <tr> <td><code class="LITERAL">crypt-des</code></td> <td>23221568</td> <td>157.5 minutes</td> <td>108 days</td> <td>7</td> </tr> <tr> <td><code class="LITERAL">sha1</code></td> <td>37774272</td> <td>90 minutes</td> <td>68 days</td> <td>4</td> </tr> <tr> <td>
<code class="LITERAL">md5</code> (hash)</td> <td>150085504</td> <td>22.5 minutes</td> <td>17 days</td> <td>1</td> </tr> </tbody> </table> </div> <p>Notes:</p> <ul> <li> <p>The machine used is an Intel Mobile Core i3.</p> </li> <li> <p><code class="LITERAL">crypt-des</code> and <code class="LITERAL">crypt-md5</code> algorithm numbers are taken from John the Ripper v1.6.38 <code class="LITERAL">-test</code> output.</p> </li> <li> <p><code class="LITERAL">md5 hash</code> numbers are from mdcrack 1.2.</p> </li> <li> <p><code class="LITERAL">sha1</code> numbers are from lcrack-20031130-beta.</p> </li> <li> <p><code class="LITERAL">crypt-bf</code> numbers are taken using a simple program that loops over 1000 8-character passwords. That way I can show the speed with different numbers of iterations. For reference: <code class="LITERAL">john -test</code> shows 213 loops/sec for <code class="LITERAL">crypt-bf/5</code>. (The very small difference in results is in accordance with the fact that the <code class="LITERAL">crypt-bf</code> implementation in <code class="FILENAME">pgcrypto</code> is the same one used in John the Ripper.)</p> </li> </ul> <p>Note that <span class="QUOTE">"try all combinations"</span> is not a realistic exercise. Usually password cracking is done with the help of dictionaries, which contain both regular words and various mutations of them. So, even somewhat word-like passwords could be cracked much faster than the above numbers suggest, while a 6-character non-word-like password may escape cracking. Or not.</p> </div> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN174992">F.24.3. PGP Encryption Functions</h2> <p>The functions here implement the encryption part of the OpenPGP (RFC 4880) standard. Supported are both symmetric-key and public-key encryption.</p> <p>An encrypted PGP message consists of 2 parts, or <i class="FIRSTTERM">packets</i>:</p> <ul> <li> <p>Packet containing a session key — either symmetric-key or public-key encrypted.</p> </li> <li> <p>Packet containing data encrypted with the session key.</p> </li> </ul> <p>When encrypting with a symmetric key (i.e., a password):</p> <ol type="1"> <li> <p>The given password is hashed using a String2Key (S2K) algorithm. This is rather similar to <code class="FUNCTION">crypt()</code> algorithms — purposefully slow and with random salt — but it produces a full-length binary key.</p> </li> <li> <p>If a separate session key is requested, a new random key will be generated. Otherwise the S2K key will be used directly as the session key.</p> </li> <li> <p>If the S2K key is to be used directly, then only S2K settings will be put into the session key packet. Otherwise the session key will be encrypted with the S2K key and put into the session key packet.</p> </li> </ol> <p>When encrypting with a public key:</p> <ol type="1"> <li> <p>A new random session key is generated.</p> </li> <li> <p>It is encrypted using the public key and put into the session key packet.</p> </li> </ol> <p>In either case the data to be encrypted is processed as follows:</p> <ol type="1"> <li> <p>Optional data-manipulation: compression, conversion to UTF-8, and/or conversion of line-endings.</p> </li> <li> <p>The data is prefixed with a block of random bytes. This is equivalent to using a random IV.</p> </li> <li> <p>An SHA1 hash of the random prefix and data is appended.</p> </li> <li> <p>All this is encrypted with the session key and placed in the data packet.</p> </li> </ol> <div class="SECT3"> <h3 class="SECT3" id="AEN175027">F.24.3.1. <code class="FUNCTION">pgp_sym_encrypt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_sym_encrypt(data text, psw text [, options text ]) returns bytea
pgp_sym_encrypt_bytea(data bytea, psw text [, options text ]) returns bytea
</pre> <p>Encrypt <code class="PARAMETER">data</code> with a symmetric PGP key <code class="PARAMETER">psw</code>. The <code class="PARAMETER">options</code> parameter can contain option settings, as described below.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175039">F.24.3.2. <code class="FUNCTION">pgp_sym_decrypt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_sym_decrypt(msg bytea, psw text [, options text ]) returns text
pgp_sym_decrypt_bytea(msg bytea, psw text [, options text ]) returns bytea
</pre> <p>Decrypt a symmetric-key-encrypted PGP message.</p> <p>Decrypting <code class="TYPE">bytea</code> data with <code class="FUNCTION">pgp_sym_decrypt</code> is disallowed. This is to avoid outputting invalid character data. Decrypting originally textual data with <code class="FUNCTION">pgp_sym_decrypt_bytea</code> is fine.</p> <p>The <code class="PARAMETER">options</code> parameter can contain option settings, as described below.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175054">F.24.3.3. <code class="FUNCTION">pgp_pub_encrypt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_pub_encrypt(data text, key bytea [, options text ]) returns bytea
pgp_pub_encrypt_bytea(data bytea, key bytea [, options text ]) returns bytea
</pre> <p>Encrypt <code class="PARAMETER">data</code> with a public PGP key <code class="PARAMETER">key</code>. Giving this function a secret key will produce an error.</p> <p>The <code class="PARAMETER">options</code> parameter can contain option settings, as described below.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175067">F.24.3.4. <code class="FUNCTION">pgp_pub_decrypt()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_pub_decrypt(msg bytea, key bytea [, psw text [, options text ]]) returns text
pgp_pub_decrypt_bytea(msg bytea, key bytea [, psw text [, options text ]]) returns bytea
</pre> <p>Decrypt a public-key-encrypted message. <code class="PARAMETER">key</code> must be the secret key corresponding to the public key that was used to encrypt. If the secret key is password-protected, you must give the password in <code class="PARAMETER">psw</code>. If there is no password, but you want to specify options, you need to give an empty password.</p> <p>Decrypting <code class="TYPE">bytea</code> data with <code class="FUNCTION">pgp_pub_decrypt</code> is disallowed. This is to avoid outputting invalid character data. Decrypting originally textual data with <code class="FUNCTION">pgp_pub_decrypt_bytea</code> is fine.</p> <p>The <code class="PARAMETER">options</code> parameter can contain option settings, as described below.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175084">F.24.3.5. <code class="FUNCTION">pgp_key_id()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_key_id(bytea) returns text
</pre> <p><code class="FUNCTION">pgp_key_id</code> extracts the key ID of a PGP public or secret key. Or it gives the key ID that was used for encrypting the data, if given an encrypted message.</p> <p>It can return 2 special key IDs:</p> <ul> <li> <p><code class="LITERAL">SYMKEY</code></p> <p>The message is encrypted with a symmetric key.</p> </li> <li> <p><code class="LITERAL">ANYKEY</code></p> <p>The message is public-key encrypted, but the key ID has been removed. That means you will need to try all your secret keys on it to see which one decrypts it. <code class="FILENAME">pgcrypto</code> itself does not produce such messages.</p> </li> </ul> <p>Note that different keys may have the same ID. This is rare but a normal event. The client application should then try to decrypt with each one, to see which fits — like handling <code class="LITERAL">ANYKEY</code>.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175105">F.24.3.6. <code class="FUNCTION">armor()</code>, <code class="FUNCTION">dearmor()</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
armor(data bytea [ , keys text[], values text[] ]) returns text
dearmor(data text) returns bytea
</pre> <p>These functions wrap/unwrap binary data into PGP ASCII-armor format, which is basically Base64 with CRC and additional formatting.</p> <p>If the <code class="PARAMETER">keys</code> and <code class="PARAMETER">values</code> arrays are specified, an <i class="FIRSTTERM">armor header</i> is added to the armored format for each key/value pair. Both arrays must be single-dimensional, and they must be of the same length. The keys and values cannot contain any non-ASCII characters.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175119">F.24.3.7. <code class="FUNCTION">pgp_armor_headers</code>
</h3> <pre class="SYNOPSIS" data-language="sql">
pgp_armor_headers(data text, key out text, value out text) returns setof record
</pre> <p><code class="FUNCTION">pgp_armor_headers()</code> extracts the armor headers from <code class="PARAMETER">data</code>. The return value is a set of rows with two columns, key and value. If the keys or values contain any non-ASCII characters, they are treated as UTF-8.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175128">F.24.3.8. Options for PGP Functions</h3> <p>Options are named to be similar to GnuPG. An option's value should be given after an equal sign; separate options from each other with commas. For example:</p> <pre class="PROGRAMLISTING" data-language="sql">
pgp_sym_encrypt(data, psw, 'compress-algo=1, cipher-algo=aes256')
</pre> <p>All of the options except <code class="LITERAL">convert-crlf</code> apply only to encrypt functions. Decrypt functions get the parameters from the PGP data.</p> <p>The most interesting options are probably <code class="LITERAL">compress-algo</code> and <code class="LITERAL">unicode-mode</code>. The rest should have reasonable defaults.</p> <div class="SECT4"> <h4 class="SECT4" id="AEN175137">F.24.3.8.1. cipher-algo</h4> <p>Which cipher algorithm to use.</p> <p class="LITERALLAYOUT"> Values: bf, aes128, aes192, aes256 (OpenSSL-only: <code class="LITERAL">3des</code>, <code class="LITERAL">cast5</code>)<br> Default: aes128<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175143">F.24.3.8.2. compress-algo</h4> <p>Which compression algorithm to use. Only available if <span class="PRODUCTNAME">PostgreSQL</span> was built with zlib.</p> <p class="LITERALLAYOUT">Values:<br> 0 - no compression<br> 1 - ZIP compression<br> 2 - ZLIB compression (= ZIP plus meta-data and block CRCs)<br> Default: 0<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175148">F.24.3.8.3. compress-level</h4> <p>How much to compress. Higher levels compress smaller but are slower. 0 disables compression.</p> <p class="LITERALLAYOUT">Values: 0, 1-9<br> Default: 6<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175152">F.24.3.8.4. convert-crlf</h4> <p>Whether to convert <code class="LITERAL">\n</code> into <code class="LITERAL">\r\n</code> when encrypting and <code class="LITERAL">\r\n</code> to <code class="LITERAL">\n</code> when decrypting. RFC 4880 specifies that text data should be stored using <code class="LITERAL">\r\n</code> line-feeds. Use this to get fully RFC-compliant behavior.</p> <p class="LITERALLAYOUT">Values: 0, 1<br> Default: 0<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt, pgp_sym_decrypt, pgp_pub_decrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175161">F.24.3.8.5. disable-mdc</h4> <p>Do not protect data with SHA-1. The only good reason to use this option is to achieve compatibility with ancient PGP products, predating the addition of SHA-1 protected packets to RFC 4880. Recent gnupg.org and pgp.com software supports it fine.</p> <p class="LITERALLAYOUT">Values: 0, 1<br> Default: 0<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175165">F.24.3.8.6. sess-key</h4> <p>Use separate session key. Public-key encryption always uses a separate session key; this option is for symmetric-key encryption, which by default uses the S2K key directly.</p> <p class="LITERALLAYOUT">Values: 0, 1<br> Default: 0<br> Applies to: pgp_sym_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175169">F.24.3.8.7. s2k-mode</h4> <p>Which S2K algorithm to use.</p> <p class="LITERALLAYOUT">Values:<br> 0 - Without salt. Dangerous!<br> 1 - With salt but with fixed iteration count.<br> 3 - Variable iteration count.<br> Default: 3<br> Applies to: pgp_sym_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175173">F.24.3.8.8. s2k-digest-algo</h4> <p>Which digest algorithm to use in S2K calculation.</p> <p class="LITERALLAYOUT">Values: md5, sha1<br> Default: sha1<br> Applies to: pgp_sym_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175177">F.24.3.8.9. s2k-cipher-algo</h4> <p>Which cipher to use for encrypting separate session key.</p> <p class="LITERALLAYOUT"> Values: bf, aes, aes128, aes192, aes256<br> Default: use cipher-algo<br> Applies to: pgp_sym_encrypt</p> </div> <div class="SECT4"> <h4 class="SECT4" id="AEN175181">F.24.3.8.10. unicode-mode</h4> <p>Whether to convert textual data from database internal encoding to UTF-8 and back. If your database already is UTF-8, no conversion will be done, but the message will be tagged as UTF-8. Without this option it will not be.</p> <p class="LITERALLAYOUT">Values: 0, 1<br> Default: 0<br> Applies to: pgp_sym_encrypt, pgp_pub_encrypt</p> </div> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175185">F.24.3.9. Generating PGP Keys with GnuPG</h3> <p>To generate a new key:</p> <pre class="PROGRAMLISTING" data-language="sql">
gpg --gen-key
</pre> <p>The preferred key type is <span class="QUOTE">"DSA and Elgamal"</span>.</p> <p>For RSA encryption you must create either DSA or RSA sign-only key as master and then add an RSA encryption subkey with <code class="LITERAL">gpg --edit-key</code>.</p> <p>To list keys:</p> <pre class="PROGRAMLISTING" data-language="sql">
gpg --list-secret-keys
</pre> <p>To export a public key in ASCII-armor format:</p> <pre class="PROGRAMLISTING" data-language="sql">
gpg -a --export KEYID &gt; public.key
</pre> <p>To export a secret key in ASCII-armor format:</p> <pre class="PROGRAMLISTING" data-language="sql">
gpg -a --export-secret-keys KEYID &gt; secret.key
</pre> <p>You need to use <code class="FUNCTION">dearmor()</code> on these keys before giving them to the PGP functions. Or if you can handle binary data, you can drop <code class="LITERAL">-a</code> from the command.</p> <p>For more details see <code class="LITERAL">man gpg</code>, <a href="http://www.gnupg.org/gph/en/manual.html" target="_blank">The GNU Privacy Handbook</a> and other documentation on <a href="http://www.gnupg.org" target="_blank">http://www.gnupg.org</a>.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175206">F.24.3.10. Limitations of PGP Code</h3> <ul> <li> <p>No support for signing. That also means that it is not checked whether the encryption subkey belongs to the master key.</p> </li> <li> <p>No support for encryption key as master key. As such practice is generally discouraged, this should not be a problem.</p> </li> <li> <p>No support for several subkeys. This may seem like a problem, as this is common practice. On the other hand, you should not use your regular GPG/PGP keys with <code class="FILENAME">pgcrypto</code>, but create new ones, as the usage scenario is rather different.</p> </li> </ul> </div> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN175216">F.24.4. Raw Encryption Functions</h2> <p>These functions only run a cipher over data; they don't have any advanced features of PGP encryption. Therefore they have some major problems:</p> <ol type="1"> <li> <p>They use user key directly as cipher key.</p> </li> <li> <p>They don't provide any integrity checking, to see if the encrypted data was modified.</p> </li> <li> <p>They expect that users manage all encryption parameters themselves, even IV.</p> </li> <li> <p>They don't handle text.</p> </li> </ol> <p>So, with the introduction of PGP encryption, usage of raw encryption functions is discouraged.</p> <pre class="SYNOPSIS" data-language="sql">
encrypt(data bytea, key bytea, type text) returns bytea
decrypt(data bytea, key bytea, type text) returns bytea

encrypt_iv(data bytea, key bytea, iv bytea, type text) returns bytea
decrypt_iv(data bytea, key bytea, iv bytea, type text) returns bytea
</pre> <p>Encrypt/decrypt data using the cipher method specified by <code class="PARAMETER">type</code>. The syntax of the <code class="PARAMETER">type</code> string is:</p> <pre class="SYNOPSIS" data-language="sql">
algorithm [ - mode ] [ /pad: padding ]
</pre> <p>where <code class="REPLACEABLE c3">algorithm</code> is one of:</p> <ul> <li> <p><code class="LITERAL">bf</code> — Blowfish</p> </li> <li> <p><code class="LITERAL">aes</code> — AES (Rijndael-128)</p> </li> </ul> <p>and <code class="REPLACEABLE c3">mode</code> is one of:</p> <ul> <li> <p><code class="LITERAL">cbc</code> — next block depends on previous (default)</p> </li> <li> <p><code class="LITERAL">ecb</code> — each block is encrypted separately (for testing only)</p> </li> </ul> <p>and <code class="REPLACEABLE c3">padding</code> is one of:</p> <ul> <li> <p><code class="LITERAL">pkcs</code> — data may be any length (default)</p> </li> <li> <p><code class="LITERAL">none</code> — data must be multiple of cipher block size</p> </li> </ul> <p>So, for example, these are equivalent:</p> <pre class="PROGRAMLISTING" data-language="sql">
encrypt(data, 'fooz', 'bf')
encrypt(data, 'fooz', 'bf-cbc/pad:pkcs')
</pre> <p>In <code class="FUNCTION">encrypt_iv</code> and <code class="FUNCTION">decrypt_iv</code>, the <code class="PARAMETER">iv</code> parameter is the initial value for the CBC mode; it is ignored for ECB. It is clipped or padded with zeroes if not exactly block size. It defaults to all zeroes in the functions without this parameter.</p> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN175279">F.24.5. Random-Data Functions</h2> <pre class="SYNOPSIS" data-language="sql">
gen_random_bytes(count integer) returns bytea
</pre> <p>Returns <code class="PARAMETER">count</code> cryptographically strong random bytes. At most 1024 bytes can be extracted at a time. This is to avoid draining the randomness generator pool.</p> <pre class="SYNOPSIS" data-language="sql">
gen_random_uuid() returns uuid
</pre> <p>Returns a version 4 (random) UUID.</p> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN175290">F.24.6. Notes</h2> <div class="SECT3"> <h3 class="SECT3" id="AEN175292">F.24.6.1. Configuration</h3> <p><code class="FILENAME">pgcrypto</code> configures itself according to the findings of the main PostgreSQL <code class="LITERAL">configure</code> script. The options that affect it are <code class="LITERAL">--with-zlib</code> and <code class="LITERAL">--with-openssl</code>.</p> <p>When compiled with zlib, PGP encryption functions are able to compress data before encrypting.</p> <p>When compiled with OpenSSL, there will be more algorithms available. Also public-key encryption functions will be faster as OpenSSL has more optimized BIGNUM functions.</p> <div class="TABLE" id="PGCRYPTO-WITH-WITHOUT-OPENSSL">  <p class="c2">Table F-20. Summary of Functionality with and without OpenSSL</p> <table class="CALSTABLE"> <col> <col> <col> <thead> <tr> <th>Functionality</th> <th>Built-in</th> <th>With OpenSSL</th> </tr> </thead> <tbody> <tr> <td>MD5</td> <td>yes</td> <td>yes</td> </tr> <tr> <td>SHA1</td> <td>yes</td> <td>yes</td> </tr> <tr> <td>SHA224/256/384/512</td> <td>yes</td> <td>yes (Note 1)</td> </tr> <tr> <td>Other digest algorithms</td> <td>no</td> <td>yes (Note 2)</td> </tr> <tr> <td>Blowfish</td> <td>yes</td> <td>yes</td> </tr> <tr> <td>AES</td> <td>yes</td> <td>yes (Note 3)</td> </tr> <tr> <td>DES/3DES/CAST5</td> <td>no</td> <td>yes</td> </tr> <tr> <td>Raw encryption</td> <td>yes</td> <td>yes</td> </tr> <tr> <td>PGP Symmetric encryption</td> <td>yes</td> <td>yes</td> </tr> <tr> <td>PGP Public-Key encryption</td> <td>yes</td> <td>yes</td> </tr> </tbody> </table> </div> <p>Notes:</p> <ol type="1"> <li> <p>SHA2 algorithms were added to OpenSSL in version 0.9.8. For older versions, <code class="FILENAME">pgcrypto</code> will use built-in code.</p> </li> <li> <p>Any digest algorithm OpenSSL supports is automatically picked up. This is not possible with ciphers, which need to be supported explicitly.</p> </li> <li> <p>AES is included in OpenSSL since version 0.9.7. For older versions, <code class="FILENAME">pgcrypto</code> will use built-in code.</p> </li> </ol> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175360">F.24.6.2. NULL Handling</h3> <p>As is standard in SQL, all functions return NULL, if any of the arguments are NULL. This may create security risks on careless usage.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175363">F.24.6.3. Security Limitations</h3> <p>All <code class="FILENAME">pgcrypto</code> functions run inside the database server. That means that all the data and passwords move between <code class="FILENAME">pgcrypto</code> and client applications in clear text. Thus you must:</p> <ol type="1"> <li> <p>Connect locally or use SSL connections.</p> </li> <li> <p>Trust both system and database administrator.</p> </li> </ol> <p>If you cannot, then better do crypto inside client application.</p> <p>The implementation does not resist <a href="http://en.wikipedia.org/wiki/Side-channel_attack" target="_blank">side-channel attacks</a>. For example, the time required for a <code class="FILENAME">pgcrypto</code> decryption function to complete varies among ciphertexts of a given size.</p> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175377">F.24.6.4. Useful Reading</h3> <ul> <li> <p><a href="http://www.gnupg.org/gph/en/manual.html" target="_blank">http://www.gnupg.org/gph/en/manual.html</a></p> <p>The GNU Privacy Handbook.</p> </li> <li> <p><a href="http://www.openwall.com/crypt/" target="_blank">http://www.openwall.com/crypt/</a></p> <p>Describes the crypt-blowfish algorithm.</p> </li> <li> <p><a href="http://www.stack.nl/~galactus/remailers/passphrase-faq.html" target="_blank">http://www.stack.nl/~galactus/remailers/passphrase-faq.html</a></p> <p>How to choose a good password.</p> </li> <li> <p><a href="http://world.std.com/~reinhold/diceware.html" target="_blank">http://world.std.com/~reinhold/diceware.html</a></p> <p>Interesting idea for picking passwords.</p> </li> <li> <p><a href="http://www.interhack.net/people/cmcurtin/snake-oil-faq.html" target="_blank">http://www.interhack.net/people/cmcurtin/snake-oil-faq.html</a></p> <p>Describes good and bad cryptography.</p> </li> </ul> </div> <div class="SECT3"> <h3 class="SECT3" id="AEN175400">F.24.6.5. Technical References</h3> <ul> <li> <p><a href="http://www.ietf.org/rfc/rfc4880.txt" target="_blank">http://www.ietf.org/rfc/rfc4880.txt</a></p> <p>OpenPGP message format.</p> </li> <li> <p><a href="http://www.ietf.org/rfc/rfc1321.txt" target="_blank">http://www.ietf.org/rfc/rfc1321.txt</a></p> <p>The MD5 Message-Digest Algorithm.</p> </li> <li> <p><a href="http://www.ietf.org/rfc/rfc2104.txt" target="_blank">http://www.ietf.org/rfc/rfc2104.txt</a></p> <p>HMAC: Keyed-Hashing for Message Authentication.</p> </li> <li> <p><a href="http://www.usenix.org/events/usenix99/provos.html" target="_blank">http://www.usenix.org/events/usenix99/provos.html</a></p> <p>Comparison of crypt-des, crypt-md5 and bcrypt algorithms.</p> </li> <li> <p><a href="http://en.wikipedia.org/wiki/Fortuna_(PRNG)" target="_blank">http://en.wikipedia.org/wiki/Fortuna_(PRNG)</a></p> <p>Description of Fortuna CSPRNG.</p> </li> <li> <p><a href="http://jlcooke.ca/random/" target="_blank">http://jlcooke.ca/random/</a></p> <p>Jean-Luc Cooke Fortuna-based <code class="FILENAME">/dev/random</code> driver for Linux.</p> </li> <li> <p><a href="http://research.cyber.ee/~lipmaa/crypto/" target="_blank">http://research.cyber.ee/~lipmaa/crypto/</a></p> <p>Collection of cryptology pointers.</p> </li> </ul> </div> </div> <div class="SECT2"> <h2 class="SECT2" id="AEN175432">F.24.7. Author</h2> <p>Marko Kreen <code class="EMAIL">&lt;<a href="../mailto:markokr@gmail.com/">markokr@gmail.com</a>&gt;</code></p> <p><code class="FILENAME">pgcrypto</code> uses code from the following sources:</p> <div class="INFORMALTABLE" id="AEN175438">  <table class="CALSTABLE"> <col> <col> <col> <thead> <tr> <th>Algorithm</th> <th>Author</th> <th>Source origin</th> </tr> </thead> <tbody> <tr> <td>DES crypt</td> <td>David Burren and others</td> <td>FreeBSD libcrypt</td> </tr> <tr> <td>MD5 crypt</td> <td>Poul-Henning Kamp</td> <td>FreeBSD libcrypt</td> </tr> <tr> <td>Blowfish crypt</td> <td>Solar Designer</td> <td>www.openwall.com</td> </tr> <tr> <td>Blowfish cipher</td> <td>Simon Tatham</td> <td>PuTTY</td> </tr> <tr> <td>Rijndael cipher</td> <td>Brian Gladman</td> <td>OpenBSD sys/crypto</td> </tr> <tr> <td>MD5 hash and SHA1</td> <td>WIDE Project</td> <td>KAME kame/sys/crypto</td> </tr> <tr> <td>SHA256/384/512</td> <td>Aaron D. Gifford</td> <td>OpenBSD sys/crypto</td> </tr> <tr> <td>BIGNUM math</td> <td>Michael J. Fromberger</td> <td>dartmouth.edu/~sting/sw/imath</td> </tr> </tbody> </table> </div> </div>  <div class="NAVFOOTER">  <table summary="Footer navigation table"> <tr> <td width="33%" align="left"><a href="../pgbuffercache/" accesskey="P">Prev</a></td> <td width="34%" align="center"></td> <td width="33%" align="right"><a href="../pgfreespacemap/" accesskey="N">Next</a></td> </tr> <tr> <td width="33%" align="left">pg_buffercache</td> <td width="34%" align="center"><a href="https://www.postgresql.org/docs/9.5/static/contrib.html" accesskey="U" target="_blank">Up</a></td> <td width="33%" align="right"> pg_freespacemap</td> </tr> </table> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 1996–2017 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/9.5/static/pgcrypto.html" class="_attribution-link" target="_blank">https://www.postgresql.org/docs/9.5/static/pgcrypto.html</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
