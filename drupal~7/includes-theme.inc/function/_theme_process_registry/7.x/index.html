
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>_theme_process_registry - Drupal 7 - W3cubDocs</title>
  
  <meta name="description" content=" Process a single implementation of hook_theme(). ">
  <meta name="keywords" content="function, theme, process, registry, -, drupal, drupal~7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/drupal~7/includes-theme.inc/function/_theme_process_registry/7.x/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/drupal~7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/drupal~7/" class="_nav-link" title="" style="margin-left:0;">Drupal 7</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _drupal">
				
<h1 id="page-subtitle">function _theme_process_registry</h1>     <pre class="signature">_theme_process_registry(&amp;$cache, $name, $type, $theme, $path)</pre> <p>Process a single implementation of <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>().</p> <h3>Parameters</h3> <p> <strong>$cache</strong>: The theme registry that will eventually be cached; It is an associative array keyed by theme hooks, whose values are associative arrays describing the hook:</p> <ul> <li>
<strong>'type'</strong>: The passed-in $type.</li> <li>
<strong>'theme path'</strong>: The passed-in $path.</li> <li>
<strong>'function'</strong>: The name of the function generating output for this theme hook. Either defined explicitly in <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>() or, if neither 'function' nor 'template' is defined, then the default theme function name is used. The default theme function name is the theme hook prefixed by either 'theme_' for modules or '$name_' for everything else. If 'function' is defined, 'template' is not used.</li> <li>
<strong>'template'</strong>: The filename of the template generating output for this theme hook. The template is in the directory defined by the 'path' key of <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>() or defaults to $path.</li> <li>
<strong>'variables'</strong>: The variables for this theme hook as defined in <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>(). If there is more than one implementation and 'variables' is not specified in a later one, then the previous definition is kept.</li> <li>
<strong>'render element'</strong>: The renderable element for this theme hook as defined in <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>(). If there is more than one implementation and 'render element' is not specified in a later one, then the previous definition is kept.</li> <li>
<strong>'preprocess functions'</strong>: See <a href="../../theme/7.x/" title="Generates themed output." class="local">theme</a>() for detailed documentation.</li> <li>
<strong>'process functions'</strong>: See <a href="../../theme/7.x/" title="Generates themed output." class="local">theme</a>() for detailed documentation.</li> </ul> <p><strong>$name</strong>: The name of the module, theme engine, base theme engine, theme or base theme implementing <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>().</p> <p><strong>$type</strong>: One of 'module', 'theme_engine', 'base_theme_engine', 'theme', or 'base_theme'. Unlike regular hooks that can only be implemented by modules, each of these can implement <a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>(). <a href="../7.x/" title="Process a single implementation of hook_theme()." class="local active">_theme_process_registry</a>() is called in aforementioned order and new entries override older ones. For example, if a theme hook is both defined by a module and a theme, then the definition in the theme will be used.</p> <p><strong>$theme</strong>: The loaded $theme object as returned from <a href="../../list_themes/7.x/" title="Returns a list of all currently available themes." class="local">list_themes</a>().</p> <p><strong>$path</strong>: The directory where $name is. For example, modules/system or themes/bartik.</p> <h3>See also</h3> <p> <a href="../../theme/7.x/" title="Generates themed output." class="local">theme</a>()</p> <p><a href="../../_theme_build_registry/7.x/" title="Builds the theme registry cache." class="local">_theme_build_registry</a>()</p> <p><a href="../../../../modules-system-system.api.php/function/hook_theme/7.x/" title="Register a module (or theme's) theme implementations." class="local">hook_theme</a>()</p> <p><a href="../../list_themes/7.x/" title="Returns a list of all currently available themes." class="local">list_themes</a>()</p>  <h3>File</h3> 
<dl> <dt>includes/<a href="../../../7.x/">theme.inc</a>, line 515</dt> <dd>The theme system, which controls the output of Drupal.</dd> </dl> <h3>Code</h3> <pre class="php" data-language="php">function _theme_process_registry(&amp;$cache, $name, $type, $theme, $path) {
  $result = array();

  // Processor functions work in two distinct phases with the process
  // functions always being executed after the preprocess functions.
  $variable_process_phases = array(
    'preprocess functions' =&gt; 'preprocess',
    'process functions' =&gt; 'process',
  );

  $hook_defaults = array(
    'variables' =&gt; TRUE,
    'render element' =&gt; TRUE,
    'pattern' =&gt; TRUE,
    'base hook' =&gt; TRUE,
  );

  // Invoke the hook_theme() implementation, process what is returned, and
  // merge it into $cache.
  $function = $name . '_theme';
  if (function_exists($function)) {
    $result = $function($cache, $type, $theme, $path);
    foreach ($result as $hook =&gt; $info) {
      // When a theme or engine overrides a module's theme function
      // $result[$hook] will only contain key/value pairs for information being
      // overridden.  Pull the rest of the information from what was defined by
      // an earlier hook.

      // Fill in the type and path of the module, theme, or engine that
      // implements this theme function.
      $result[$hook]['type'] = $type;
      $result[$hook]['theme path'] = $path;

      // If function and file are omitted, default to standard naming
      // conventions.
      if (!isset($info['template']) &amp;&amp; !isset($info['function'])) {
        $result[$hook]['function'] = ($type == 'module' ? 'theme_' : $name . '_') . $hook;
      }

      if (isset($cache[$hook]['includes'])) {
        $result[$hook]['includes'] = $cache[$hook]['includes'];
      }

      // If the theme implementation defines a file, then also use the path
      // that it defined. Otherwise use the default path. This allows
      // system.module to declare theme functions on behalf of core .include
      // files.
      if (isset($info['file'])) {
        $include_file = isset($info['path']) ? $info['path'] : $path;
        $include_file .= '/' . $info['file'];
        include_once DRUPAL_ROOT . '/' . $include_file;
        $result[$hook]['includes'][] = $include_file;
      }

      // If the default keys are not set, use the default values registered
      // by the module.
      if (isset($cache[$hook])) {
        $result[$hook] += array_intersect_key($cache[$hook], $hook_defaults);
      }

      // The following apply only to theming hooks implemented as templates.
      if (isset($info['template'])) {
        // Prepend the current theming path when none is set.
        if (!isset($info['path'])) {
          $result[$hook]['template'] = $path . '/' . $info['template'];
        }
      }

      // Allow variable processors for all theming hooks, whether the hook is
      // implemented as a template or as a function.
      foreach ($variable_process_phases as $phase_key =&gt; $phase) {
        // Check for existing variable processors. Ensure arrayness.
        if (!isset($info[$phase_key]) || !is_array($info[$phase_key])) {
          $info[$phase_key] = array();
          $prefixes = array();
          if ($type == 'module') {
            // Default variable processor prefix.
            $prefixes[] = 'template';
            // Add all modules so they can intervene with their own variable
            // processors. This allows them to provide variable processors even
            // if they are not the owner of the current hook.
            $prefixes += module_list();
          }
          elseif ($type == 'theme_engine' || $type == 'base_theme_engine') {
            // Theme engines get an extra set that come before the normally
            // named variable processors.
            $prefixes[] = $name . '_engine';
            // The theme engine registers on behalf of the theme using the
            // theme's name.
            $prefixes[] = $theme;
          }
          else {
            // This applies when the theme manually registers their own variable
            // processors.
            $prefixes[] = $name;
          }
          foreach ($prefixes as $prefix) {
            // Only use non-hook-specific variable processors for theming hooks
            // implemented as templates. See theme().
            if (isset($info['template']) &amp;&amp; function_exists($prefix . '_' . $phase)) {
              $info[$phase_key][] = $prefix . '_' . $phase;
            }
            if (function_exists($prefix . '_' . $phase . '_' . $hook)) {
              $info[$phase_key][] = $prefix . '_' . $phase . '_' . $hook;
            }
          }
        }
        // Check for the override flag and prevent the cached variable
        // processors from being used. This allows themes or theme engines to
        // remove variable processors set earlier in the registry build.
        if (!empty($info['override ' . $phase_key])) {
          // Flag not needed inside the registry.
          unset($result[$hook]['override ' . $phase_key]);
        }
        elseif (isset($cache[$hook][$phase_key]) &amp;&amp; is_array($cache[$hook][$phase_key])) {
          $info[$phase_key] = array_merge($cache[$hook][$phase_key], $info[$phase_key]);
        }
        $result[$hook][$phase_key] = $info[$phase_key];
      }
    }

    // Merge the newly created theme hooks into the existing cache.
    $cache = $result + $cache;
  }

  // Let themes have variable processors even if they didn't register a
  // template.
  if ($type == 'theme' || $type == 'base_theme') {
    foreach ($cache as $hook =&gt; $info) {
      // Check only if not registered by the theme or engine.
      if (empty($result[$hook])) {
        foreach ($variable_process_phases as $phase_key =&gt; $phase) {
          if (!isset($info[$phase_key])) {
            $cache[$hook][$phase_key] = array();
          }
          // Only use non-hook-specific variable processors for theming hooks
          // implemented as templates. See theme().
          if (isset($info['template']) &amp;&amp; function_exists($name . '_' . $phase)) {
            $cache[$hook][$phase_key][] = $name . '_' . $phase;
          }
          if (function_exists($name . '_' . $phase . '_' . $hook)) {
            $cache[$hook][$phase_key][] = $name . '_' . $phase . '_' . $hook;
            $cache[$hook]['theme path'] = $path;
          }
          // Ensure uniqueness.
          $cache[$hook][$phase_key] = array_unique($cache[$hook][$phase_key]);
        }
      }
    }
  }
}
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © 2001–2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/includes!theme.inc/function/_theme_process_registry/7.x" class="_attribution-link" target="_blank">https://api.drupal.org/api/drupal/includes!theme.inc/function/_theme_process_registry/7.x</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
