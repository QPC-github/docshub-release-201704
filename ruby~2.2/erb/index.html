
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>ERB - Ruby 2.2 - W3cubDocs</title>
  
  <meta name="description" content=" The encoding to eval ">
  <meta name="keywords" content="class, erb, -, ruby, ruby~2.2">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/ruby~2.2/erb/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/ruby~2.2.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.2/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.2</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _rdoc">
				
<h1 id="class-ERB" class="class"> class ERB </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object/">Object</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-encoding"> <span class="method-name">encoding</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The encoding to eval</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-filename"> <span class="method-name">filename</span><span class="attribute-access-type">[RW]</span> </div> <div class="method-description"> <p>The optional <em>filename</em> argument passed to <a href="../kernel/#method-i-eval">Kernel#eval</a> when the <a href="../erb/">ERB</a> code is run</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-lineno"> <span class="method-name">lineno</span><span class="attribute-access-type">[RW]</span> </div> <div class="method-description"> <p>The optional <em>lineno</em> argument passed to <a href="../kernel/#method-i-eval">Kernel#eval</a> when the <a href="../erb/">ERB</a> code is run</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-src"> <span class="method-name">src</span><span class="attribute-access-type">[R]</span> </div> <div class="method-description"> <p>The Ruby code generated by <a href="../erb/">ERB</a></p> </div> </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(str, safe_level=nil, trim_mode=nil, eoutvar='_erbout')</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Constructs a new <a href="../erb/">ERB</a> object with the template specified in <em>str</em>.</p> <p>An <a href="../erb/">ERB</a> object works by building a chunk of Ruby code that will output the completed template when run. If <em>safe_level</em> is set to a non-nil value, <a href="../erb/">ERB</a> code will be run in a separate thread with <strong>$SAFE</strong> set to the provided level.</p> <p>If <em>trim_mode</em> is passed a String containing one or more of the following modifiers, <a href="../erb/">ERB</a> will adjust its code generation as listed:</p> <pre>%  enables Ruby code processing for lines beginning with %
&lt;&gt; omit newline for lines starting with &lt;% and ending in %&gt;
&gt;  omit newline for lines ending in %&gt;
-  omit blank lines ending in -%&gt;</pre> <p><em>eoutvar</em> can be used to set the name of the variable <a href="../erb/">ERB</a> will build up its output in. This is useful when you need to run multiple <a href="../erb/">ERB</a> templates through the same binding and/or when you want to control where output ends up. Pass the name of the variable to be used inside a String.</p> <h3 id="method-c-new-label-Example">Example</h3> <pre class="ruby">require "erb"

# build data class
class Listings
  PRODUCT = { :name =&gt; "Chicken Fried Steak",
              :desc =&gt; "A well messages pattie, breaded and fried.",
              :cost =&gt; 9.95 }

  attr_reader :product, :price

  def initialize( product = "", price = "" )
    @product = product
    @price = price
  end

  def build
    b = binding
    # create and run templates, filling member data variables
    ERB.new("      &lt;%= PRODUCT[:name] %&gt;
      &lt;%= PRODUCT[:desc] %&gt;
".gsub(/^\s+/, ""), 0, "", "@product").result b
    ERB.new("      &lt;%= PRODUCT[:name] %&gt; -- &lt;%= PRODUCT[:cost] %&gt;
      &lt;%= PRODUCT[:desc] %&gt;
".gsub(/^\s+/, ""), 0, "", "@price").result b
  end
end

# setup template data
listings = Listings.new
listings.build

puts listings.product + "\n" + listings.price
</pre> <p><em>Generates</em></p> <pre>Chicken Fried Steak
A well messages pattie, breaded and fried.

Chicken Fried Steak -- 9.95
A well messages pattie, breaded and fried.</pre> <div class="method-source-code" id="new-source"> <pre class="ruby"># File lib/erb.rb, line 795
def initialize(str, safe_level=nil, trim_mode=nil, eoutvar='_erbout')
  @safe_level = safe_level
  compiler = make_compiler(trim_mode)
  set_eoutvar(compiler, eoutvar)
  @src, @encoding = *compiler.compile(str)
  @filename = nil
  @lineno = 0
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-version"> <span class="method-name">version</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Returns revision information for the erb.rb module.</p> <div class="method-source-code" id="version-source"> <pre class="ruby"># File lib/erb.rb, line 263
def self.version
  "erb.rb [2.1.0 #{ERB::Revision.split[1]}]"
end</pre> </div> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-def_class"> <span class="method-name">def_class</span><span class="method-args">(superklass=Object, methodname='result')</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Define unnamed class which has <em>methodname</em> as instance method, and return it.</p> <p>example:</p> <pre class="ruby">class MyClass_
  def initialize(arg1, arg2)
    @arg1 = arg1;  @arg2 = arg2
  end
end
filename = 'example.rhtml'  # @arg1 and @arg2 are used in example.rhtml
erb = ERB.new(File.read(filename))
erb.filename = filename
MyClass = erb.def_class(MyClass_, 'render()')
print MyClass.new('foo', 123).render()
</pre> <div class="method-source-code" id="def_class-source"> <pre class="ruby"># File lib/erb.rb, line 919
def def_class(superklass=Object, methodname='result')
  cls = Class.new(superklass)
  def_method(cls, methodname, @filename || '(ERB)')
  cls
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-def_method"> <span class="method-name">def_method</span><span class="method-args">(mod, methodname, fname='(ERB)')</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Define <em>methodname</em> as instance method of <em>mod</em> from compiled Ruby source.</p> <p>example:</p> <pre class="ruby">filename = 'example.rhtml'   # 'arg1' and 'arg2' are used in example.rhtml
erb = ERB.new(File.read(filename))
erb.def_method(MyClass, 'render(arg1, arg2)', filename)
print MyClass.new.render('foo', 123)
</pre> <div class="method-source-code" id="def_method-source"> <pre class="ruby"># File lib/erb.rb, line 882
def def_method(mod, methodname, fname='(ERB)')
  src = self.src
  magic_comment = "#coding:#{@encoding}\n"
  mod.module_eval do
    eval(magic_comment + "def #{methodname}\n" + src + "\nend\n", binding, fname, -2)
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-def_module"> <span class="method-name">def_module</span><span class="method-args">(methodname='erb')</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Create unnamed module, define <em>methodname</em> as instance method of it, and return it.</p> <p>example:</p> <pre class="ruby">filename = 'example.rhtml'   # 'arg1' and 'arg2' are used in example.rhtml
erb = ERB.new(File.read(filename))
erb.filename = filename
MyModule = erb.def_module('render(arg1, arg2)')
class MyClass
  include MyModule
end
</pre> <div class="method-source-code" id="def_module-source"> <pre class="ruby"># File lib/erb.rb, line 900
def def_module(methodname='erb')
  mod = Module.new
  def_method(mod, methodname, @filename || '(ERB)')
  mod
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-location-3D"> <span class="method-name">location=</span><span class="method-args">((filename, lineno))</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="location-3D-source"> <pre class="ruby"># File lib/erb.rb, line 825
def location=((filename, lineno))
  @filename = filename
  @lineno = lineno if lineno
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-make_compiler"> <span class="method-name">make_compiler</span><span class="method-args">(trim_mode)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Creates a new compiler for <a href="../erb/">ERB</a>. See ERB::Compiler.new for details</p> <div class="method-source-code" id="make_compiler-source"> <pre class="ruby"># File lib/erb.rb, line 807
def make_compiler(trim_mode)
  ERB::Compiler.new(trim_mode)
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-result"> <span class="method-name">result</span><span class="method-args">(b=new_toplevel)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Executes the generated <a href="../erb/">ERB</a> code to produce a completed template, returning the results of that code. (See <a href="../erb/#method-c-new">::new</a> for details on how this process can be affected by <em>safe_level</em>.)</p> <p><em>b</em> accepts a <a href="../binding/">Binding</a> object which is used to set the context of code evaluation.</p> <div class="method-source-code" id="result-source"> <pre class="ruby"># File lib/erb.rb, line 855
def result(b=new_toplevel)
  if @safe_level
    proc {
      $SAFE = @safe_level
      eval(@src, b, (@filename || '(erb)'), @lineno)
    }.call
  else
    eval(@src, b, (@filename || '(erb)'), @lineno)
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-run"> <span class="method-name">run</span><span class="method-args">(b=new_toplevel)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Generate results and print them. (see <a href="../erb/#method-i-result">#result</a>)</p> <div class="method-source-code" id="run-source"> <pre class="ruby"># File lib/erb.rb, line 843
def run(b=new_toplevel)
  print self.result(b)
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-set_eoutvar"> <span class="method-name">set_eoutvar</span><span class="method-args">(compiler, eoutvar = '_erbout')</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Can be used to set <em>eoutvar</em> as described in <a href="../erb/#method-c-new">::new</a>. It's probably easier to just use the constructor though, since calling this method requires the setup of an <a href="../erb/">ERB</a> <em>compiler</em> object.</p> <div class="method-source-code" id="set_eoutvar-source"> <pre class="ruby"># File lib/erb.rb, line 835
def set_eoutvar(compiler, eoutvar = '_erbout')
  compiler.put_cmd = "#{eoutvar}.concat"
  compiler.insert_cmd = "#{eoutvar}.concat"
  compiler.pre_cmd = ["#{eoutvar} = ''"]
  compiler.post_cmd = ["#{eoutvar}.force_encoding(__ENCODING__)"]
end</pre> </div> </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-new_toplevel"> <span class="method-name">new_toplevel</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Returns a new binding each time <strong>near</strong> TOPLEVEL_BINDING for runs that do not specify a binding.</p> <div class="method-source-code" id="new_toplevel-source"> <pre class="ruby"># File lib/erb.rb, line 870
def new_toplevel
  TOPLEVEL_BINDING.dup
end</pre> </div> </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2016 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
