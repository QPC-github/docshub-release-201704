
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Creating a Database Cluster - PostgreSQL 9.6 - W3cubDocs</title>
  
  <meta name="description" content="Before you can do anything, you must initialize a database storage area on disk. We call this a database cluster. (The SQL standard uses the term &hellip;">
  <meta name="keywords" content="creating, database, cluster, -, postgresql, postgresql~9.6">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/postgresql~9.6/creating-cluster/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/postgresql~9.6.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/postgresql~9.6/" class="_nav-link" title="" style="margin-left:0;">PostgreSQL 9.6</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _postgres">
				
<h1 class="SECT1" id="CREATING-CLUSTER">18.2. Creating a Database Cluster</h1> <p>Before you can do anything, you must initialize a database storage area on disk. We call this a <i class="FIRSTTERM">database cluster</i>. (The <acronym class="ACRONYM">SQL</acronym> standard uses the term catalog cluster.) A database cluster is a collection of databases that is managed by a single instance of a running database server. After initialization, a database cluster will contain a database named <code class="LITERAL">postgres</code>, which is meant as a default database for use by utilities, users and third party applications. The database server itself does not require the <code class="LITERAL">postgres</code> database to exist, but many external utility programs assume it exists. Another database created within each cluster during initialization is called <code class="LITERAL">template1</code>. As the name suggests, this will be used as a template for subsequently created databases; it should not be used for actual work. (See <a href="https://www.postgresql.org/docs/9.6/static/managing-databases.html" target="_blank">Chapter 22</a> for information about creating new databases within a cluster.)</p> <p>In file system terms, a database cluster is a single directory under which all data will be stored. We call this the <i class="FIRSTTERM">data directory</i> or <i class="FIRSTTERM">data area</i>. It is completely up to you where you choose to store your data. There is no default, although locations such as <code class="FILENAME">/usr/local/pgsql/data</code> or <code class="FILENAME">/var/lib/pgsql/data</code> are popular. To initialize a database cluster, use the command <a href="../app-initdb/">initdb</a>, which is installed with <span class="PRODUCTNAME">PostgreSQL</span>. The desired file system location of your database cluster is indicated by the <code class="OPTION">-D</code> option, for example:</p> <pre class="SCREEN">
<samp class="PROMPT">$</samp> initdb -D /usr/local/pgsql/data
</pre> <p>Note that you must execute this command while logged into the <span class="PRODUCTNAME">PostgreSQL</span> user account, which is described in the previous section.</p> <div class="TIP"> <blockquote class="TIP"> <p><b>Tip:</b> As an alternative to the <code class="OPTION">-D</code> option, you can set the environment variable <code class="ENVAR">PGDATA</code>.</p> </blockquote> </div> <p>Alternatively, you can run <code class="COMMAND">initdb</code> via the <a href="../app-pg-ctl/"><span class="APPLICATION">pg_ctl</span></a> program like so:</p> <pre class="SCREEN">
<samp class="PROMPT">$</samp> pg_ctl -D /usr/local/pgsql/data initdb
</pre> <p>This may be more intuitive if you are using <code class="COMMAND">pg_ctl</code> for starting and stopping the server (see <a href="../server-start/">Section 18.3</a>), so that <code class="COMMAND">pg_ctl</code> would be the sole command you use for managing the database server instance.</p> <p><code class="COMMAND">initdb</code> will attempt to create the directory you specify if it does not already exist. Of course, this will fail if <code class="COMMAND">initdb</code> does not have permissions to write in the parent directory. It's generally recommendable that the <span class="PRODUCTNAME">PostgreSQL</span> user own not just the data directory but its parent directory as well, so that this should not be a problem. If the desired parent directory doesn't exist either, you will need to create it first, using root privileges if the grandparent directory isn't writable. So the process might look like this:</p> <pre class="SCREEN">
root# mkdir /usr/local/pgsql
root# chown postgres /usr/local/pgsql
root# su postgres
postgres$ initdb -D /usr/local/pgsql/data
</pre> <p><code class="COMMAND">initdb</code> will refuse to run if the data directory exists and already contains files; this is to prevent accidentally overwriting an existing installation.</p> <p>Because the data directory contains all the data stored in the database, it is essential that it be secured from unauthorized access. <code class="COMMAND">initdb</code> therefore revokes access permissions from everyone but the <span class="PRODUCTNAME">PostgreSQL</span> user.</p> <p>However, while the directory contents are secure, the default client authentication setup allows any local user to connect to the database and even become the database superuser. If you do not trust other local users, we recommend you use one of <code class="COMMAND">initdb</code>'s <code class="OPTION">-W</code>, <code class="OPTION">--pwprompt</code> or <code class="OPTION">--pwfile</code> options to assign a password to the database superuser. Also, specify <code class="OPTION">-A md5</code> or <code class="OPTION">-A password</code> so that the default <code class="LITERAL">trust</code> authentication mode is not used; or modify the generated <code class="FILENAME">pg_hba.conf</code> file after running <code class="COMMAND">initdb</code>, but <span class="emphasis EMPHASIS c2">before</span> you start the server for the first time. (Other reasonable approaches include using <code class="LITERAL">peer</code> authentication or file system permissions to restrict connections. See <a href="https://www.postgresql.org/docs/9.6/static/client-authentication.html" target="_blank">Chapter 20</a> for more information.)</p> <p><code class="COMMAND">initdb</code> also initializes the default locale for the database cluster. Normally, it will just take the locale settings in the environment and apply them to the initialized database. It is possible to specify a different locale for the database; more information about that can be found in <a href="../locale/">Section 23.1</a>. The default sort order used within the particular database cluster is set by <code class="COMMAND">initdb</code>, and while you can create new databases using different sort order, the order used in the template databases that initdb creates cannot be changed without dropping and recreating them. There is also a performance impact for using locales other than <code class="LITERAL">C</code> or <code class="LITERAL">POSIX</code>. Therefore, it is important to make this choice correctly the first time.</p> <p><code class="COMMAND">initdb</code> also sets the default character set encoding for the database cluster. Normally this should be chosen to match the locale setting. For details see <a href="../multibyte/">Section 23.3</a>.</p> <p>Non-<code class="LITERAL">C</code> and non-<code class="LITERAL">POSIX</code> locales rely on the operating system's collation library for character set ordering. This controls the ordering of keys stored in indexes. For this reason, a cluster cannot switch to an incompatible collation library version, either through snapshot restore, binary streaming replication, a different operating system, or an operating system upgrade.</p> <div class="SECT2"> <h2 class="SECT2" id="CREATING-CLUSTER-MOUNT-POINTS">18.2.1. Use of Secondary File Systems</h2> <p>Many installations create their database clusters on file systems (volumes) other than the machine's <span class="QUOTE">"root"</span> volume. If you choose to do this, it is not advisable to try to use the secondary volume's topmost directory (mount point) as the data directory. Best practice is to create a directory within the mount-point directory that is owned by the <span class="PRODUCTNAME">PostgreSQL</span> user, and then create the data directory within that. This avoids permissions problems, particularly for operations such as <span class="APPLICATION">pg_upgrade</span>, and it also ensures clean failures if the secondary volume is taken offline.</p> </div> <div class="SECT2"> <h2 class="SECT2" id="CREATING-CLUSTER-NFS">18.2.2. Use of Network File Systems</h2> <p>Many installations create their database clusters on network file systems. Sometimes this is done via <acronym class="ACRONYM">NFS</acronym>, or by using a Network Attached Storage (<acronym class="ACRONYM">NAS</acronym>) device that uses <acronym class="ACRONYM">NFS</acronym> internally. <span class="PRODUCTNAME">PostgreSQL</span> does nothing special for <acronym class="ACRONYM">NFS</acronym> file systems, meaning it assumes <acronym class="ACRONYM">NFS</acronym> behaves exactly like locally-connected drives. If the client or server <acronym class="ACRONYM">NFS</acronym> implementation does not provide standard file system semantics, this can cause reliability problems (see <a href="http://www.time-travellers.org/shane/papers/NFS_considered_harmful.html" target="_blank">http://www.time-travellers.org/shane/papers/NFS_considered_harmful.html</a>). Specifically, delayed (asynchronous) writes to the <acronym class="ACRONYM">NFS</acronym> server can cause data corruption problems. If possible, mount the <acronym class="ACRONYM">NFS</acronym> file system synchronously (without caching) to avoid this hazard. Also, soft-mounting the <acronym class="ACRONYM">NFS</acronym> file system is not recommended.</p> <p>Storage Area Networks (<acronym class="ACRONYM">SAN</acronym>) typically use communication protocols other than <acronym class="ACRONYM">NFS</acronym>, and may or may not be subject to hazards of this sort. It's advisable to consult the vendor's documentation concerning data consistency guarantees. <span class="PRODUCTNAME">PostgreSQL</span> cannot be more reliable than the file system it's using.</p> </div>  <div class="NAVFOOTER">  <table summary="Footer navigation table"> <tr> <td width="33%" align="left"><a href="../postgres-user/" accesskey="P">Prev</a></td> <td width="34%" align="center"></td> <td width="33%" align="right"><a href="../server-start/" accesskey="N">Next</a></td> </tr> <tr> <td width="33%" align="left">The <span class="PRODUCTNAME">PostgreSQL</span> User Account</td> <td width="34%" align="center"><a href="https://www.postgresql.org/docs/9.6/static/runtime.html" accesskey="U" target="_blank">Up</a></td> <td width="33%" align="right">Starting the Database Server</td> </tr> </table> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 1996–2017 The PostgreSQL Global Development Group<br>Licensed under the PostgreSQL License.<br>
    <a href="https://www.postgresql.org/docs/9.6/static/creating-cluster.html" class="_attribution-link" target="_blank">https://www.postgresql.org/docs/9.6/static/creating-cluster.html</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
