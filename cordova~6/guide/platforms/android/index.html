
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Android Platform - Cordova 6 - W3cubDocs</title>
  
  <meta name="description" content="This guide shows how to set up your SDK environment to deploy Cordova apps for Android devices, and how to optionally use Android-centered command- &hellip;">
  <meta name="keywords" content="android, platform, guide, -, cordova, cordova~6">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/cordova~6/guide/platforms/android/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/cordova~6.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/cordova~6/" class="_nav-link" title="" style="margin-left:0;">Cordova 6</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _cordova">
				
<h1 id="android-platform-guide">Android Platform Guide</h1> <p>This guide shows how to set up your SDK environment to deploy Cordova apps for Android devices, and how to optionally use Android-centered command-line tools in your development workflow. You need to install the Android SDK regardless of whether you want to use these platform-centered shell tools or cross-platform Cordova CLI for development. For a comparison of the two development paths, see the <a href="../../overview/#development-paths/index.html">Overview</a>. For details on the CLI, see <a href="../../../reference/cordova-cli/">Cordova CLI Reference</a>.</p> <h2 id="requirements-and-support">Requirements and Support</h2> <p>Cordova for Android requires the Android SDK which can be installed on OS X, Linux or Windows. See the Android SDK's <a href="http://developer.android.com/sdk/index.html#Requirements" target="_blank">System Requirements</a>. Cordova's latest Android package supports up to Android <a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html#ApiLevels" target="_blank">API-Level</a> 23. The supported Android API-Levels for the past few cordova-android releases can be found in this table:</p> <table>
<thead> <tr> <th>cordova-android Version</th> <th>Supported Android API-Levels</th> </tr> </thead>
<tbody> <tr> <td>5.X.X</td> <td>14 - 23</td> </tr> <tr> <td>4.1.X</td> <td>14 - 22</td> </tr> <tr> <td>4.0.X</td> <td>10 - 22</td> </tr> <tr> <td>3.7.X</td> <td>10 - 21</td> </tr> </tbody>
</table> <p>Please note that the versions listed here are for Cordova's Android package, <a href="https://github.com/apache/cordova-android" target="_blank">cordova-android</a>, and not for the Cordova CLI. To determine what version of Cordova's Android package is installed in your Cordova project, run the command <code>cordova platform ls</code> in the directory that holds your project.</p> <p>As a general rule, Android versions become unsupported by Cordova as they dip below 5% on Google's <a href="http://developer.android.com/about/dashboards/index.html" target="_blank">distribution dashboard</a>.</p> <h2 id="installing-the-requirements">Installing the Requirements</h2> <h3 id="java-development-kit-jdk">Java Development Kit (JDK)</h3> <p>Install <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html" target="_blank">Java Development Kit (JDK) 7</a> or later.</p> <p>When installing on Windows you also need to set <code>JAVA_HOME</code> Environment Variable according to your JDK installation path (see <a href="#setting-environment-variables">Setting Environment Variables</a>)</p> <h4 id="android-sdk">Android SDK</h4> <p>Install the <a href="http://developer.android.com/sdk/installing/index.html?pkg=tools" target="_blank">Android Stand-alone SDK Tools</a> or <a href="http://developer.android.com/sdk/installing/index.html?pkg=studio" target="_blank">Android Studio</a>. Proceed with Android Studio if you plan on developing new Cordova for Android plugins or using native tools to run and debug the Android platform. Otherwise, the Android Stand-alone SDK Tools are enough to build and deploy Android applications.</p> <p>Detailed installation instructions are available as part of installation links above.</p> <h4 id="adding-sdk-packages">Adding SDK Packages</h4> <p>After installing the Android SDK, you must also install the packages for whatever <a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html#ApiLevels" target="_blank">API level</a> you wish to target. It is recommended that you install the highest SDK version that your version of cordova-android supports (see above).</p> <p>Open Android SDK Manager (for example, run <code>android</code> from the terminal) and make sure the following are installed:</p> <ol> <li>Android Platform SDK for your targeted version of Android</li> <li>Android SDK build-tools version 19.1.0 or higher</li> <li>Android Support Repository (found under "Extras")</li> </ol> <p>See Android's documentation on <a href="http://developer.android.com/sdk/installing/adding-packages.html" target="_blank">Installing SDK Packages</a> for more details.</p> <h3 id="setting-environment-variables">Setting environment variables</h3> <p>Cordova's CLI tools require some environment variables to be set in order to function correctly. The CLI will attempt to set these variables for you, but in certain cases you may need to set them manually. The following variables should be updated:</p> <ol> <li>Set the <code>JAVA_HOME</code> environment variable to the location of your JDK installation</li> <li>Set the <code>ANDROID_HOME</code> environment variable to the location of your Android SDK installation</li> <li>It is also recommended that you add the Android SDK's <code>tools</code> and <code>platform-tools</code> directories to your <code>PATH</code>
</li> </ol> <h4 id="os-x-and-linux">OS X and Linux</h4> <p>On a Mac or Linux, you can use a text editor to create or modify the <code>~/.bash_profile</code> file. To set an environment variable, add a line that uses <code>export</code> like so (substitute the path with your local installation):</p> <pre data-language="bash">export ANDROID_HOME=/Development/android-sdk/
</pre> <p>To update your <code>PATH</code>, add a line resembling the following (substitute the paths with your local Android SDK installation's location):</p> <pre data-language="bash">export PATH=${PATH}:/Development/android-sdk/platform-tools:/Development/android-sdk/tools
</pre> <p>Reload your terminal to see this change reflected or run the following command:</p> <pre data-language="bash">$ source ~/.bash_profile
</pre> <h4 id="windows">Windows</h4> <p>These steps may vary depending on your installed version of Windows. Close and reopen any command prompt windows after making changes to see them reflected</p> <ol> <li><p>Click on the <strong>Start</strong> menu in the lower-left corner of the desktop</p></li> <li><p>In the search bar, search for <strong>Environment Variables</strong> and select <strong>Edit the system Environment Variables</strong> from the options that appear</p></li> <li><p>In the window that appears, click the <strong>Environment Variables</strong> button</p></li> </ol> <h5 id="to-create-a-new-environment-variable">To create a new environment variable:</h5> <ol> <li>Click <strong>New...</strong> and enter the variable name and value</li> </ol> <h5 id="to-set-your-path">To set your <strong>PATH</strong>:</h5> <ol> <li><p>Select the <strong>PATH</strong> variable and press <strong>Edit</strong>.</p></li> <li>
<p>Add entries for the relevant locations to the <strong>PATH</strong>. For example (substitute the paths with your local Android SDK installation's location):</p> <pre data-language="">C:\Development\android-sdk\platform-tools
C:\Development\android-sdk\tools
</pre>
</li> </ol> <h2 id="project-configuration">Project Configuration</h2> <h3 id="setting-up-an-emulator">Setting up an Emulator</h3> <p>If you wish to run your Cordova app on an Android emulator, you will first need to create an Android Virtual Device (AVD). See the Android documentation for <a href="http://developer.android.com/tools/devices/managing-avds.html" target="_blank">managing AVDs</a> and the <a href="http://developer.android.com/tools/devices/emulator.html" target="_blank">instructions</a> for configuring the emulator and setting up hardware acceleration.</p> <p>Once your AVD is configured correctly, you should be able to see it by running this command from within a Cordova project:</p> <pre data-language="bash">$ cordova run --list
</pre> <h3 id="configuring-gradle">Configuring Gradle</h3> <p>As of <strong>cordova-android@4.0.0</strong>, Cordova for Android projects are built using <a href="http://www.gradle.org/" target="_blank">Gradle</a>. For instructions on building with Ant, refer to older versions of the documentation.</p> <h4 id="setting-gradle-properties">Setting Gradle Properties</h4> <p>It is possible to configure the Gradle build by setting the values of certain <a href="https://docs.gradle.org/current/userguide/build_environment.html" target="_blank">Gradle properties</a> that Cordova exposes. The following properties are available to be set:</p> <table>
<thead> <tr> <th>Property</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td><code>cdvBuildMultipleApks</code></td> <td>If this is set, then multiple APK files will be generated: One per native platform supported by library projects (x86, ARM, etc). This can be important if your project uses large native libraries, which can drastically increase the size of the generated APK. If not set, then a single APK will be generated which can be used on all devices</td> </tr> <tr> <td><code>cdvVersionCode</code></td> <td>Overrides the versionCode set in <code>AndroidManifest.xml</code>
</td> </tr> <tr> <td><code>cdvReleaseSigningPropertiesFile</code></td> <td>
<em>Default: <code>release-signing.properties</code></em><br>Path to a .properties file that contains signing information for release builds (see <a href="#signing-an-app">Signing an App</a>)</td> </tr> <tr> <td><code>cdvDebugSigningPropertiesFile</code></td> <td>
<em>Default: <code>debug-signing.properties</code></em><br>Path to a .properties file that contains signing information for debug builds (see <a href="#signing-an-app">Signing an App</a>). Useful when you need to share a signing key with other developers</td> </tr> <tr> <td><code>cdvMinSdkVersion</code></td> <td>Overrides the value of <code>minSdkVersion</code> set in <code>AndroidManifest.xml</code>. Useful when creating multiple APKs based on SDK version</td> </tr> <tr> <td><code>cdvBuildToolsVersion</code></td> <td>Overrides the automatically detected <code>android.buildToolsVersion</code> value</td> </tr> <tr> <td><code>cdvCompileSdkVersion</code></td> <td>Overrides the automatically detected <code>android.compileSdkVersion</code> value</td> </tr> </tbody>
</table> <p>You can set these properties in one of four ways:</p> <ol> <li>
<p>By setting environment variables like so:</p> <pre data-language="bash">$ export ORG_GRADLE_PROJECT_cdvMinSdkVersion=20
$ cordova build android
</pre>
</li> <li>
<p>By using the <code>--gradleArg</code> flag in your Cordova <code>build</code> or <code>run</code> commands:</p> <pre data-language="bash">$ cordova run android -- --gradleArg=-PcdvMinSdkVersion=20
</pre>
</li> <li>
<p>By placing a file called <code>gradle.properties</code> in your Android platform folder (<code>&lt;your-project&gt;/platforms/android</code>) and setting the properties in it like so:</p> <pre data-language=""># In &lt;your-project&gt;/platforms/android/gradle.properties
cdvMinSdkVersion=20
</pre>
</li> <li>
<p>By extending <code>build.gradle</code> via a <a href="#extending-build-gradle"><code>build-extras.gradle</code> file</a> and setting the property like so:</p> <pre data-language="groovy">// In &lt;your-project&gt;/platforms/android/build-extras.gradle
ext.cdvMinSdkVersion = 20
</pre>
</li> </ol> <p>The latter two options both involve including an extra file in your Android platform folder. In general, it is discouraged that you edit the contents of this folder because it is easy for those changes to be lost or overwritten. Instead, these two files should be copied from another location into that folder as part of the build command by using the <code>before_build</code> <a href="../../appdev/hooks/">hook</a>.</p> <h4 id="extending-build-gradle">Extending build.gradle</h4> <p>If you need to customize <code>build.gradle</code>, rather than edit it directly, you should create a sibling file named <code>build-extras.gradle</code>. This file will be included by the main <code>build.gradle</code> when present. This file must be placed in the android platform directory (<code>&lt;your-project&gt;/platforms/android</code>), so it is recommended that you copy it over via a script attached to the <code>before_build</code> <a href="../../appdev/hooks/">hook</a>.</p> <p>Here's an example:</p> <pre data-language="groovy">// Example build-extras.gradle
// This file is included at the beginning of `build.gradle`
ext.cdvDebugSigningPropertiesFile = '../../android-debug-keys.properties'

// When set, this function allows code to run at the end of `build.gradle`
ext.postBuildExtras = {
    android.buildTypes.debug.applicationIdSuffix = '.debug'
}
</pre> <p>Note that plugins can also include <code>build-extras.gradle</code> files via:</p> <pre data-language="xml">&lt;framework src="some.gradle" custom="true" type="gradleReference" /&gt;
</pre> <h3 id="setting-the-version-code">Setting the Version Code</h3> <p>To change the <a href="http://developer.android.com/tools/publishing/versioning.html" target="_blank">version code</a> for your app's generated apk, set the <code>android-versionCode</code> attribute in the widget element of your application's <a href="../../../config_ref/">config.xml file</a>. If the <code>android-versionCode</code> is not set, the version code will be determined using the <code>version</code> attribute. For example, if the version is <code>MAJOR.MINOR.PATCH</code>:</p> <pre data-language="">versionCode = MAJOR * 10000 + MINOR * 100 + PATCH
</pre> <p>If your application has enabled the <code>cdvBuildMultipleApks</code> Gradle property (see <a href="#setting-gradle-properties">Setting Gradle Properties</a>), the version code of your app will also be multiplied by 10 so that the last digit of the code can be used to indicate the architecture the apk was built for. This multiplication will happen regardless of whether the version code is taken from the <code>android-versionCode</code> attribute or generated using the <code>version</code>. Be aware that some plugins added to your project (including cordova-plugin-crosswalk-webview) may set this Gradle property automatically.</p> <p><strong>Please Note:</strong> When updating the <code>android-versionCode</code> property, it is unwise to increment the version code taken from built apks. Instead, you should increment the code based off the value in your <code>config.xml</code> file's <code>android-versionCode</code> attribute. This is because the <code>cdvBuildMultipleApks</code> property causes the version code to be multiplied by 10 in the built apks and thus using that value will cause your next version code to be 100 times the original, etc.</p> <h2 id="signing-an-app">Signing an App</h2> <p>First, you should read the <a href="http://developer.android.com/tools/publishing/app-signing.html" target="_blank">Android app signing requirements</a>.</p> <h3 id="using-flags">Using Flags</h3> <p>To sign an app, you need the following parameters:</p> <table>
<thead> <tr> <th>Parameter</th> <th>Flag</th> <th>Description</th> </tr> </thead>
<tbody> <tr> <td>Keystore</td> <td><code>--keystore</code></td> <td>Path to a binary file which can hold a set of keys</td> </tr> <tr> <td>Keystore Password</td> <td><code>--storePassword</code></td> <td>Password to the keystore</td> </tr> <tr> <td>Alias</td> <td><code>--alias</code></td> <td>The id specifying the private key used for singing</td> </tr> <tr> <td>Password</td> <td><code>--password</code></td> <td>Password for the private key specified</td> </tr> <tr> <td>Type of the Keystore</td> <td><code>--keystoreType</code></td> <td>
<em>Default: auto-detect based on file extension</em><br>Either pkcs12 or jks</td> </tr> </tbody>
</table> <p>These parameters can be specified using the command line arguments above to the <a href="../../../reference/cordova-cli/">Cordova CLI</a> <code>build</code> or <code>run</code> commands.</p> <p><strong>Note</strong>: You should use double <code>--</code> to indicate that these are platform-specific arguments, for example:</p> <p><code>cordova run android --release -- --keystore=../my-release-key.keystore --storePassword=password --alias=alias_name --password=password</code>.</p> <h3 id="using-build-json">Using build.json</h3> <p>Alternatively, you could specify them in a build configuration file (<code>build.json</code>) using the <code>--buildConfig</code> argument to the same commands. Here's a sample of a build configuration file:</p> <pre data-language="json">{
    "android": {
        "debug": {
            "keystore": "../android.keystore",
            "storePassword": "android",
            "alias": "mykey1",
            "password" : "password",
            "keystoreType": ""
        },
        "release": {
            "keystore": "../android.keystore",
            "storePassword": "",
            "alias": "mykey2",
            "password" : "password",
            "keystoreType": ""
        }
    }
}
</pre> <p>For release signing, passwords can be excluded and the build system will issue a prompt asking for the password.</p> <p>There is also support to mix and match command line arguments and parameters in <code>build.json</code>. Values from the command line arguments will get precedence. This can be useful for specifying passwords on the command line.</p> <h3 id="using-gradle">Using Gradle</h3> <p>You can also specify signing properties by including a <code>.properties</code> file and pointing to it with the <code>cdvReleaseSigningPropertiesFile</code> and <code>cdvDebugSigningPropertiesFile</code> Gradle properties (see <a href="#setting-gradle-properties">Setting Gradle Properties</a>). The file should look like this:</p> <pre data-language="">storeFile=relative/path/to/keystore.p12
storePassword=SECRET1
storeType=pkcs12
keyAlias=DebugSigningKey
keyPassword=SECRET2
</pre> <p><code>storePassword</code> and <code>keyPassword</code> are optional, and will be prompted for if omitted.</p> <h2 id="debugging">Debugging</h2> <p>For details on the debugging tools that come packaged with the Android SDK, see <a href="http://developer.android.com/tools/debugging/index.html" target="_blank">Android's developer documentation for debugging</a>. Additionally, Android's developer documentation for <a href="http://developer.android.com/guide/webapps/debugging.html" target="_blank">debugging web apps</a> provides an introduction for debugging the portion of your app running in the Webview.</p> <h3 id="opening-a-project-in-android-studio">Opening a Project in Android Studio</h3> <p>Cordova for Android projects can be opened in the Android IDE, <a href="http://developer.android.com/sdk/installing/index.html?pkg=studio" target="_blank">Android Studio</a>. This can be useful if you wish to use Android Studio's built in Android debugging/profiling tools or if you are developing Android plugins. Please note that when opening your project in Android studio, it is recommended that you do NOT edit your code in the IDE. This will edit the code in the <code>platforms</code> folder of your project (not <code>www</code>), and changes are liable to be overwritten. Instead, edit the <code>www</code> folder and copy over your changes by running <code>cordova build</code>.</p> <p>Plugin developers wishing to edit their native code in the IDE should use the <code>--link</code> flag when adding their plugin to the project via <code>cordova plugin add</code>. This will link the files so that changes to the plugin files in the <code>platforms</code> folder are reflected in your plugin's source folder (and vice versa).</p> <p>To open a Cordova for Android project in Android Studio:</p> <ol> <li><p>Launch <strong>Android Studio</strong>.</p></li> <li>
<p>Select <strong>Import Project (Eclipse ADT, Gradle, etc)</strong>.</p> <p><img src="https://cordova.apache.org/static/img/guide/platforms/android/asdk_import_project.png" alt=""></p>
</li> <li>
<p>Select the Android platform directory in your project (<code>&lt;your-project&gt;/platforms/android</code>).</p> <p><img src="https://cordova.apache.org/static/img/guide/platforms/android/asdk_import_select_location.png" alt=""></p>
</li> <li><p>For the <code>Gradle Sync</code> question you can simply answer <strong>Yes</strong>.</p></li> </ol> <p>Once it finishes importing, you should be able to build and run the app directly from <strong>Android Studio</strong>. See <a href="http://developer.android.com/tools/studio/index.html" target="_blank">Android Studio Overview</a> and <a href="http://developer.android.com/tools/building/building-studio.html" target="_blank">Building and Running from Android Studio</a> for more details.</p> <p><img src="https://cordova.apache.org/static/img/guide/platforms/android/asdk_import_done.png" alt=""></p> <h2 id="platform-centered-workflow">Platform Centered Workflow</h2> <p>cordova-android includes a number of scripts that allow the platform to be used without the full Cordova CLI. This development path may offer you a greater range of development options in certain situations than the cross-platform cordova CLI. For example, you need to use shell tools when deploying a custom Cordova WebView alongside native components. Before using this development path, you must still configure the Android SDK environment as described in <a href="#requirements-and-support">Requirements and Support</a> above.</p> <p>For each of the scripts discussed below, refer to <a href="../../../reference/cordova-cli/">Cordova CLI Reference</a> for more information on their arguments and usage. Each script has a name that matches the corresponding CLI command. For example, <code>cordova-android/bin/create</code> is equivalent to <code>cordova create</code>.</p> <p>To get started, either download the cordova-android package from <a href="https://www.npmjs.com/package/cordova-android" target="_blank">npm</a> or <a href="https://github.com/apache/cordova-android" target="_blank">Github</a>.</p> <p>To create a project using this package, run the <code>create</code> script in the <code>bin</code> folder:</p> <pre data-language="bash">$ cordova-android/bin/create ...
</pre> <p>The created project will have a folder named <code>cordova</code> inside that contains scripts for the project-specific Cordova commands (e.g. <code>run</code>, <code>build</code>, etc.). Additionally, The project will feature a structure different from that of a normal Cordova project. Notably, <code>/www</code> is moved to <code>/assets/www</code>.</p> <p>To install plugins in this project, use the <a href="../../../plugin_ref/plugman/">Cordova Plugman Utility</a>.</p> <h2 id="upgrading">Upgrading</h2> <p>Refer to <a href="upgrade/">this</a> article for instructions to upgrade your <code>cordova-android</code> version.</p> <h2 id="lifecycle-guide">Lifecycle Guide</h2> <h3 id="cordova-and-android">Cordova and Android</h3> <p>Native Android apps typically consist of a series of <a href="http://developer.android.com/reference/android/app/Activity.html" target="_blank">activities</a> that the user interacts with. Activities can be thought of as the individual screens that make up an application; different tasks in an app will often have their own activity. Each activity has its own lifecycle that is maintained as the activity enters and leaves the foreground of a user's device.</p> <p>In contrast, Cordova applications on the Android platform are executed within a Webview that is embedded in a <em>single</em> Android activity. The lifecycle of this activity is exposed to your application through the document events that are fired. The events are not guaranteed to line up with Android's lifecycle, but they can provide guidelines for saving and restoring your state. These events roughly map to Android callbacks as follows:</p> <table>
<thead> <tr> <th>Cordova Event</th> <th>Rough Android Equivalent</th> <th>Meaning</th> </tr> </thead>
<tbody> <tr> <td><code>deviceready</code></td> <td><code>onCreate()</code></td> <td>Application is starting (not from background)</td> </tr> <tr> <td><code>pause</code></td> <td><code>onPause()</code></td> <td>Application is moving to the background</td> </tr> <tr> <td><code>resume</code></td> <td><code>onResume()</code></td> <td>Application is returning to the foreground</td> </tr> </tbody>
</table> <p>Most other Cordova platforms have a similar concept of lifecycles and should fire these same events when similar actions happen on a user's device. However, Android presents some unique challenges that can sometimes show up thanks to the native Activity lifecycle.</p> <h3 id="what-makes-android-different">What makes Android different?</h3> <p>In Android, the OS can choose to kill activities in the background in order to free up resources if the device running the application is low on memory. Unfortunately, when the activity holding your application is killed, the Webview in which your application lives will be destroyed as well. Any state that your application is maintaining will be lost in this case. When the user navigates back to your application, the Activity and Webview will be recreated by the OS, but state will not be automatically restored for your Cordova app. For this reason, it is imperative that your application be aware of the lifecycle events that are fired and maintain whatever state is appropriate to make sure a user's context in your app is not lost when they leave the application.</p> <h3 id="when-can-this-happen">When can this happen?</h3> <p>Your application is susceptible to being destroyed by the OS whenever it leaves the sight of the user. There are two main situations in which this can occur. The first and most obvious case is when the user presses the home button or switches to another application.</p> <p>However, there is a second (and much more subtle) case that certain plugins can introduce. As noted above, Cordova applications are usually confined to the single activity that contains the Webview. However, there are instances in which other activities may be launched by plugins and temporarily push the Cordova activity to the background. These other Activities are typically launched in order to perform a specific task using a native application installed on the device. For example, the Apache camera plugin launches whatever camera activity is natively installed on the device in order to take a photo. Reusing the installed camera application in this way makes your application feel much more like a native app when the user tries to take a photo. Unfortunately, when the native Activity pushes your app to the background there is a chance the OS will kill it.</p> <p>For a clearer understanding of this second case, let's walk through an example using the camera plugin. Imagine you have an application that requires the user to take a profile photo. The flow of events in the application when everything goes as planned will look something like this:</p> <ol> <li>The user is interacting with your app and needs to take a picture</li> <li>The camera plugin launches the native camera activity <ul> <li><em>The Cordova activity is pushed to the background (pause event is fired)</em></li> </ul>
</li> <li>The user takes a photo</li> <li>The camera activity finishes <ul> <li><em>The Cordova activity is moved to the foreground (resume event is fired)</em></li> </ul>
</li> <li>The user is returned to your application where they left off</li> </ol> <p>However, this flow of events can be disrupted if a device is low on memory. If the Activity is killed by the OS, the above sequence of events instead plays out as follows:</p> <ol> <li>The user is interacting with your app and needs to take a picture</li> <li>The camera plugin launches the native camera activity <ul> <li><em>The OS destroys the Cordova activity (pause event is fired)</em></li> </ul>
</li> <li>The user takes a photo</li> <li>The camera activity finishes <ul> <li><em>The OS recreates the Cordova activity (deviceready and resume events are fired)</em></li> </ul>
</li> <li>The user is confused as to why they are suddenly back at your app's login screen</li> </ol> <p>In this instance, the OS killed the application in the background and the application did not maintain its state as part of the lifecycle. When the user returned to the app, the Webview was recreated and the app appeared to have restarted from scratch (hence the user's confusion). This sequence of events is equivalent to what happens when the home button is pressed or the user switches applications. The key to preventing the above experience is subscribing to events and properly maintaining state as part of the activity lifecycle.</p> <h3 id="respecting-the-lifecycle">Respecting the Lifecycle</h3> <p>In the examples above, the javascript events that are fired are noted in italics. These events are your opportunity to save and restore your application's state. You should register callbacks in your application's <code>bindEvents</code> function that respond to the lifecycle events by saving state. What information you save and how you save it is left to your discretion, but you should be sure to save enough information so that you can restore the user to exactly where they left off when they return to your application.</p> <p>There is one additional factor in the example above that only applies in the second-discussed situation (i.e. when a plugin launches an external activity). Not only was the state of the application lost when the user finished taking a photo, but so was the photo that the user took. Normally, that photo would be delivered to your application through the callback that was registered with the camera plugin. However, when the Webview was destroyed that callback was lost forever. Luckily, cordova-android 5.1.0 and above provide a means for getting the result of that plugin call when your application resumes.</p> <h3 id="retrieving-plugin-callback-results-cordova-android-5-1-0">Retrieving plugin callback results (cordova-android 5.1.0+)</h3> <p>When the OS destroys the Cordova activity that was pushed into the background by a plugin, any pending callbacks are lost as well. This means that if you passed a callback to the plugin that launched the new activity (e.g. the camera plugin), that callback will NOT be fired when the application is recreated. However, starting in cordova-android <strong>5.1.0</strong>, the <code>resume</code> event's payload will contain any pending plugin results from the plugin request that launched the external activity made prior to the activity being destroyed.</p> <p>The payload for the <code>resume</code> event adheres to the following format:</p> <pre data-language="text">{
    action: "resume",
    pendingResult: {
        pluginServiceName: string,
        pluginStatus: string,
        result: any
    }
}
</pre> <p>The fields of that payload are defined as follows:</p> <ul> <li>
<code>pluginServiceName</code>: The name of the plugin returning the result (e.g. "Camera"). This can be found in the <code>&lt;name&gt;</code> tag of a plugin's plugin.xml file</li> <li>
<code>pluginStatus</code>: The status of the plugin call (see below)</li> <li>
<code>result</code>: Whatever the result of the plugin call is</li> </ul> <p>The possible values for <code>pluginStatus</code> in the <code>pendingResult</code> field include the following:</p> <ul> <li>
<code>"OK"</code> - The plugin call was successful</li> <li>
<code>"No Result"</code> - The plugin call ended with no result</li> <li>
<code>"Error"</code> - The plugin call resulted in some general error</li> <li>Other miscellaneous errors <ul> <li><code>"Class not found"</code></li> <li><code>"Illegal access"</code></li> <li><code>"Instantiation error"</code></li> <li><code>"Malformed url"</code></li> <li><code>"IO error"</code></li> <li><code>"Invalid action"</code></li> <li><code>"JSON error"</code></li> </ul>
</li> </ul> <p>Please note that it is up to the plugin to decide what is contained in the <code>result</code> field and the meaning of the <code>pluginStatus</code> that is returned. Reference the API of the plugin you are using to see what you should expect those fields to contain and how to use their values.</p> <h4 id="example">Example</h4> <p>Below is a brief example application that uses the <code>resume</code> and <code>pause</code> events to manage state. It uses the Apache camera plugin as an example of how to retrieve the results of a plugin call from the <code>resume</code> event payload. The portion of the code dealing with the <code>resume</code>'s <code>event.pendingResult</code> object requires cordova-android <strong>5.1.0+</strong></p> <pre data-language="javascript">// This state represents the state of our application and will be saved and
// restored by onResume() and onPause()
var appState = {
    takingPicture: true,
    imageUri: ""
};

var APP_STORAGE_KEY = "exampleAppState";

var app = {
    initialize: function() {
        this.bindEvents();
    },
    bindEvents: function() {
        // Here we register our callbacks for the lifecycle events we care about
        document.addEventListener('deviceready', this.onDeviceReady, false);
        document.addEventListener('pause', this.onPause, false);
        document.addEventListener('resume', this.onResume, false);
    },
    onDeviceReady: function() {
        document.getElementById("take-picture-button").addEventListener("click", function() {
            // Because the camera plugin method launches an external Activity,
            // there is a chance that our application will be killed before the
            // success or failure callbacks are called. See onPause() and
            // onResume() where we save and restore our state to handle this case
            appState.takingPicture = true;

            navigator.camera.getPicture(cameraSuccessCallback, cameraFailureCallback,
                {
                    sourceType: Camera.PictureSourceType.CAMERA,
                    destinationType: Camera.DestinationType.FILE_URI,
                    targetWidth: 250,
                    targetHeight: 250
                }
            );
        });
    },
    onPause: function() {
        // Here, we check to see if we are in the middle of taking a picture. If
        // so, we want to save our state so that we can properly retrieve the
        // plugin result in onResume(). We also save if we have already fetched
        // an image URI
        if(appState.takingPicture || appState.imageUri) {
            window.localStorage.setItem(APP_STORAGE_KEY, JSON.stringify(appState));
        }
    },
    onResume: function(event) {
        // Here we check for stored state and restore it if necessary. In your
        // application, it's up to you to keep track of where any pending plugin
        // results are coming from (i.e. what part of your code made the call)
        // and what arguments you provided to the plugin if relevant
        var storedState = window.localStorage.getItem(APP_STORAGE_KEY);

        if(storedState) {
            appState = JSON.parse(storedState);
        }

        // Check to see if we need to restore an image we took
        if(!appState.takingPicture &amp;&amp; appState.imageUri) {
            document.getElementById("get-picture-result").src = appState.imageUri;
        }
        // Now we can check if there is a plugin result in the event object.
        // This requires cordova-android 5.1.0+
        else if(appState.takingPicture &amp;&amp; event.pendingResult) {
            // Figure out whether or not the plugin call was successful and call
            // the relevant callback. For the camera plugin, "OK" means a
            // successful result and all other statuses mean error
            if(event.pendingResult.pluginStatus === "OK") {
                // The camera plugin places the same result in the resume object
                // as it passes to the success callback passed to getPicture(),
                // thus we can pass it to the same callback. Other plugins may
                // return something else. Consult the documentation for
                // whatever plugin you are using to learn how to interpret the
                // result field
                cameraSuccessCallback(event.pendingResult.result);
            } else {
                cameraFailureCallback(event.pendingResult.result);
            }
        }
    }
}

// Here are the callbacks we pass to getPicture()
function cameraSuccessCallback(imageUri) {
    appState.takingPicture = false;
    appState.imageUri = imageUri;
    document.getElementById("get-picture-result").src = imageUri;
}

function cameraFailureCallback(error) {
    appState.takingPicture = false;
    console.log(error);
}

app.initialize();
</pre> <p>The corresponding html:</p> <pre data-language="html">&lt;!DOCTYPE html&gt;

&lt;html&gt;
    &lt;head&gt;
        &lt;meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *"&gt;
        &lt;meta name="format-detection" content="telephone=no"&gt;
        &lt;meta name="msapplication-tap-highlight" content="no"&gt;
        &lt;meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width"&gt;
        &lt;link rel="stylesheet" type="text/css" href="css/index.css"&gt;
        &lt;title&gt;Cordova Android Lifecycle Example&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class="app"&gt;
            &lt;div&gt;
                &lt;img id="get-picture-result" /&gt;
            &lt;/div&gt;
            &lt;Button id="take-picture-button"&gt;Take Picture&lt;/button&gt;
        &lt;/div&gt;
        &lt;script type="text/javascript" src="cordova.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript" src="js/index.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre> <h3 id="testing-the-activity-lifecycle">Testing the Activity Lifecycle</h3> <p>Android provides a developer setting for testing Activity destruction on low memory. Enable the "Don't keep activities" setting in the Developer Options menu on your device or emulator to simulate low memory scenarios. You should always do some amount of testing with this setting enabled to make sure that your application is properly maintaining state.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2017 The Apache Software Foundation<br>Licensed under the Apache License 2.0.<br>
    <a href="https://cordova.apache.org/docs/en/6.x/guide/platforms/android/index.html" class="_attribution-link" target="_blank">https://cordova.apache.org/docs/en/6.x/guide/platforms/android/index.html</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
