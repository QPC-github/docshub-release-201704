
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>2.6. Covariance Estimation - Scikit-learn - W3cubDocs</title>
  
  <meta name="description" content="Many statistical problems require at some point the estimation of a population’s covariance matrix, which can be seen as an estimation of data set &hellip;">
  <meta name="keywords" content="covariance, estimation, -, scikit-learn, scikit_learn">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/scikit_learn/modules/covariance/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/scikit_learn.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/scikit_learn/" class="_nav-link" title="" style="margin-left:0;">scikit-learn</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sphinx">
				
<h1 id="covariance">2.6. Covariance estimation</h1> <p id="covariance-estimation">Many statistical problems require at some point the estimation of a population’s covariance matrix, which can be seen as an estimation of data set scatter plot shape. Most of the time, such an estimation has to be done on a sample whose properties (size, structure, homogeneity) has a large influence on the estimation’s quality. The <code>sklearn.covariance</code> package aims at providing tools affording an accurate estimation of a population’s covariance matrix under various settings.</p> <p>We assume that the observations are independent and identically distributed (i.i.d.).</p>  <h2 id="empirical-covariance">2.6.1. Empirical covariance</h2> <p>The covariance matrix of a data set is known to be well approximated with the classical <em>maximum likelihood estimator</em> (or “empirical covariance”), provided the number of observations is large enough compared to the number of features (the variables describing the observations). More precisely, the Maximum Likelihood Estimator of a sample is an unbiased estimator of the corresponding population covariance matrix.</p> <p>The empirical covariance matrix of a sample can be computed using the <a class="reference internal" href="../generated/sklearn.covariance.empirical_covariance/#sklearn.covariance.empirical_covariance" title="sklearn.covariance.empirical_covariance"><code>empirical_covariance</code></a> function of the package, or by fitting an <a class="reference internal" href="../generated/sklearn.covariance.empiricalcovariance/#sklearn.covariance.EmpiricalCovariance" title="sklearn.covariance.EmpiricalCovariance"><code>EmpiricalCovariance</code></a> object to the data sample with the <a class="reference internal" href="../generated/sklearn.covariance.empiricalcovariance/#sklearn.covariance.EmpiricalCovariance.fit" title="sklearn.covariance.EmpiricalCovariance.fit"><code>EmpiricalCovariance.fit</code></a> method. Be careful that depending whether the data are centered or not, the result will be different, so one may want to use the <code>assume_centered</code> parameter accurately. More precisely if one uses <code>assume_centered=False</code>, then the test set is supposed to have the same mean vector as the training set. If not so, both should be centered by the user, and <code>assume_centered=True</code> should be used.</p> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_covariance_estimation/#sphx-glr-auto-examples-covariance-plot-covariance-estimation-py"><span class="std std-ref">Shrinkage covariance estimation: LedoitWolf vs OAS and max-likelihood</span></a> for an example on how to fit an <a class="reference internal" href="../generated/sklearn.covariance.empiricalcovariance/#sklearn.covariance.EmpiricalCovariance" title="sklearn.covariance.EmpiricalCovariance"><code>EmpiricalCovariance</code></a> object to data.</li> </ul> </div>   <h2 id="id1">2.6.2. Shrunk Covariance</h2>  <h3 id="shrunk-covariance">2.6.2.1. Basic shrinkage</h3> <p>Despite being an unbiased estimator of the covariance matrix, the Maximum Likelihood Estimator is not a good estimator of the eigenvalues of the covariance matrix, so the precision matrix obtained from its inversion is not accurate. Sometimes, it even occurs that the empirical covariance matrix cannot be inverted for numerical reasons. To avoid such an inversion problem, a transformation of the empirical covariance matrix has been introduced: the <code>shrinkage</code>.</p> <p>In the scikit-learn, this transformation (with a user-defined shrinkage coefficient) can be directly applied to a pre-computed covariance with the <a class="reference internal" href="../generated/sklearn.covariance.shrunk_covariance/#sklearn.covariance.shrunk_covariance" title="sklearn.covariance.shrunk_covariance"><code>shrunk_covariance</code></a> method. Also, a shrunk estimator of the covariance can be fitted to data with a <a class="reference internal" href="../generated/sklearn.covariance.shrunkcovariance/#sklearn.covariance.ShrunkCovariance" title="sklearn.covariance.ShrunkCovariance"><code>ShrunkCovariance</code></a> object and its <a class="reference internal" href="../generated/sklearn.covariance.shrunkcovariance/#sklearn.covariance.ShrunkCovariance.fit" title="sklearn.covariance.ShrunkCovariance.fit"><code>ShrunkCovariance.fit</code></a> method. Again, depending whether the data are centered or not, the result will be different, so one may want to use the <code>assume_centered</code> parameter accurately.</p> <p>Mathematically, this shrinkage consists in reducing the ratio between the smallest and the largest eigenvalue of the empirical covariance matrix. It can be done by simply shifting every eigenvalue according to a given offset, which is equivalent of finding the l2-penalized Maximum Likelihood Estimator of the covariance matrix. In practice, shrinkage boils down to a simple a convex transformation : <img class="math" src="http://scikit-learn.org/stable/_images/math/15c11d65b606f856718f48222608c71e479df07c.png" alt="\Sigma_{\rm
shrunk} = (1-\alpha)\hat{\Sigma} + \alpha\frac{{\rm
Tr}\hat{\Sigma}}{p}\rm Id">.</p> <p>Choosing the amount of shrinkage, <img class="math" src="http://scikit-learn.org/stable/_images/math/877d234f4cec6974ce218fc2e975a486a7972dfd.png" alt="\alpha"> amounts to setting a bias/variance trade-off, and is discussed below.</p> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_covariance_estimation/#sphx-glr-auto-examples-covariance-plot-covariance-estimation-py"><span class="std std-ref">Shrinkage covariance estimation: LedoitWolf vs OAS and max-likelihood</span></a> for an example on how to fit a <a class="reference internal" href="../generated/sklearn.covariance.shrunkcovariance/#sklearn.covariance.ShrunkCovariance" title="sklearn.covariance.ShrunkCovariance"><code>ShrunkCovariance</code></a> object to data.</li> </ul> </div>   <h3 id="ledoit-wolf-shrinkage">2.6.2.2. Ledoit-Wolf shrinkage</h3> <p>In their 2004 paper [1], O. Ledoit and M. Wolf propose a formula so as to compute the optimal shrinkage coefficient <img class="math" src="http://scikit-learn.org/stable/_images/math/877d234f4cec6974ce218fc2e975a486a7972dfd.png" alt="\alpha"> that minimizes the Mean Squared Error between the estimated and the real covariance matrix.</p> <p>The Ledoit-Wolf estimator of the covariance matrix can be computed on a sample with the <a class="reference internal" href="../generated/sklearn.covariance.ledoit_wolf/#sklearn.covariance.ledoit_wolf" title="sklearn.covariance.ledoit_wolf"><code>ledoit_wolf</code></a> function of the <code>sklearn.covariance</code> package, or it can be otherwise obtained by fitting a <a class="reference internal" href="../generated/sklearn.covariance.ledoitwolf/#sklearn.covariance.LedoitWolf" title="sklearn.covariance.LedoitWolf"><code>LedoitWolf</code></a> object to the same sample.</p> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_covariance_estimation/#sphx-glr-auto-examples-covariance-plot-covariance-estimation-py"><span class="std std-ref">Shrinkage covariance estimation: LedoitWolf vs OAS and max-likelihood</span></a> for an example on how to fit a <a class="reference internal" href="../generated/sklearn.covariance.ledoitwolf/#sklearn.covariance.LedoitWolf" title="sklearn.covariance.LedoitWolf"><code>LedoitWolf</code></a> object to data and for visualizing the performances of the Ledoit-Wolf estimator in terms of likelihood.</li> </ul> </div> <dl class="docutils"> <dt>[1] O. Ledoit and M. Wolf, “A Well-Conditioned Estimator for Large-Dimensional</dt> <dd>Covariance Matrices”, Journal of Multivariate Analysis, Volume 88, Issue 2, February 2004, pages 365-411.</dd> </dl>   <h3 id="id2">2.6.2.3. Oracle Approximating Shrinkage</h3> <p id="oracle-approximating-shrinkage">Under the assumption that the data are Gaussian distributed, Chen et al. [2] derived a formula aimed at choosing a shrinkage coefficient that yields a smaller Mean Squared Error than the one given by Ledoit and Wolf’s formula. The resulting estimator is known as the Oracle Shrinkage Approximating estimator of the covariance.</p> <p>The OAS estimator of the covariance matrix can be computed on a sample with the <a class="reference internal" href="../generated/sklearn.covariance.oas/#sklearn.covariance.oas" title="sklearn.covariance.oas"><code>oas</code></a> function of the <code>sklearn.covariance</code> package, or it can be otherwise obtained by fitting an <a class="reference internal" href="../generated/sklearn.covariance.oas/#sklearn.covariance.OAS" title="sklearn.covariance.OAS"><code>OAS</code></a> object to the same sample.</p> <div class="figure align-center" id="id4"> <a class="reference external image-reference" href="../../auto_examples/covariance/plot_covariance_estimation/"><img alt="../_images/sphx_glr_plot_covariance_estimation_0011.png" src="http://scikit-learn.org/stable/_images/sphx_glr_plot_covariance_estimation_0011.png" style="width: 520.0px; height: 390.0px;"></a> <p class="caption"><span class="caption-text">Bias-variance trade-off when setting the shrinkage: comparing the choices of Ledoit-Wolf and OAS estimators</span></p> </div> <dl class="docutils"> <dt>[2] Chen et al., “Shrinkage Algorithms for MMSE Covariance Estimation”,</dt> <dd>IEEE Trans. on Sign. Proc., Volume 58, Issue 10, October 2010.</dd> </dl> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_covariance_estimation/#sphx-glr-auto-examples-covariance-plot-covariance-estimation-py"><span class="std std-ref">Shrinkage covariance estimation: LedoitWolf vs OAS and max-likelihood</span></a> for an example on how to fit an <a class="reference internal" href="../generated/sklearn.covariance.oas/#sklearn.covariance.OAS" title="sklearn.covariance.OAS"><code>OAS</code></a> object to data.</li> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_lw_vs_oas/#sphx-glr-auto-examples-covariance-plot-lw-vs-oas-py"><span class="std std-ref">Ledoit-Wolf vs OAS estimation</span></a> to visualize the Mean Squared Error difference between a <a class="reference internal" href="../generated/sklearn.covariance.ledoitwolf/#sklearn.covariance.LedoitWolf" title="sklearn.covariance.LedoitWolf"><code>LedoitWolf</code></a> and an <a class="reference internal" href="../generated/sklearn.covariance.oas/#sklearn.covariance.OAS" title="sklearn.covariance.OAS"><code>OAS</code></a> estimator of the covariance.</li> </ul> </div> <div class="figure align-center"> <a class="reference external image-reference" href="../../auto_examples/covariance/plot_lw_vs_oas/"><img alt="../_images/sphx_glr_plot_lw_vs_oas_0011.png" src="http://scikit-learn.org/stable/_images/sphx_glr_plot_lw_vs_oas_0011.png" style="width: 600.0px; height: 450.0px;"></a> </div>    <h2 id="id3">2.6.3. Sparse inverse covariance</h2> <p id="sparse-inverse-covariance">The matrix inverse of the covariance matrix, often called the precision matrix, is proportional to the partial correlation matrix. It gives the partial independence relationship. In other words, if two features are independent conditionally on the others, the corresponding coefficient in the precision matrix will be zero. This is why it makes sense to estimate a sparse precision matrix: by learning independence relations from the data, the estimation of the covariance matrix is better conditioned. This is known as <em>covariance selection</em>.</p> <p>In the small-samples situation, in which <code>n_samples</code> is on the order of <code>n_features</code> or smaller, sparse inverse covariance estimators tend to work better than shrunk covariance estimators. However, in the opposite situation, or for very correlated data, they can be numerically unstable. In addition, unlike shrinkage estimators, sparse estimators are able to recover off-diagonal structure.</p> <p>The <a class="reference internal" href="../generated/sklearn.covariance.graphlasso/#sklearn.covariance.GraphLasso" title="sklearn.covariance.GraphLasso"><code>GraphLasso</code></a> estimator uses an l1 penalty to enforce sparsity on the precision matrix: the higher its <code>alpha</code> parameter, the more sparse the precision matrix. The corresponding <a class="reference internal" href="../generated/sklearn.covariance.graphlassocv/#sklearn.covariance.GraphLassoCV" title="sklearn.covariance.GraphLassoCV"><code>GraphLassoCV</code></a> object uses cross-validation to automatically set the <code>alpha</code> parameter.</p> <div class="figure align-center" id="id5"> <a class="reference external image-reference" href="../../auto_examples/covariance/plot_sparse_cov/"><img alt="../_images/sphx_glr_plot_sparse_cov_0011.png" src="http://scikit-learn.org/stable/_images/sphx_glr_plot_sparse_cov_0011.png" style="width: 600.0px; height: 360.0px;"></a> <p class="caption"><span class="caption-text"><em>A comparison of maximum likelihood, shrinkage and sparse estimates of the covariance and precision matrix in the very small samples settings.</em></span></p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p><strong>Structure recovery</strong></p> <p>Recovering a graphical structure from correlations in the data is a challenging thing. If you are interested in such recovery keep in mind that:</p> <ul class="last simple"> <li>Recovery is easier from a correlation matrix than a covariance matrix: standardize your observations before running <a class="reference internal" href="../generated/sklearn.covariance.graphlasso/#sklearn.covariance.GraphLasso" title="sklearn.covariance.GraphLasso"><code>GraphLasso</code></a>
</li> <li>If the underlying graph has nodes with much more connections than the average node, the algorithm will miss some of these connections.</li> <li>If your number of observations is not large compared to the number of edges in your underlying graph, you will not recover it.</li> <li>Even if you are in favorable recovery conditions, the alpha parameter chosen by cross-validation (e.g. using the <a class="reference internal" href="../generated/sklearn.covariance.graphlassocv/#sklearn.covariance.GraphLassoCV" title="sklearn.covariance.GraphLassoCV"><code>GraphLassoCV</code></a> object) will lead to selecting too many edges. However, the relevant edges will have heavier weights than the irrelevant ones.</li> </ul> </div> <p>The mathematical formulation is the following:</p> <div class="math"> <p><img src="http://scikit-learn.org/stable/_images/math/535c046ade78aa5720a56f46f769008dfc3aab5f.png" alt="\hat{K} = \mathrm{argmin}_K \big(
            \mathrm{tr} S K - \mathrm{log} \mathrm{det} K
            + \alpha \|K\|_1
            \big)"></p> </div>
<p>Where <img class="math" src="http://scikit-learn.org/stable/_images/math/684381a21cd73ebbf43b63a087d3f7410ee99ce8.png" alt="K"> is the precision matrix to be estimated, and <img class="math" src="http://scikit-learn.org/stable/_images/math/1dbc400fcc213305415872f9f625cd2828f97a00.png" alt="S"> is the sample covariance matrix. <img class="math" src="http://scikit-learn.org/stable/_images/math/76aedfc82946a2105b42aec1dd12e836f447fafb.png" alt="\|K\|_1"> is the sum of the absolute values of off-diagonal coefficients of <img class="math" src="http://scikit-learn.org/stable/_images/math/684381a21cd73ebbf43b63a087d3f7410ee99ce8.png" alt="K">. The algorithm employed to solve this problem is the GLasso algorithm, from the Friedman 2008 Biostatistics paper. It is the same algorithm as in the R <code>glasso</code> package.</p> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>
<a class="reference internal" href="../../auto_examples/covariance/plot_sparse_cov/#sphx-glr-auto-examples-covariance-plot-sparse-cov-py"><span class="std std-ref">Sparse inverse covariance estimation</span></a>: example on synthetic data showing some recovery of a structure, and comparing to other covariance estimators.</li> <li>
<a class="reference internal" href="../../auto_examples/applications/plot_stock_market/#sphx-glr-auto-examples-applications-plot-stock-market-py"><span class="std std-ref">Visualizing the stock market structure</span></a>: example on real stock market data, finding which symbols are most linked.</li> </ul> </div> <div class="topic"> <p class="topic-title first">References:</p> <ul class="simple"> <li>Friedman et al, <a class="reference external" href="http://biostatistics.oxfordjournals.org/content/9/3/432.short" target="_blank">“Sparse inverse covariance estimation with the graphical lasso”</a>, Biostatistics 9, pp 432, 2008</li> </ul> </div>   <h2 id="robust-covariance">2.6.4. Robust Covariance Estimation</h2> <p id="robust-covariance-estimation">Real data set are often subjects to measurement or recording errors. Regular but uncommon observations may also appear for a variety of reason. Every observation which is very uncommon is called an outlier. The empirical covariance estimator and the shrunk covariance estimators presented above are very sensitive to the presence of outlying observations in the data. Therefore, one should use robust covariance estimators to estimate the covariance of its real data sets. Alternatively, robust covariance estimators can be used to perform outlier detection and discard/downweight some observations according to further processing of the data.</p> <p>The <code>sklearn.covariance</code> package implements a robust estimator of covariance, the Minimum Covariance Determinant [3].</p>  <h3 id="minimum-covariance-determinant">2.6.4.1. Minimum Covariance Determinant</h3> <p>The Minimum Covariance Determinant estimator is a robust estimator of a data set’s covariance introduced by P.J. Rousseeuw in [3]. The idea is to find a given proportion (h) of “good” observations which are not outliers and compute their empirical covariance matrix. This empirical covariance matrix is then rescaled to compensate the performed selection of observations (“consistency step”). Having computed the Minimum Covariance Determinant estimator, one can give weights to observations according to their Mahalanobis distance, leading to a reweighted estimate of the covariance matrix of the data set (“reweighting step”).</p> <p>Rousseeuw and Van Driessen [4] developed the FastMCD algorithm in order to compute the Minimum Covariance Determinant. This algorithm is used in scikit-learn when fitting an MCD object to data. The FastMCD algorithm also computes a robust estimate of the data set location at the same time.</p> <p>Raw estimates can be accessed as <code>raw_location_</code> and <code>raw_covariance_</code> attributes of a <a class="reference internal" href="../generated/sklearn.covariance.mincovdet/#sklearn.covariance.MinCovDet" title="sklearn.covariance.MinCovDet"><code>MinCovDet</code></a> robust covariance estimator object.</p> <dl class="docutils"> <dt>[3] P. J. Rousseeuw. Least median of squares regression.</dt> <dd>
<ol class="first last upperalpha simple" start="10"> <li>Am Stat Ass, 79:871, 1984.</li> </ol> </dd> <dt>[4] A Fast Algorithm for the Minimum Covariance Determinant Estimator,</dt> <dd>1999, American Statistical Association and the American Society for Quality, TECHNOMETRICS.</dd> </dl> <div class="topic"> <p class="topic-title first">Examples:</p> <ul class="simple"> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_robust_vs_empirical_covariance/#sphx-glr-auto-examples-covariance-plot-robust-vs-empirical-covariance-py"><span class="std std-ref">Robust vs Empirical covariance estimate</span></a> for an example on how to fit a <a class="reference internal" href="../generated/sklearn.covariance.mincovdet/#sklearn.covariance.MinCovDet" title="sklearn.covariance.MinCovDet"><code>MinCovDet</code></a> object to data and see how the estimate remains accurate despite the presence of outliers.</li> <li>See <a class="reference internal" href="../../auto_examples/covariance/plot_mahalanobis_distances/#sphx-glr-auto-examples-covariance-plot-mahalanobis-distances-py"><span class="std std-ref">Robust covariance estimation and Mahalanobis distances relevance</span></a> to visualize the difference between <a class="reference internal" href="../generated/sklearn.covariance.empiricalcovariance/#sklearn.covariance.EmpiricalCovariance" title="sklearn.covariance.EmpiricalCovariance"><code>EmpiricalCovariance</code></a> and <a class="reference internal" href="../generated/sklearn.covariance.mincovdet/#sklearn.covariance.MinCovDet" title="sklearn.covariance.MinCovDet"><code>MinCovDet</code></a> covariance estimators in terms of Mahalanobis distance (so we get a better estimate of the precision matrix too).</li> </ul> </div>  <table class="docutils">  <thead valign="bottom"> <tr class="row-odd">
<th class="head">Influence of outliers on location and covariance estimates</th> <th class="head">Separating inliers from outliers using a Mahalanobis distance</th> </tr> </thead>  <tr class="row-even">
<td><a class="reference external" href="../../auto_examples/covariance/plot_robust_vs_empirical_covariance/"><img alt="robust_vs_emp" src="http://scikit-learn.org/stable/_images/sphx_glr_plot_robust_vs_empirical_covariance_0011.png" style="width: 392.0px; height: 294.0px;"></a></td> <td><a class="reference external" href="../../auto_examples/covariance/plot_mahalanobis_distances/"><img alt="mahalanobis" src="http://scikit-learn.org/stable/_images/sphx_glr_plot_mahalanobis_distances_0011.png" style="width: 392.0px; height: 294.0px;"></a></td> </tr>  </table>
<div class="_attribution">
  <p class="_attribution-p">
    © 2007–2016 The scikit-learn developers<br>Licensed under the 3-clause BSD License.<br>
    <a href="http://scikit-learn.org/stable/modules/covariance.html" class="_attribution-link" target="_blank">http://scikit-learn.org/stable/modules/covariance.html</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
