
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Plan for Swarm in Production - Docker 1.11 - W3cubDocs</title>
  
  <meta name="description" content="This article provides guidance to help you plan, deploy, and manage Docker Swarm clusters in business critical production environments. The &hellip;">
  <meta name="keywords" content="plan, for, swarm, production, -, docker, docker~1.11">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/docker~1.11/swarm/plan-for-production/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/docker~1.11.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/docker~1.11/" class="_nav-link" title="" style="margin-left:0;">Docker 1.11</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _docker">
				
<h1 id="plan-for-swarm-in-production">Plan for Swarm in production</h1> <p>This article provides guidance to help you plan, deploy, and manage Docker Swarm clusters in business critical production environments. The following high level topics are covered:</p> <ul> <li><a href="#security">Security</a></li> <li><a href="#high-availability">High Availability</a></li> <li><a href="#performance">Performance</a></li> <li><a href="#cluster-ownership">Cluster ownership</a></li> </ul> <h2 id="security">Security</h2> <p>There are many aspects to securing a Docker Swarm cluster. This section covers:</p> <ul> <li>Authentication using TLS</li> <li>Network access control</li> </ul> <p>These topics are not exhaustive. They form part of a wider security architecture that includes: security patching, strong password policies, role based access control, technologies such as SELinux and AppArmor, strict auditing, and more.</p> <h3 id="configure-swarm-for-tls">Configure Swarm for TLS</h3> <p>All nodes in a Swarm cluster must bind their Docker Engine daemons to a network port. This brings with it all of the usual network related security implications such as man-in-the-middle attacks. These risks are compounded when the network in question is untrusted such as the internet. To mitigate these risks, Swarm and the Engine support Transport Layer Security(TLS) for authentication.</p> <p>The Engine daemons, including the Swarm manager, that are configured to use TLS will only accept commands from Docker Engine clients that sign their communications. The Engine and Swarm support external 3rd party Certificate Authorities (CA) as well as internal corporate CAs.</p> <p>The default Engine and Swarm ports for TLS are:</p> <ul> <li>Engine daemon: 2376/tcp</li> <li>Swarm manager: 3376/tcp</li> </ul> <p>For more information on configuring Swarm for TLS, see the <a href="../secure-swarm-tls/">Overview Docker Swarm with TLS</a> page.</p> <h3 id="network-access-control">Network access control</h3> <p>Production networks are complex, and usually locked down so that only allowed traffic can flow on the network. The list below shows the network ports that the different components of a Swam cluster listen on. You should use these to configure your firewalls and other network access control lists.</p> <ul> <li>
<strong>Swarm manager.</strong> <ul> <li>
<strong>Inbound 80/tcp (HTTP)</strong>. This allows <code>docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li> <li>
<strong>Inbound 2375/tcp</strong>. This allows Docker Engine CLI commands direct to the Engine daemon.</li> <li>
<strong>Inbound 3375/tcp</strong>. This allows Engine CLI commands to the Swarm manager.</li> <li>
<strong>Inbound 22/tcp</strong>. This allows remote management via SSH</li> </ul>
</li> <li>
<strong>Service Discovery</strong>: <ul> <li>
<strong>Inbound 80/tcp (HTTP)</strong>. This allows <code>docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li> <li>
<strong>Inbound *Discovery service port</strong>*. This needs setting to the port that the backend discovery service listens on (consul, etcd, or zookeeper).</li> <li>
<strong>Inbound 22/tcp</strong>. This allows remote management via SSH</li> </ul>
</li> <li>
<strong>Swarm nodes</strong>: <ul> <li>
<strong>Inbound 80/tcp (HTTP)</strong>. This allows <code>docker pull</code> commands to work. If you plan to pull images from Docker Hub, you must allow Internet connections through port 80.</li> <li>
<strong>Inbound 2375/tcp</strong>. This allows Engine CLI commands direct to the Docker daemon.</li> <li>
<strong>Inbound 22/tcp</strong>. This allows remote management via SSH.</li> </ul>
</li> <li>
<strong>Custom, cross-host container networks</strong>: <ul> <li>
<strong>Inbound 7946/tcp</strong> Allows for discovering other container networks.</li> <li>
<strong>Inbound 7946/udp</strong> Allows for discovering other container networks.</li> <li>
<strong>Inbound <store-port>/tcp</store-port></strong> Network key-value store service port.</li> <li>
<strong>4789/udp</strong> For the container overlay network.</li> </ul>
</li> </ul> <p>If your firewalls and other network devices are connection state aware, they will allow responses to established TCP connections. If your devices are not state aware, you will need to open up ephemeral ports from 32768-65535. For added security you can configure the ephemeral port rules to only allow connections from interfaces on known Swarm devices.</p> <p>If your Swarm cluster is configured for TLS, replace <code>2375</code> with <code>2376</code>, and <code>3375</code> with <code>3376</code>.</p> <p>The ports listed above are just for Swarm cluster operations such as; cluster creation, cluster management, and scheduling of containers against the cluster. You may need to open additional network ports for application-related communications.</p> <p>It is possible for different components of a Swarm cluster to exist on separate networks. For example, many organizations operate separate management and production networks. Some Docker Engine clients may exist on a management network, while Swarm managers, discovery service instances, and nodes might exist on one or more production networks. To offset against network failures, you can deploy Swarm managers, discovery services, and nodes across multiple production networks. In all of these cases you can use the list of ports above to assist the work of your network infrastructure teams to efficiently and securely configure your network.</p> <h2 id="high-availability-ha">High Availability (HA)</h2> <p>All production environments should be highly available, meaning they are continuously operational over long periods of time. To achieve high availability, an environment must the survive failures of its individual component parts.</p> <p>The following sections discuss some technologies and best practices that can enable you to build resilient, highly-available Swarm clusters. You can then use these cluster to run your most demanding production applications and workloads.</p> <h3 id="swarm-manager-ha">Swarm manager HA</h3> <p>The Swarm manager is responsible for accepting all commands coming in to a Swarm cluster, and scheduling resources against the cluster. If the Swarm manager becomes unavailable, some cluster operations cannot be performed until the Swarm manager becomes available again. This is unacceptable in large-scale business critical scenarios.</p> <p>Swarm provides HA features to mitigate against possible failures of the Swarm manager. You can use Swarm’s HA feature to configure multiple Swarm managers for a single cluster. These Swarm managers operate in an active/passive formation with a single Swarm manager being the <em>primary</em>, and all others being <em>secondaries</em>.</p> <p>Swarm secondary managers operate as <em>warm standby’s</em>, meaning they run in the background of the primary Swarm manager. The secondary Swarm managers are online and accept commands issued to the cluster, just as the primary Swarm manager. However, any commands received by the secondaries are forwarded to the primary where they are executed. Should the primary Swarm manager fail, a new primary is elected from the surviving secondaries.</p> <p>When creating HA Swarm managers, you should take care to distribute them over as many <em>failure domains</em> as possible. A failure domain is a network section that can be negatively affected if a critical device or service experiences problems. For example, if your cluster is running in the Ireland Region of Amazon Web Services (eu-west-1) and you configure three Swarm managers (1 x primary, 2 x secondary), you should place one in each availability zone as shown below.</p> <p><img src="http://farm2.staticflickr.com/1657/24581727611_0a076b79de_b.jpg" alt=""></p> <p>In this configuration, the Swarm cluster can survive the loss of any two availability zones. For your applications to survive such failures, they must be architected across as many failure domains as well.</p> <p>For Swarm clusters serving high-demand, line-of-business applications, you should have 3 or more Swarm managers. This configuration allows you to take one manager down for maintenance, suffer an unexpected failure, and still continue to manage and operate the cluster.</p> <h3 id="discovery-service-ha">Discovery service HA</h3> <p>The discovery service is a key component of a Swarm cluster. If the discovery service becomes unavailable, this can prevent certain cluster operations. For example, without a working discovery service, operations such as adding new nodes to the cluster and making queries against the cluster configuration fail. This is not acceptable in business critical production environments.</p> <p>Swarm supports four backend discovery services:</p> <ul> <li>Hosted (not for production use)</li> <li>Consul</li> <li>etcd</li> <li>Zookeeper</li> </ul> <p>Consul, etcd, and Zookeeper are all suitable for production, and should be configured for high availability. You should use each service’s existing tools and best practices to configure these for HA.</p> <p>For Swarm clusters serving high-demand, line-of-business applications, it is recommended to have 5 or more discovery service instances. This due to the replication/HA technologies they use (such as Paxos/Raft) requiring a strong quorum. Having 5 instances allows you to take one down for maintenance, suffer an unexpected failure, and still be able to achieve a strong quorum.</p> <p>When creating a highly available Swarm discovery service, you should take care to distribute each discovery service instance over as many failure domains as possible. For example, if your cluster is running in the Ireland Region of Amazon Web Services (eu-west-1) and you configure three discovery service instances, you should place one in each availability zone.</p> <p>The diagram below shows a Swarm cluster configured for HA. It has three Swarm managers and three discovery service instances spread over three failure domains (availability zones). It also has Swarm nodes balanced across all three failure domains. The loss of two availability zones in the configuration shown below does not cause the Swarm cluster to go down.</p> <p><img src="http://farm2.staticflickr.com/1675/24380252320_999687d2bb_b.jpg" alt=""></p> <p>It is possible to share the same Consul, etcd, or Zookeeper containers between the Swarm discovery and Engine container networks. However, for best performance and availability you should deploy dedicated instances – a discovery instance for Swarm and another for your container networks.</p> <h3 id="multiple-clouds">Multiple clouds</h3> <p>You can architect and build Swarm clusters that stretch across multiple cloud providers, and even across public cloud and on premises infrastructures. The diagram below shows an example Swarm cluster stretched across AWS and Azure.</p> <p><img src="http://farm2.staticflickr.com/1493/24676269945_d19daf856c_b.jpg" alt=""></p> <p>While such architectures may appear to provide the ultimate in availability, there are several factors to consider. Network latency can be problematic, as can partitioning. As such, you should seriously consider technologies that provide reliable, high speed, low latency connections into these cloud platforms – technologies such as AWS Direct Connect and Azure ExpressRoute.</p> <p>If you are considering a production deployment across multiple infrastructures like this, make sure you have good test coverage over your entire system.</p> <h3 id="isolated-production-environments">Isolated production environments</h3> <p>It is possible to run multiple environments, such as development, staging, and production, on a single Swarm cluster. You accomplish this by tagging Swarm nodes and using constraints to filter containers onto nodes tagged as <code>production</code> or <code>staging</code> etc. However, this is not recommended. The recommended approach is to air-gap production environments, especially high performance business critical production environments.</p> <p>For example, many companies not only deploy dedicated isolated infrastructures for production – such as networks, storage, compute and other systems. They also deploy separate management systems and policies. This results in things like users having separate accounts for logging on to production systems etc. In these types of environments, it is mandatory to deploy dedicated production Swarm clusters that operate on the production hardware infrastructure and follow thorough production management, monitoring, audit and other policies.</p> <h3 id="operating-system-selection">Operating system selection</h3> <p>You should give careful consideration to the operating system that your Swarm infrastructure relies on. This consideration is vital for production environments.</p> <p>It is not unusual for a company to use one operating system in development environments, and a different one in production. A common example of this is to use CentOS in development environments, but then to use Red Hat Enterprise Linux (RHEL) in production. This decision is often a balance between cost and support. CentOS Linux can be downloaded and used for free, but commercial support options are few and far between. Whereas RHEL has an associated support and license cost, but comes with world class commercial support from Red Hat.</p> <p>When choosing the production operating system to use with your Swarm clusters, choose one that closely matches what you have used in development and staging environments. Although containers abstract much of the underlying OS, some features have configuration requirements. For example, to use Docker container networking with Docker Engine 1.10 or higher, your host must have a Linux kernel that is version 3.10 or higher. Refer to the change logs to understand the requirements for a particular version of Docker Engine or Swarm.</p> <p>You should also consider procedures and channels for deploying and potentially patching your production operating systems.</p> <h2 id="performance">Performance</h2> <p>Performance is critical in environments that support business critical line of business applications. The following sections discuss some technologies and best practices that can help you build high performance Swarm clusters.</p> <h3 id="container-networks">Container networks</h3> <p>Docker Engine container networks are overlay networks and can be created across multiple Engine hosts. For this reason, a container network requires a key-value (KV) store to maintain network configuration and state. This KV store can be shared in common with the one used by the Swarm cluster discovery service. However, for best performance and fault isolation, you should deploy individual KV store instances for container networks and Swarm discovery. This is especially so in demanding business critical production environments.</p> <p>Beginning with Docker Engine 1.9, Docker container networks require specific Linux kernel versions. Higher kernel versions are usually preferred, but carry an increased risk of instability because of the newness of the kernel. Where possible, use a kernel version that is already approved for use in your production environment. If you can not use a 3.10 or higher Linux kernel version for production, you should begin the process of approving a newer kernel as early as possible.</p> <h3 id="scheduling-strategies">Scheduling strategies</h3>  <p>Scheduling strategies are how Swarm decides which nodes on a cluster to start containers on. Swarm supports the following strategies:</p> <ul> <li>spread</li> <li>binpack</li> <li>random (not for production use)</li> </ul> <p>You can also write your own.</p> <p><strong>Spread</strong> is the default strategy. It attempts to balance the number of containers evenly across all nodes in the cluster. This is a good choice for high performance clusters, as it spreads container workload across all resources in the cluster. These resources include CPU, RAM, storage, and network bandwidth.</p> <p>If your Swarm nodes are balanced across multiple failure domains, the spread strategy evenly balance containers across those failure domains. However, spread on its own is not aware of the roles of any of those containers, so has no intelligence to spread multiple instances of the same service across failure domains. To achieve this you should use tags and constraints.</p> <p>The <strong>binpack</strong> strategy runs as many containers as possible on a node, effectively filling it up, before scheduling containers on the next node.</p> <p>This means that binpack does not use all cluster resources until the cluster fills up. As a result, applications running on Swarm clusters that operate the binpack strategy might not perform as well as those that operate the spread strategy. However, binpack is a good choice for minimizing infrastructure requirements and cost. For example, imagine you have a 10-node cluster where each node has 16 CPUs and 128GB of RAM. However, your container workload across the entire cluster is only using the equivalent of 6 CPUs and 64GB RAM. The spread strategy would balance containers across all nodes in the cluster. However, the binpack strategy would fit all containers on a single node, potentially allowing you turn off the additional nodes and save on cost.</p> <h2 id="ownership-of-swarm-clusters">Ownership of Swarm clusters</h2> <p>The question of ownership is vital in production environments. It is therefore vital that you consider and agree on all of the following when planning, documenting, and deploying your production Swarm clusters.</p> <ul> <li>Whose budget does the production Swarm infrastructure come out of?</li> <li>Who owns the accounts that can administer and manage the production Swarm cluster?</li> <li>Who is responsible for monitoring the production Swarm infrastructure?</li> <li>Who is responsible for patching and upgrading the production Swarm infrastructure?</li> <li>On-call responsibilities and escalation procedures?</li> </ul> <p>The above is not a complete list, and the answers to the questions will vary depending on how your organization’s and team’s are structured. Some companies are along way down the DevOps route, while others are not. Whatever situation your company is in, it is important that you factor all of the above into the planning, deployment, and ongoing management of your production Swarm clusters.</p> <h2 id="related-information">Related information</h2> <ul> <li><a href="https://docs.docker.com/v1.11/swarm/swarm_at_scale/" target="_blank">Try Swarm at scale</a></li> <li><a href="../networking/">Swarm and container networks</a></li> <li><a href="../multi-manager-setup/">High availability in Docker Swarm</a></li> <li><a href="https://www.docker.com/products/docker-universal-control-plane" target="_blank">Universal Control plane</a></li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © 2013–2016 Docker, Inc.<br>Licensed under the Apache License, Version 2.0.<br>Docker and the Docker logo are trademarks or registered trademarks of Docker, Inc. in the United States and/or other countries.<br>Docker, Inc. and other parties may also have trademark rights in other terms used herein.<br>
    <a href="https://docs.docker.com/v1.11/swarm/plan-for-production/" class="_attribution-link" target="_blank">https://docs.docker.com/v1.11/swarm/plan-for-production/</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
